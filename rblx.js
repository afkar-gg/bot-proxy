// encoded to Base64
const encoded = "Y29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoImV4cHJlc3MiKTsKY29uc3QgY29va2llUGFyc2VyID0gcmVxdWlyZSgiY29va2llLXBhcnNlciIpOwpjb25zdCBmcyA9IHJlcXVpcmUoImZzIik7CmNvbnN0IGNvbmZpZyA9IHJlcXVpcmUoIi4vY29uZmlnLmpzb24iKTsKY29uc3QgZmV0Y2ggPSAoLi4uYXJncykgPT4gaW1wb3J0KCdub2RlLWZldGNoJykudGhlbigoe2RlZmF1bHQ6IGZldGNofSkgPT4gZmV0Y2goLi4uYXJncykpOwpjb25zdCB7IGV4ZWMgfSA9IHJlcXVpcmUoImNoaWxkX3Byb2Nlc3MiKTsKY29uc3QgcGF0aCA9IHJlcXVpcmUoInBhdGgiKTsKY29uc3QgR0FHX0ZJTEUgPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAiZ2FnZGF0YS5qc29uIik7CmNvbnN0IGdhZ0RhdGFTdG9yZSA9IG5ldyBNYXAoKTsKCi8vID09PSBWZXJzaW9uIEluZm8gPT09CmNvbnN0IHZlcnNpb24gPSAidjIuNC4wIjsKY29uc3QgY2hhbmdlbG9nID0gWwogICJlbmNvZGVkIGFuZCBzaG9ydGVuIGlnIiwKXTsKCmNvbnN0IFNUT1JBR0VfRklMRSA9ICIuL3N0b3JhZ2UuanNvbiI7CmNvbnN0IEJPVF9UT0tFTiA9IGNvbmZpZy5CT1RfVE9LRU47CmNvbnN0IENIQU5ORUwgPSBjb25maWcuQ0hBTk5FTF9JRDsKY29uc3QgSk9CX0NIQU5ORUwgPSBjb25maWcuSk9CX0NIQU5ORUxfSUQ7CmNvbnN0IERBU0hfUEFTUyA9IGNvbmZpZy5EQVNIQk9BUkRfUEFTU1dPUkQgfHwgInNlY3JldCI7CmNvbnN0IEdBTUVfUExBQ0VfSUQgPSA3MDg3NjgzMjI1MzE2MzsKY29uc3QgTE9CQllfUExBQ0VfSUQgPSAxMTY0OTU4MjkxODg5NTI7CmNvbnN0IFBPUlQgPSBjb25maWcuUE9SVCB8fCAzMDAwOwoKY29uc3QgYXBwID0gZXhwcmVzcygpOwphcHAudXNlKGV4cHJlc3MuanNvbigpKTsKYXBwLnVzZShleHByZXNzLnVybGVuY29kZWQoeyBleHRlbmRlZDogZmFsc2UgfSkpOwphcHAudXNlKGNvb2tpZVBhcnNlcigpKTsKCmNvbnN0IHBlbmRpbmcgPSBuZXcgTWFwKCk7CmNvbnN0IHNlc3Npb25zID0gbmV3IE1hcCgpOwpjb25zdCBsYXN0U2VlbiA9IG5ldyBNYXAoKTsKY29uc3QgbGFzdFNlbnQgPSBuZXcgTWFwKCk7CmNvbnN0IGNvbXBsZXRlZCA9IG5ldyBNYXAoKTsKCmlmICghQk9UX1RPS0VOIHx8ICFDSEFOTkVMKSB7CiAgY29uc29sZS5lcnJvcigi4p2MIE1pc3NpbmcgQk9UX1RPS0VOIG9yIENIQU5ORUxfSUQgaW4gY29uZmlnLmpzb24iKTsKICBwcm9jZXNzLmV4aXQoMSk7Cn0KCmlmICghZnMuZXhpc3RzU3luYyhTVE9SQUdFX0ZJTEUpKSB7CiAgZnMud3JpdGVGaWxlU3luYyhTVE9SQUdFX0ZJTEUsIEpTT04uc3RyaW5naWZ5KHsgY29tcGxldGVkOiBbXSB9LCBudWxsLCAyKSk7Cn0KCmNvbnN0IHNhdmVkID0gSlNPTi5wYXJzZShmcy5yZWFkRmlsZVN5bmMoU1RPUkFHRV9GSUxFLCAidXRmOCIpKTsKaWYgKHNhdmVkLmNvbXBsZXRlZCkgc2F2ZWQuY29tcGxldGVkLmZvckVhY2gocyA9PiBjb21wbGV0ZWQuc2V0KHMudXNlcm5hbWUudG9Mb3dlckNhc2UoKSwgcykpOwppZiAoc2F2ZWQucGVuZGluZykgc2F2ZWQucGVuZGluZy5mb3JFYWNoKHMgPT4gcGVuZGluZy5zZXQocy51c2VybmFtZS50b0xvd2VyQ2FzZSgpLCBzKSk7CmlmIChzYXZlZC5zZXNzaW9ucykgc2F2ZWQuc2Vzc2lvbnMuZm9yRWFjaChzID0+IHNlc3Npb25zLnNldChzLnVzZXJuYW1lLnRvTG93ZXJDYXNlKCksIHMpKTsKaWYgKHNhdmVkLmxhc3RTZWVuKSBPYmplY3QuZW50cmllcyhzYXZlZC5sYXN0U2VlbikuZm9yRWFjaCgoW2ssIHZdKSA9PiBsYXN0U2Vlbi5zZXQoaywgdikpOwppZiAoc2F2ZWQubGFzdFNlbnQpIE9iamVjdC5lbnRyaWVzKHNhdmVkLmxhc3RTZW50KS5mb3JFYWNoKChbaywgdl0pID0+IGxhc3RTZW50LnNldChrLCB2KSk7Cgpjb25zb2xlLmxvZygifiQgUmVzdG9yZWQgZGF0YSBmcm9tIHN0b3JhZ2UuanNvbiIpOwoKZnVuY3Rpb24gc2F2ZVN0b3JhZ2UoKSB7CiAgY29uc3QgZGF0YSA9IHsKICAgIGNvbXBsZXRlZDogQXJyYXkuZnJvbShjb21wbGV0ZWQudmFsdWVzKCkpLAogICAgcGVuZGluZzogQXJyYXkuZnJvbShwZW5kaW5nLnZhbHVlcygpKSwKICAgIHNlc3Npb25zOiBBcnJheS5mcm9tKHNlc3Npb25zLnZhbHVlcygpKSwKICAgIGxhc3RTZWVuOiBPYmplY3QuZnJvbUVudHJpZXMobGFzdFNlZW4pLAogICAgbGFzdFNlbnQ6IE9iamVjdC5mcm9tRW50cmllcyhsYXN0U2VudCkKICB9OwogIGZzLndyaXRlRmlsZVN5bmMoU1RPUkFHRV9GSUxFLCBKU09OLnN0cmluZ2lmeShkYXRhLCBudWxsLCAyKSk7Cn0KCi8vIExvYWQgZXhpc3RpbmcgZGF0YSBmcm9tIGRpc2sgb24gYm9vdAppZiAoZnMuZXhpc3RzU3luYyhHQUdfRklMRSkpIHsKICB0cnkgewogICAgY29uc3QgcmF3ID0gZnMucmVhZEZpbGVTeW5jKEdBR19GSUxFLCAidXRmOCIpOwogICAgY29uc3Qgb2JqID0gSlNPTi5wYXJzZShyYXcpOwogICAgT2JqZWN0LmVudHJpZXMob2JqKS5mb3JFYWNoKChbdXNlciwgZGF0YV0pID0+IGdhZ0RhdGFTdG9yZS5zZXQodXNlciwgZGF0YSkpOwogICAgY29uc29sZS5sb2coIuKchSBMb2FkZWQgZ2FnZGF0YS5qc29uIik7CiAgfSBjYXRjaCAoZSkgewogICAgY29uc29sZS5lcnJvcigi4pqg77iPIEZhaWxlZCBsb2FkaW5nIGdhZ2RhdGEuanNvbjoiLCBlKTsKICB9Cn0KCi8vIEhlbHBlciB0byB3cml0ZSBvbiB1cGRhdGVzCmZ1bmN0aW9uIHNhdmVHQUcoKSB7CiAgY29uc3Qgb3V0ID0gT2JqZWN0LmZyb21FbnRyaWVzKGdhZ0RhdGFTdG9yZSk7CiAgZnMud3JpdGVGaWxlU3luYyhHQUdfRklMRSwgSlNPTi5zdHJpbmdpZnkob3V0LCBudWxsLCAyKSk7Cn0KCmFwcC5nZXQoIi8iLCAocmVxLCByZXMpID0+IHsKICByZXMuc2VuZChgCjwhRE9DVFlQRSBodG1sPgo8aHRtbCBsYW5nPSJpZCI+CjxoZWFkPgogIDxtZXRhIGNoYXJzZXQ9IlVURi04IiAvPgogIDxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsaW5pdGlhbC1zY2FsZT0xIiAvPgogIDx0aXRsZT5XRUxDT01FIFRPIEFGS0FSU1RPUkU8L3RpdGxlPgogIDxzdHlsZT4KICAgIGJvZHkgewogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gYm90dG9tIHJpZ2h0LCAjMGYxNzJhLCAjMWUzYThhKTsKICAgICAgY29sb3I6ICNlY2VjZWM7CiAgICAgIGZvbnQtZmFtaWx5OiAnSW50ZXInLCBBcmlhbCwgc2Fucy1zZXJpZjsKICAgICAgbWFyZ2luOiAwOwogICAgICBwYWRkaW5nOiAyMHB4OwogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgfQogICAgLmNvbnRhaW5lciB7CiAgICAgIHdpZHRoOiAxMDAlOwogICAgICBtYXgtd2lkdGg6IDQyMHB4OwogICAgfQogICAgLmNhcmQgewogICAgICBiYWNrZ3JvdW5kOiAjMjMyMzJiOwogICAgICBib3JkZXItcmFkaXVzOiAxNHB4OwogICAgICBib3gtc2hhZG93OiAwIDJweCAxNnB4ICMwMDA2OwogICAgICBwYWRkaW5nOiAyMHB4OwogICAgICBtYXJnaW4tYm90dG9tOiAyMHB4OwogICAgfQogICAgaDEsIGgyIHsKICAgICAgY29sb3I6ICMzYjgyZjY7CiAgICAgIG1hcmdpbi10b3A6IDA7CiAgICB9CiAgICBoMiB7CiAgICAgIGZvbnQtc2l6ZTogMS4yZW07CiAgICAgIG1hcmdpbi10b3A6IDEuMmVtOwogICAgfQogICAgYSB7CiAgICAgIGNvbG9yOiAjMzhiZGY4OwogICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7CiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgfQogICAgYTpob3ZlciB7CiAgICAgIGNvbG9yOiAjM2I4MmY2OwogICAgfQogICAgdWwgewogICAgICBwYWRkaW5nLWxlZnQ6IDEuMmVtOwogICAgfQogIDwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CiAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgIDxkaXYgY2xhc3M9ImNhcmQiPgogICAgICA8aDE+V0VMQ09NRSBUTyBBRktBUlNUT1JFPC9oMT4KICAgICAgPHA+U2VsYW1hdCBkYXRhbmcgZGkgYmFnaWFuIGtlY2lsIGRhcmkgc3RvcmUgc2F5YSwgaW5pIGFkYWxhaCB0ZW1wYXQgZGltYW5hIHNheWEgbWVueWltcGFuIGluZm9ybWFzaSBqb2tpICh0aWRhayBha2FuIG1lbnlpbXBhbiBwYXNzd29yZCksIHNlbW9nYSBkZW5nYW4gYWRhbnlhIGluaSBtdW5na2luIGJpc2EgbWVtcGVybXVkYWggdW50dWsgcGVtYmVsaSBkYW4gcGVuam9raSAoc2F5YSBzZW5kaXJpIPCfl78pPC9wPgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJjYXJkIj4KICAgICAgPGgyPktlbmFwYSBQaWxpaCBBZmthcnN0b3JlPzwvaDI+CiAgICAgIDx1bD4KICAgICAgICA8bGk+SGFyZ2EgeWFuZyB0ZXJqYW5na2F1IChiaWFzYW55YSB0ZXJtdXJhaCBkaSBpdGVta3UpPC9saT4KICAgICAgICA8bGk+bWVtaWxpa2kgc2lzdGVtIG9ubGluZSBjaGVja2VyIChha2FuIGNlayBqaWthIGFrdW4gb25saW5lIGF0YXUgdGlkYWspPC9saT4KICAgICAgICA8bGk+b3RvbWF0aXMgbWVuZ2hpdHVuZyBrYXBhbiBzZWxlc2FpIG55YSBqb2tpPC9saT4KICAgICAgICA8bGk+YmxhIGJsYSBibGEgKG1hbGFzIHlhcHBpbmcpPC9saT4KICAgICAgPC91bD4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0iY2FyZCI+CiAgICAgIDxoMj5LbnAgTHUgQmlraW4gV2Vic2l0ZSBJbmk/PC9oMj4KICAgICAgPHA+Q3VrdXAgbGFuZ2thIHlnIHB1bnlhIHdlYnNpdGUgYnVhdCBqYWRpaW4gdG9vbCB1dGsgam9raSAoYXBhbGFnaSByb2Jsb3gg8J+YgikuIFNhbWJpbCBlbWcgc2VuZ2FqYSBiaWtpbiBwcm9qZWsga2VjaWwgc2FtYmlsIGJlbGFqYXIgYW1hIGNoYXRncHQuIERhbiBqdWdhIGJpYXIgYmVkYSBkYXJpIHlhbmcgbGFpbiwgbGViaWgga2VyZW4sIGRhbiBiZXJrdWFsaXRhcyB0aW5nZ2kuIHdhbGF1IG1hc2loIGJlcmtlbWJhbmcgZGFyaSBmaXR1cjIga2VyZW4gbGFpbm55YSwgaW5pIHVkaCBjdWt1cCBrZXJlbiBidWF0IGpva2kgcm9ibG94PC9wPgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJjYXJkIiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7Ij4KICAgICAgPHA+UGVuY2V0IDxhIGhyZWY9Ii9zdGF0dXMiIHRhcmdldD0iX2JsYW5rIj5EaXNpbmk8L2E+IGppa2EgYW5kYSBzZWRhbmcgaW5naW4gbWVsaWhhdCBzdGF0dXMgam9raSBrYWxpYW48L3A+CiAgICA8L2Rpdj4KICA8L2Rpdj4KPC9ib2R5Pgo8L2h0bWw+CiAgYCk7Cn0pOwoKLy8gPT09IEF1dGhlbnRpY2F0aW9uIE1pZGRsZXdhcmUgPT09CmZ1bmN0aW9uIHNhZmVSZWRpcmVjdCh1cmwpIHsKICAvLyBFbnN1cmUgcmVkaXJlY3QgcGF0aCBpcyBzYWZlIChpbnRlcm5hbCBvbmx5KQogIGlmICh0eXBlb2YgdXJsICE9PSAic3RyaW5nIikgcmV0dXJuICIvIjsKICBpZiAoIXVybC5zdGFydHNXaXRoKCIvIikpIHJldHVybiAiLyI7CiAgaWYgKHVybC5zdGFydHNXaXRoKCIvLyIpKSByZXR1cm4gIi8iOwogIHJldHVybiB1cmw7Cn0KCmZ1bmN0aW9uIHJlcXVpcmVBdXRoKHJlcSwgcmVzLCBuZXh0KSB7CiAgLy8gUHVibGljbHkgYWNjZXNzaWJsZSByb3V0ZXMKICBjb25zdCBvcGVuID0gWwogICAgIi9zdGF0dXMiLCAiL2xvZ2luIiwgIi9sb2dpbi1zdWJtaXQiLAogICAgIi90cmFjayIsICIvY2hlY2siLCAiL2NvbXBsZXRlIiwgIi9ib25kIiwgIi9qb2luIiwKICAgICIvc2VuZC1qb2IiLCAiL3N0YXJ0LWpvYiIsICIvc3RhdHVzLyIsICIvZ3JhcGgiLCAiL2Rpc2Nvbm5lY3RlZCIsCiAgICAiL2phZHdhbCIsICIvc2NoZWR1bGUiLCAiL2N1cnJlbnQtc3ViamVjdCIsICIvb3JkZXIiLAogICAgIi91cGxvYWQtZ2FnLWRhdGEiLCAiL2Rvd25sb2FkLWdhZy1kYXRhIgogIF07CiAgaWYgKG9wZW4uc29tZShwID0+IHJlcS5wYXRoLnN0YXJ0c1dpdGgocCkpKSByZXR1cm4gbmV4dCgpOwoKICAvLyBJZiBjb3JyZWN0IGNvb2tpZSBleGlzdHMsIGFsbG93IGFjY2VzcwogIGlmIChyZXEuY29va2llcz8uZGFzaF9hdXRoID09PSBEQVNIX1BBU1MpIHJldHVybiBuZXh0KCk7CgogIC8vIE5vdCBhdXRoZW50aWNhdGVkLCByZWRpcmVjdCB0byBsb2dpbiB3aXRoIHJlZGlyZWN0IHBhdGgKICBjb25zdCByZWRpcmVjdFRvID0gZW5jb2RlVVJJQ29tcG9uZW50KHNhZmVSZWRpcmVjdChyZXEub3JpZ2luYWxVcmwpKTsKICByZXR1cm4gcmVzLnJlZGlyZWN0KGAvbG9naW4/cmVkaXJlY3Q9JHtyZWRpcmVjdFRvfWApOwp9CmFwcC51c2UocmVxdWlyZUF1dGgpOwoKLy8gPT09IExvZ2luIFBhZ2UgPT09CmFwcC5nZXQoIi9sb2dpbiIsIChyZXEsIHJlcykgPT4gewogIGNvbnN0IHJlZGlyZWN0VG8gPSByZXEucXVlcnkucmVkaXJlY3QgfHwgIi8iOwogIGNvbnN0IGVycm9yTXNnID0gcmVxLnF1ZXJ5LmVycm9yID09PSAiMSIgPyAi4p2MIFdyb25nIHBhc3N3b3JkISIgOiAiIjsKCiAgcmVzLnNlbmQoYAogIDwhRE9DVFlQRSBodG1sPgogIDxodG1sIGxhbmc9ImlkIj4KICA8aGVhZD4KICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04IiAvPgogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiIC8+CiAgICA8dGl0bGU+TG9naW48L3RpdGxlPgogICAgPHN0eWxlPgogICAgICBib2R5IHsKICAgICAgICBtYXJnaW46IDA7CiAgICAgICAgaGVpZ2h0OiAxMDB2aDsKICAgICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjMWUzYThhLCAjOTMzM2VhKTsKICAgICAgICBjb2xvcjogI2VlZTsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgZm9udC1mYW1pbHk6ICdTZWdvZSBVSScsIHNhbnMtc2VyaWY7CiAgICAgIH0KICAgICAgLmZvcm0tY29udGFpbmVyIHsKICAgICAgICBiYWNrZ3JvdW5kOiAjMWYxZjI1OwogICAgICAgIHBhZGRpbmc6IDI0cHg7CiAgICAgICAgYm9yZGVyLXJhZGl1czogMTJweDsKICAgICAgICB3aWR0aDogOTAlOwogICAgICAgIG1heC13aWR0aDogMzIwcHg7CiAgICAgICAgYm94LXNoYWRvdzogMCA0cHggMThweCAjMDAwNjsKICAgICAgfQogICAgICAuZXJyb3IgewogICAgICAgIGNvbG9yOiAjZjg3MTcxOwogICAgICAgIG1hcmdpbi1ib3R0b206IDEycHg7CiAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgICB9CiAgICAgIC5mb3JtLWNvbnRhaW5lciBpbnB1dCwKICAgICAgLmZvcm0tY29udGFpbmVyIGJ1dHRvbiB7CiAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgcGFkZGluZzogMTJweDsKICAgICAgICBtYXJnaW46IDEwcHggMCAwOwogICAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgICBib3JkZXItcmFkaXVzOiA2cHg7CiAgICAgICAgZm9udC1zaXplOiAxNnB4OwogICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICAgIH0KICAgICAgaW5wdXQgewogICAgICAgIGJhY2tncm91bmQ6ICMyYTJhMzM7CiAgICAgICAgY29sb3I6ICNlZWU7CiAgICAgIH0KICAgICAgYnV0dG9uIHsKICAgICAgICBiYWNrZ3JvdW5kOiAjM2I4MmY2OwogICAgICAgIGNvbG9yOiAjZmZmOwogICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICBmb250LXdlaWdodDogYm9sZDsKICAgICAgICBtYXJnaW4tdG9wOiAxNHB4OwogICAgICB9CiAgICA8L3N0eWxlPgogIDwvaGVhZD4KICA8Ym9keT4KICAgIDxmb3JtIGNsYXNzPSJmb3JtLWNvbnRhaW5lciIgbWV0aG9kPSJQT1NUIiBhY3Rpb249Ii9sb2dpbi1zdWJtaXQ/cmVkaXJlY3Q9JHtlbmNvZGVVUklDb21wb25lbnQocmVkaXJlY3RUbyl9Ij4KICAgICAgPGgyIHN0eWxlPSJtYXJnaW4tYm90dG9tOiAxMHB4OyB0ZXh0LWFsaWduOmNlbnRlcjsiPvCflJAgRGFzaGJvYXJkIExvZ2luPC9oMj4KICAgICAgJHtlcnJvck1zZyA/IGA8ZGl2IGNsYXNzPSJlcnJvciI+JHtlcnJvck1zZ308L2Rpdj5gIDogIiJ9CiAgICAgIDxpbnB1dCB0eXBlPSJwYXNzd29yZCIgbmFtZT0icGFzc3dvcmQiIHBsYWNlaG9sZGVyPSJFbnRlciBwYXNzd29yZCIgcmVxdWlyZWQgLz4KICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiPkxvZ2luPC9idXR0b24+CiAgICA8L2Zvcm0+CiAgPC9ib2R5PgogIDwvaHRtbD4KICBgKTsKfSk7CgovLyA9PT0gSGFuZGxlIExvZ2luIFN1Ym1pc3Npb24gPT09CmFwcC5wb3N0KCIvbG9naW4tc3VibWl0IiwgZXhwcmVzcy51cmxlbmNvZGVkKHsgZXh0ZW5kZWQ6IHRydWUgfSksIChyZXEsIHJlcykgPT4gewogIGNvbnN0IHsgcGFzc3dvcmQgfSA9IHJlcS5ib2R5OwogIGNvbnN0IHJlZGlyZWN0VG8gPSBzYWZlUmVkaXJlY3QocmVxLnF1ZXJ5LnJlZGlyZWN0IHx8ICIvIik7CgogIC8vIFdyb25nIHBhc3N3b3JkLCByZWRpcmVjdCBiYWNrIHRvIGxvZ2luIHdpdGggZXJyb3IKICBpZiAocGFzc3dvcmQgIT09IERBU0hfUEFTUykgewogICAgcmV0dXJuIHJlcy5yZWRpcmVjdChgL2xvZ2luP3JlZGlyZWN0PSR7ZW5jb2RlVVJJQ29tcG9uZW50KHJlZGlyZWN0VG8pfSZlcnJvcj0xYCk7CiAgfQoKICAvLyBTZXQgYXV0aGVudGljYXRpb24gY29va2llIChIVFRQIG9ubHkpCiAgcmVzLmNvb2tpZSgiZGFzaF9hdXRoIiwgREFTSF9QQVNTLCB7IGh0dHBPbmx5OiB0cnVlIH0pOwoKICAvLyBSZWRpcmVjdCB0byBvcmlnaW5hbGx5IHJlcXVlc3RlZCBwYWdlIChzYWZlKQogIHJlcy5yZWRpcmVjdChyZWRpcmVjdFRvKTsKfSk7CgovLyA9PT0gRGFzaGJvYXJkCmFwcC5nZXQoIi9kYXNoYm9hcmQiLCAocmVxLCByZXMpID0+IHsKICBjb25zdCBub3cgPSBEYXRlLm5vdygpOwoKICBmdW5jdGlvbiBmb3JtYXRBbW91bnQocykgewogICAgaWYgKHMudHlwZSA9PT0gImJvbmRzIikgcmV0dXJuIGAkeyhzLmN1cnJlbnRfYm9uZHMgLSBzLnN0YXJ0X2JvbmRzKSB8fCAwfSBib25kc2A7CiAgICBpZiAocy5zdGFydFRpbWUgJiYgcy5lbmRUaW1lKSB7CiAgICAgIGNvbnN0IG1pbnV0ZXMgPSBNYXRoLnJvdW5kKChzLmVuZFRpbWUgLSBzLnN0YXJ0VGltZSkgLyA2MDAwMCk7CiAgICAgIHJldHVybiBgJHttaW51dGVzfSBtaW5gOwogICAgfQogICAgcmV0dXJuICItIjsKICB9CgogIGZ1bmN0aW9uIHJlbmRlclJvd3MoaXRlbXMsIHR5cGUpIHsKICAgIGlmICghaXRlbXMubGVuZ3RoKSB7CiAgICAgIHJldHVybiBgPHRyPjx0ZCBjb2xzcGFuPSI2IiBzdHlsZT0iY29sb3I6I2FhYTt0ZXh0LWFsaWduOmNlbnRlcjsiPk5vICR7dHlwZX0gc2Vzc2lvbnM8L3RkPjwvdHI+YDsKICAgIH0KICAgIHJldHVybiBpdGVtcy5tYXAocyA9PiBgCiAgICAgIDx0cj4KICAgICAgICA8dGQ+JHtzLnVzZXJuYW1lfTwvdGQ+CiAgICAgICAgPHRkPiR7cy5ub19vcmRlciB8fCAiLSJ9PC90ZD4KICAgICAgICA8dGQ+JHtzLm5hbWFfc3RvcmUgfHwgIi0ifTwvdGQ+CiAgICAgICAgPHRkPiR7cy50eXBlIHx8ICJhZmsifTwvdGQ+CiAgICAgICAgPHRkPiR7Zm9ybWF0QW1vdW50KHMpfTwvdGQ+CiAgICAgICAgPHRkPgogICAgICAgICAgJHt0eXBlID09PSAiYWN0aXZlIiA/IGAKICAgICAgICAgICAgPGZvcm0gbWV0aG9kPSJHRVQiIGFjdGlvbj0iL2NhbmNlbC8ke3MudXNlcm5hbWV9Ij4KICAgICAgICAgICAgICA8YnV0dG9uIHN0eWxlPSJwYWRkaW5nOjRweCA4cHg7YmFja2dyb3VuZDojZWY0NDQ0O2NvbG9yOiNmZmY7Ym9yZGVyOm5vbmU7Ym9yZGVyLXJhZGl1czo0cHg7Ij7inJY8L2J1dHRvbj4KICAgICAgICAgICAgPC9mb3JtPgogICAgICAgICAgYCA6ICLigJMifQogICAgICAgIDwvdGQ+CiAgICAgIDwvdHI+CiAgICBgKS5qb2luKCIiKTsKICB9CgogIGNvbnN0IHBlbmRMaXN0ID0gQXJyYXkuZnJvbShwZW5kaW5nLnZhbHVlcygpKTsKICBjb25zdCBhY3RpdmVMaXN0ID0gQXJyYXkuZnJvbShzZXNzaW9ucy52YWx1ZXMoKSk7CiAgY29uc3QgY29tcGxldGVkTGlzdCA9IEFycmF5LmZyb20oY29tcGxldGVkLnZhbHVlcygpKTsKCiAgcmVzLnNlbmQoYAo8IURPQ1RZUEUgaHRtbD4KPGh0bWwgbGFuZz0iZW4iPgo8aGVhZD4KICA8bWV0YSBjaGFyc2V0PSJVVEYtOCI+CiAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCxpbml0aWFsLXNjYWxlPTEuMCI+CiAgPHRpdGxlPkRhc2hib2FyZDwvdGl0bGU+CiAgPHN0eWxlPgogICAgYm9keSB7CiAgICAgIG1hcmdpbjowOyBwYWRkaW5nOjIwcHg7CiAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCgxMzVkZWcsICMwZjBmMWIsICMxMjI2YTUpOwogICAgICBjb2xvcjojZWNlY2VjOwogICAgICBmb250LWZhbWlseTonSW50ZXInLEFyaWFsLHNhbnMtc2VyaWY7CiAgICAgIG1pbi1oZWlnaHQ6IDEwMHZoOwogICAgfQogICAgLmNvbnRhaW5lciB7IG1heC13aWR0aDoxMDAwcHg7IG1hcmdpbjphdXRvOyB9CiAgICBoMSB7IGNvbG9yOiMzYjgyZjY7IHRleHQtYWxpZ246Y2VudGVyOyB9CiAgICAuY2FyZCB7CiAgICAgIGJhY2tncm91bmQ6IzFkMWQyODsKICAgICAgcGFkZGluZzoyMHB4OwogICAgICBtYXJnaW4tYm90dG9tOjIwcHg7CiAgICAgIGJvcmRlci1yYWRpdXM6MTRweDsKICAgICAgYm94LXNoYWRvdzowIDRweCAyMHB4ICMwMDA4OwogICAgfQogICAgaW5wdXQsIHNlbGVjdCwgYnV0dG9uIHsKICAgICAgd2lkdGg6MTAwJTsKICAgICAgcGFkZGluZzoxMnB4OwogICAgICBtYXJnaW4tdG9wOjhweDsKICAgICAgYm9yZGVyOm5vbmU7CiAgICAgIGJvcmRlci1yYWRpdXM6NnB4OwogICAgICBiYWNrZ3JvdW5kOiMyYTJhMzM7CiAgICAgIGNvbG9yOiNlZWU7CiAgICAgIGZvbnQtc2l6ZToxNnB4OwogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgfQogICAgYnV0dG9uIHsgYmFja2dyb3VuZDojM2I4MmY2OyBmb250LXdlaWdodDpib2xkOyBjdXJzb3I6cG9pbnRlcjsgfQogICAgdGFibGUgewogICAgICB3aWR0aDoxMDAlOwogICAgICBib3JkZXItY29sbGFwc2U6Y29sbGFwc2U7CiAgICAgIG1hcmdpbi10b3A6MTZweDsKICAgICAgZm9udC1zaXplOjE0cHg7CiAgICB9CiAgICB0aCx0ZCB7CiAgICAgIHBhZGRpbmc6MTBweDsKICAgICAgYm9yZGVyLWJvdHRvbToxcHggc29saWQgIzMzMzsKICAgICAgdGV4dC1hbGlnbjpsZWZ0OwogICAgfQogICAgdGggewogICAgICBiYWNrZ3JvdW5kOiMyYTJhMzM7CiAgICAgIGNvbG9yOiNlZWU7CiAgICB9CiAgICAuYm90dG9tLWJ1dHRvbnMgewogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGdhcDoxMHB4OwogICAgICBtYXJnaW46MjBweCAwOwogICAgfQogICAgLmJvdHRvbS1idXR0b25zIGZvcm0geyBmbGV4OjE7IH0KICAgIC5ib3R0b20tYnV0dG9ucyBidXR0b24gewogICAgICB3aWR0aDoxMDAlOwogICAgICBwYWRkaW5nOjEycHg7CiAgICAgIGJvcmRlcjpub25lOwogICAgICBib3JkZXItcmFkaXVzOjZweDsKICAgICAgY29sb3I6I2ZmZjsKICAgICAgZm9udC1zaXplOjE2cHg7CiAgICAgIGN1cnNvcjpwb2ludGVyOwogICAgfQogICAgLnNodXRkb3duLWJ0biB7IGJhY2tncm91bmQ6I2VmNDQ0NDsgfQogICAgLnVwZGF0ZS1idG4geyBiYWNrZ3JvdW5kOiMxMGI5ODE7IH0KICAgIC52ZXJzaW9uIHsKICAgICAgdGV4dC1hbGlnbjpjZW50ZXI7CiAgICAgIGZvbnQtc2l6ZToxNHB4OwogICAgICBjb2xvcjojYWFhOwogICAgfQogICAgQG1lZGlhKG1heC13aWR0aDo3NjhweCl7CiAgICAgIGlucHV0LCBzZWxlY3QsIGJ1dHRvbiB7IGZvbnQtc2l6ZToxOHB4OyB9CiAgICAgIHRhYmxlIHsgZm9udC1zaXplOjEycHg7IH0KICAgIH0KICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5PgogIDxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CiAgICA8aDE+Sm9iIERhc2hib2FyZDwvaDE+CgogICAgPGRpdiBjbGFzcz0iY2FyZCI+CiAgICAgIDxoMj5DcmVhdGUgTmV3IEpvYjwvaDI+CiAgICAgIDxmb3JtIGlkPSJqb2JGb3JtIj4KICAgICAgICA8aW5wdXQgbmFtZT0idXNlcm5hbWUiIHBsYWNlaG9sZGVyPSJVc2VybmFtZSIgcmVxdWlyZWQgLz4KICAgICAgICA8aW5wdXQgbmFtZT0ibm9fb3JkZXIiIHBsYWNlaG9sZGVyPSJPcmRlciBJRCIgcmVxdWlyZWQgLz4KICAgICAgICA8aW5wdXQgbmFtZT0ibmFtYV9zdG9yZSIgcGxhY2Vob2xkZXI9IlN0b3JlIE5hbWUiIHJlcXVpcmVkIC8+CiAgICAgICAgPGlucHV0IG5hbWU9ImphbV9zZWxlc2FpX2pva2kiIHR5cGU9Im51bWJlciIgc3RlcD0iYW55IiBwbGFjZWhvbGRlcj0iRHVyYXRpb24gKGhvdXJzKSIgLz4KICAgICAgICA8aW5wdXQgbmFtZT0idGFyZ2V0X2JvbmQiIHR5cGU9Im51bWJlciIgcGxhY2Vob2xkZXI9IlRhcmdldCBCb25kIChmb3IgYm9uZHMpIiAvPgogICAgICAgIDxzZWxlY3QgbmFtZT0idHlwZSIgcmVxdWlyZWQ+CiAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJhZmsiPkFGSzwvb3B0aW9uPgogICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iYm9uZHMiPkJvbmRzPC9vcHRpb24+CiAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiPvCfmoAgU3RhcnQgSm9iPC9idXR0b24+CiAgICAgIDwvZm9ybT4KICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9ImNhcmQiPgogICAgICA8aDI+UGVuZGluZyBKb2JzPC9oMj4KICAgICAgPGRpdiBzdHlsZT0ib3ZlcmZsb3cteDphdXRvOyI+CiAgICAgICAgPHRhYmxlPgogICAgICAgICAgPHRyPjx0aD5Vc2VybmFtZTwvdGg+PHRoPk9yZGVyPC90aD48dGg+U3RvcmU8L3RoPjx0aD5UeXBlPC90aD48dGg+SW5mbzwvdGg+PHRoPkFjdGlvbjwvdGg+PC90cj4KICAgICAgICAgICR7cmVuZGVyUm93cyhwZW5kTGlzdCwgInBlbmRpbmciKX0KICAgICAgICA8L3RhYmxlPgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9ImNhcmQiPgogICAgICA8aDI+QWN0aXZlIEpvYnM8L2gyPgogICAgICA8ZGl2IHN0eWxlPSJvdmVyZmxvdy14OmF1dG87Ij4KICAgICAgICA8dGFibGU+CiAgICAgICAgICA8dHI+PHRoPlVzZXJuYW1lPC90aD48dGg+T3JkZXI8L3RoPjx0aD5TdG9yZTwvdGg+PHRoPlR5cGU8L3RoPjx0aD5JbmZvPC90aD48dGg+QWN0aW9uPC90aD48L3RyPgogICAgICAgICAgJHtyZW5kZXJSb3dzKGFjdGl2ZUxpc3QsICJhY3RpdmUiKX0KICAgICAgICA8L3RhYmxlPgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9ImNhcmQiPgogICAgICA8aDI+Q29tcGxldGVkIEpvYnM8L2gyPgogICAgICA8ZGl2IHN0eWxlPSJvdmVyZmxvdy14OmF1dG87Ij4KICAgICAgICA8dGFibGU+CiAgICAgICAgICA8dHI+PHRoPlVzZXJuYW1lPC90aD48dGg+T3JkZXI8L3RoPjx0aD5TdG9yZTwvdGg+PHRoPlR5cGU8L3RoPjx0aD5JbmZvPC90aD48dGg+QWN0aW9uPC90aD48L3RyPgogICAgICAgICAgJHtyZW5kZXJSb3dzKGNvbXBsZXRlZExpc3QsICJjb21wbGV0ZWQiKX0KICAgICAgICA8L3RhYmxlPgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9ImJvdHRvbS1idXR0b25zIj4KICAgICAgPGZvcm0gbWV0aG9kPSJQT1NUIiBhY3Rpb249Ii9zaHV0ZG93biI+CiAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGNsYXNzPSJzaHV0ZG93bi1idG4iPvCflLQgU2h1dGRvd248L2J1dHRvbj4KICAgICAgPC9mb3JtPgogICAgICA8Zm9ybSBtZXRob2Q9IlBPU1QiIGFjdGlvbj0iL3Jlc3RhcnQiPgogICAgICAgIDxidXR0b24gdHlwZT0ic3VibWl0IiBjbGFzcz0idXBkYXRlLWJ0biI+8J+foiBVcGRhdGU8L2J1dHRvbj4KICAgICAgPC9mb3JtPgogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0idmVyc2lvbiI+CiAgICAgIHZlcnNpb246ICR7dmVyc2lvbn08YnI+CiAgICAgICR7Y2hhbmdlbG9nLm1hcChsID0+IGDigKIgJHtsfWApLmpvaW4oIjxicj4iKX0KICAgIDwvZGl2PgogIDwvZGl2PgoKICA8c2NyaXB0PgogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImpvYkZvcm0iKS5vbnN1Ym1pdCA9IGFzeW5jIGUgPT4gewogICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgIGNvbnN0IGRhdGEgPSBPYmplY3QuZnJvbUVudHJpZXMobmV3IEZvcm1EYXRhKGUudGFyZ2V0KSk7CiAgICAgIGF3YWl0IGZldGNoKCIvc3RhcnQtam9iIiwgewogICAgICAgIG1ldGhvZDogIlBPU1QiLAogICAgICAgIGhlYWRlcnM6IHsgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiB9LAogICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpCiAgICAgIH0pOwogICAgICBsb2NhdGlvbi5yZWxvYWQoKTsKICAgIH07CiAgPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPgogIGApOwp9KTsKCi8vID09PSAvdHJhY2sgRW5kcG9pbnQgPT09CmFwcC5wb3N0KCcvdHJhY2snLCAocmVxLCByZXMpID0+IHsKICAgIGNvbnN0IHsgdXNlcm5hbWUgfSA9IHJlcS5ib2R5OwogICAgaWYgKCF1c2VybmFtZSkgewogICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnTWlzc2luZyB1c2VybmFtZScgfSk7CiAgICB9CgogICAgY29uc3QgdXNlciA9IHVzZXJuYW1lLnRvTG93ZXJDYXNlKCk7IC8vIE5vcm1hbGl6ZSB1c2VybmFtZQoKICAgIGxldCBqb2IgPSBzZXNzaW9ucy5nZXQodXNlcik7CgogICAgLy8gSWYgbm90IGluIHNlc3Npb25zLCBidXQgaW4gcGVuZGluZzogbW92ZSB0byBzZXNzaW9ucyEKICAgIGlmICgham9iKSB7CiAgICAgICAgam9iID0gcGVuZGluZy5nZXQodXNlcik7CiAgICAgICAgaWYgKGpvYikgewogICAgICAgICAgICBwZW5kaW5nLmRlbGV0ZSh1c2VyKTsKICAgICAgICAgICAgLy8gQXNzdW1lIGpvYi5zdGFydFRpbWUgYW5kIGpvYi5lbmRUaW1lIGFyZSBhbHdheXMgc2V0CiAgICAgICAgICAgIHNlc3Npb25zLnNldCh1c2VyLCBqb2IpOwogICAgICAgICAgICBzYXZlU3RvcmFnZSgpOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAnTm8gam9iIGZvdW5kIGZvciB0aGlzIHVzZXInIH0pOwogICAgICAgIH0KICAgIH0KICAgIGxhc3RTZWVuLnNldCh1c2VyLCBEYXRlLm5vdygpKTsKICAgIHJlcy5qc29uKHsKICAgICAgICBlbmRUaW1lOiBqb2IuZW5kVGltZSwKICAgICAgICBzdGFydFRpbWU6IGpvYi5zdGFydFRpbWUsCiAgICAgICAgZHVyYXRpb246IGpvYi5kdXJhdGlvbgogICAgfSk7Cn0pOwoKLy8gPT09IC9zdGFydC1qb2IgPT09CmFwcC5wb3N0KCIvc3RhcnQtam9iIiwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7CiAgY29uc3QgewogICAgdXNlcm5hbWUsCiAgICBub19vcmRlciwKICAgIG5hbWFfc3RvcmUsCiAgICBqYW1fc2VsZXNhaV9qb2tpLAogICAgdGFyZ2V0X2JvbmQsCiAgICB0eXBlCiAgfSA9IHJlcS5ib2R5OwoKICBjb25zdCB1c2VyID0gdXNlcm5hbWUudG9Mb3dlckNhc2UoKTsKICBjb25zdCBub3cgPSBEYXRlLm5vdygpOwogIGNvbnN0IGhvdXJzID0gcGFyc2VGbG9hdChqYW1fc2VsZXNhaV9qb2tpIHx8ICIwIikgfHwgMDsKICBjb25zdCBlbmRUaW1lID0gbm93ICsgaG91cnMgKiAzNjAwICogMTAwMDsKCiAgY29uc3Qgc2Vzc2lvbiA9IHsKICAgIHVzZXJuYW1lLAogICAgbm9fb3JkZXIsCiAgICBuYW1hX3N0b3JlLAogICAgZW5kVGltZSwKICAgIHR5cGUsCiAgICBzdGFydF9ib25kczogMCwKICAgIGN1cnJlbnRfYm9uZHM6IDAsCiAgICB0YXJnZXRfYm9uZDogcGFyc2VJbnQodGFyZ2V0X2JvbmQgfHwgIjAiKSwKICAgIHN0YXJ0VGltZTogbm93CiAgfTsKCiAgcGVuZGluZy5zZXQodXNlciwgc2Vzc2lvbik7CiAgc2F2ZVN0b3JhZ2UoKTsKCiAgLy8gU2VuZCBlbWJlZCB0byBEaXNjb3JkICh5ZWxsb3cgZm9yIHN0YXJ0KQogIGNvbnN0IGVtYmVkID0gewogICAgZW1iZWRzOiBbewogICAgICB0aXRsZTogYPCfmoAgTmV3IEpva2kgU3RhcnRlZCDigJMgJHt1c2VybmFtZX1gLAogICAgICBkZXNjcmlwdGlvbjogYCoqVHlwZToqKiAke3R5cGV9XG4qKk9yZGVyOioqICR7bm9fb3JkZXJ9XG4qKlN0b3JlOioqICR7bmFtYV9zdG9yZX1gLAogICAgICBjb2xvcjogMHhmZmQ3MDAsCiAgICAgIGZpZWxkczogW3sKICAgICAgICBuYW1lOiAiRW5kIFRpbWUiLAogICAgICAgIHZhbHVlOiBgPHQ6JHtNYXRoLmZsb29yKGVuZFRpbWUgLyAxMDAwKX06Uj5gLAogICAgICAgIGlubGluZTogdHJ1ZQogICAgICB9LCB7CiAgICAgICAgbmFtZTogIlN0YXJ0IFRpbWUiLAogICAgICAgIHZhbHVlOiBgPHQ6JHtNYXRoLmZsb29yKG5vdyAvIDEwMDApfTpGPmAsCiAgICAgICAgaW5saW5lOiB0cnVlCiAgICAgIH1dCiAgICB9XQogIH07CgogIGZldGNoKGBodHRwczovL2Rpc2NvcmQuY29tL2FwaS92MTAvY2hhbm5lbHMvJHtDSEFOTkVMfS9tZXNzYWdlc2AsIHsKICAgIG1ldGhvZDogIlBPU1QiLAogICAgaGVhZGVyczogewogICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICBBdXRob3JpemF0aW9uOiBgQm90ICR7Qk9UX1RPS0VOfWAKICAgIH0sCiAgICBib2R5OiBKU09OLnN0cmluZ2lmeShlbWJlZCkKICB9KS5jYXRjaChjb25zb2xlLmVycm9yKTsKCiAgcmVzLmpzb24oeyBvazogdHJ1ZSB9KTsKfSk7CgovLyA9PT0gL2NhbmNlbC86dXNlcm5hbWUgPT09CmFwcC5nZXQoIi9jYW5jZWwvOnVzZXJuYW1lIiwgKHJlcSwgcmVzKSA9PiB7CiAgY29uc3QgdW5hbWUgPSByZXEucGFyYW1zLnVzZXJuYW1lLnRvTG93ZXJDYXNlKCk7CiAgaWYgKHBlbmRpbmcuaGFzKHVuYW1lKSkgcGVuZGluZy5kZWxldGUodW5hbWUpOwogIGlmIChzZXNzaW9ucy5oYXModW5hbWUpKSBzZXNzaW9ucy5kZWxldGUodW5hbWUpOwogIHNhdmVTdG9yYWdlKCk7CiAgcmVzLnJlZGlyZWN0KCIvZGFzaGJvYXJkIik7Cn0pOwoKLy8gPT09IGJvbmQKYXBwLnBvc3QoIi9ib25kIiwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7CiAgY29uc3QgeyB1c2VybmFtZSwgYm9uZHMsIHBsYWNlSWQsIGFsZXJ0IH0gPSByZXEuYm9keTsKCiAgaWYgKCF1c2VybmFtZSkgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICJNaXNzaW5nIHVzZXJuYW1lIiB9KTsKCiAgY29uc3QgdXNlciA9IHVzZXJuYW1lLnRvTG93ZXJDYXNlKCk7CiAgY29uc3Qgc2Vzc2lvbiA9IHNlc3Npb25zLmdldCh1c2VyKTsKCiAgLy8g8J+foSBIYW5kbGUgaWRsZSBhbGVydCBmcm9tIGxvYmJ5CiAgaWYgKGFsZXJ0ID09PSAibG9iYnlfaWRsZSIpIHsKICAgIGF3YWl0IGZldGNoKGBodHRwczovL2Rpc2NvcmQuY29tL2FwaS92MTAvY2hhbm5lbHMvJHtDSEFOTkVMfS9tZXNzYWdlc2AsIHsKICAgICAgbWV0aG9kOiAiUE9TVCIsCiAgICAgIGhlYWRlcnM6IHsKICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgIEF1dGhvcml6YXRpb246IGBCb3QgJHtCT1RfVE9LRU59YAogICAgICB9LAogICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgY29udGVudDogYOKaoO+4jyBAZXZlcnlvbmUgJHt1c2VybmFtZX0gaGFzIGJlZW4gaWRsZSBpbiB0aGUgbG9iYnkgZm9yIHRvbyBsb25nLmAKICAgICAgfSkKICAgIH0pLmNhdGNoKGNvbnNvbGUuZXJyb3IpOwogICAgcmV0dXJuIHJlcy5qc29uKHsgb2s6IHRydWUsIGFsZXJ0OiAiaWRsZV9zZW50IiB9KTsKICB9CgogIC8vIPCfn6IgVXBkYXRlIGFjdGl2ZSBzZXNzaW9uCiAgaWYgKHNlc3Npb24pIHsKICAgIHNlc3Npb24ubGFzdFBsYWNlSWQgPSBwbGFjZUlkOwogICAgc2Vzc2lvbi5jdXJyZW50X2JvbmRzID0gYm9uZHM7CgogICAgaWYgKHNlc3Npb24uc3RhcnRfYm9uZHMgPT09IHVuZGVmaW5lZCB8fCBzZXNzaW9uLnN0YXJ0X2JvbmRzID09PSAwKSB7CiAgICAgIHNlc3Npb24uc3RhcnRfYm9uZHMgPSBib25kczsKICAgIH0KCiAgICAvLyBDaGVjayBpZiBib25kIGdvYWwgbWV0CiAgICBpZiAoCiAgICAgIHNlc3Npb24udHlwZSA9PT0gImJvbmRzIiAmJgogICAgICBzZXNzaW9uLnRhcmdldF9ib25kICYmCiAgICAgIChib25kcyAtIHNlc3Npb24uc3RhcnRfYm9uZHMgPj0gc2Vzc2lvbi50YXJnZXRfYm9uZCkKICAgICkgewogICAgICBjb25zdCBub3cgPSBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKTsKICAgICAgY29uc3QgY2xlYW4gPSBzZXNzaW9uLm5vX29yZGVyLnJlcGxhY2UoL15PRDAwMDAwMC8sICIiKTsKCiAgICAgIC8vIOKchSBOb3RpZnkgRGlzY29yZAogICAgICBhd2FpdCBmZXRjaChgaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdjEwL2NoYW5uZWxzLyR7Q0hBTk5FTH0vbWVzc2FnZXNgLCB7CiAgICAgICAgbWV0aG9kOiAiUE9TVCIsCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCb3QgJHtCT1RfVE9LRU59YAogICAgICAgIH0sCiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgZW1iZWRzOiBbewogICAgICAgICAgICB0aXRsZTogIuKchSAqKkpPS0kgQ09NUExFVEVEKioiLAogICAgICAgICAgICBkZXNjcmlwdGlvbjoKICAgICAgICAgICAgICBgKipVc2VybmFtZToqKiAke3Nlc3Npb24udXNlcm5hbWV9XG5gICsKICAgICAgICAgICAgICBgKipPcmRlciBJRDoqKiAke3Nlc3Npb24ubm9fb3JkZXJ9XG5gICsKICAgICAgICAgICAgICBgW/CflJcgVmlldyBPcmRlcl0oaHR0cHM6Ly90b2tva3UuaXRlbWt1LmNvbS9yaXdheWF0LXBlc2FuYW4vcmluY2lhbi8ke2NsZWFufSlcblxuYCArCiAgICAgICAgICAgICAgYOKPsCBDb21wbGV0ZWQgYXQ6IDx0OiR7bm93fTpmPmAsCiAgICAgICAgICAgIGZvb3RlcjogeyB0ZXh0OiBgLSAke3Nlc3Npb24ubmFtYV9zdG9yZX1gIH0KICAgICAgICAgIH1dCiAgICAgICAgfSkKICAgICAgfSkuY2F0Y2goY29uc29sZS5lcnJvcik7CgogICAgICAvLyBNb3ZlIHRvIGNvbXBsZXRlZAogICAgICBzZXNzaW9uLmNvbXBsZXRlZEF0ID0gRGF0ZS5ub3coKTsKICAgICAgc2Vzc2lvbnMuZGVsZXRlKHVzZXIpOwogICAgICBsYXN0U2Vlbi5kZWxldGUodXNlcik7CiAgICAgIGNvbXBsZXRlZC5zZXQodXNlciwgc2Vzc2lvbik7CiAgICAgIHNhdmVTdG9yYWdlKCk7CgogICAgICByZXR1cm4gcmVzLmpzb24oeyBvazogdHJ1ZSwgY29tcGxldGVkOiB0cnVlIH0pOwogICAgfQoKICAgIC8vIFVwZGF0ZSBoZWFydGJlYXQKICAgIGxhc3RTZW50LnNldCh1c2VyLCBEYXRlLm5vdygpKTsKICAgIHNhdmVTdG9yYWdlKCk7CgogICAgcmV0dXJuIHJlcy5qc29uKHsgb2s6IHRydWUgfSk7CiAgfQoKICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogIk5vIGFjdGl2ZSBzZXNzaW9uIiB9KTsKfSk7CgovLyA9PT0gL3N0YXR1cyAoVUkgUGFnZSkKYXBwLmdldCgiL3N0YXR1cyIsIChyZXEsIHJlcykgPT4gewogIHJlcy5zZW5kKGA8IURPQ1RZUEUgaHRtbD4KPGh0bWwgbGFuZz0iaWQiPgo8aGVhZD4KICA8bWV0YSBjaGFyc2V0PSJVVEYtOCIvPgogIDxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MS4wIi8+CiAgPHRpdGxlPkNoZWNrIEpva2kgU3RhdHVzPC90aXRsZT4KICA8c3R5bGU+CiAgICBib2R5IHsKICAgICAgbWFyZ2luOiAwOyBwYWRkaW5nOiAwOwogICAgICBtaW4taGVpZ2h0OiAxMDB2aDsKICAgICAgZm9udC1mYW1pbHk6ICdJbnRlcicsIHNhbnMtc2VyaWY7CiAgICAgIGRpc3BsYXk6IGZsZXg7IGp1c3RpZnktY29udGVudDogY2VudGVyOyBhbGlnbi1pdGVtczogY2VudGVyOwogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gYm90dG9tIHJpZ2h0LCAjMGYxNzJhLCAjMWUzYThhKTsKICAgICAgY29sb3I6ICNlZWU7CiAgICB9CiAgICAubWFpbi1jb250YWluZXIgewogICAgICBiYWNrZ3JvdW5kOiByZ2JhKDM1LCAzNSwgNDUsIDAuOTUpOwogICAgICBib3JkZXItcmFkaXVzOiAxMnB4OwogICAgICBib3gtc2hhZG93OiAwIDJweCAxNnB4ICMwMDA4OwogICAgICBwYWRkaW5nOiAyMHB4OwogICAgICB3aWR0aDogOTAlOyBtYXgtd2lkdGg6IDUwMHB4OwogICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICB9CiAgICAuaW5wdXQtZ3JvdXAgewogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBtYXJnaW4tdG9wOiAxNnB4OwogICAgfQogICAgI3UgewogICAgICBmbGV4OiAxOwogICAgICBwYWRkaW5nOiAxMnB4OwogICAgICBmb250LXNpemU6IDE2cHg7CiAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgYm9yZGVyLXJhZGl1czogNHB4IDAgMCA0cHg7CiAgICAgIGJhY2tncm91bmQ6ICMyYTJhMzM7CiAgICAgIGNvbG9yOiAjZWVlOwogICAgfQogICAgYnV0dG9uIHsKICAgICAgcGFkZGluZzogMTJweCAxNnB4OwogICAgICBmb250LXNpemU6IDE2cHg7CiAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgYm9yZGVyLXJhZGl1czogMCA0cHggNHB4IDA7CiAgICAgIGJhY2tncm91bmQ6ICMzYjgyZjY7CiAgICAgIGNvbG9yOiB3aGl0ZTsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgfQogICAgLnN0YXR1cy1mcmFtZSB7CiAgICAgIG1hcmdpbi10b3A6IDIwcHg7CiAgICAgIHBhZGRpbmc6IDE2cHg7CiAgICAgIGJhY2tncm91bmQ6ICMyYzJjMzQ7CiAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgICAgYm94LXNoYWRvdzogMCAycHggMTBweCAjMDAwOwogICAgICB0ZXh0LWFsaWduOiBjZW50ZXI7CiAgICAgIHRyYW5zaXRpb246IGFsbCAwLjNzIGVhc2UtaW4tb3V0OwogICAgICBvcGFjaXR5OiAwOwogICAgICB0cmFuc2Zvcm06IHNjYWxlKDAuOTgpOwogICAgfQogICAgLnN0YXR1cy1mcmFtZS52aXNpYmxlIHsKICAgICAgb3BhY2l0eTogMTsKICAgICAgdHJhbnNmb3JtOiBzY2FsZSgxKTsKICAgIH0KICAgIC5xci1mcmFtZSB7CiAgICAgIG1hcmdpbi10b3A6IDIwcHg7CiAgICAgIHBhZGRpbmc6IDE2cHg7CiAgICAgIGJhY2tncm91bmQ6ICMxZjFmMjU7CiAgICAgIGJvcmRlci1yYWRpdXM6IDhweDsKICAgICAgdGV4dC1hbGlnbjogbGVmdDsKICAgICAgZm9udC1zaXplOiAxNHB4OwogICAgfQogICAgaDMgewogICAgICBtYXJnaW4tYm90dG9tOiA4cHg7CiAgICAgIGNvbG9yOiAjNjBhNWZhOwogICAgfQogIDwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CiAgPGRpdiBjbGFzcz0ibWFpbi1jb250YWluZXIiPgogICAgPGgyPvCflI0gQ2VrIFN0YXR1cyBKb2tpPC9oMj4KICAgIDxkaXYgY2xhc3M9ImlucHV0LWdyb3VwIj4KICAgICAgPGlucHV0IGlkPSJ1IiBwbGFjZWhvbGRlcj0iVXNlcm5hbWUgYXRhdSBPcmRlciBJRCIvPgogICAgICA8YnV0dG9uIG9uY2xpY2s9InN0YXJ0Q2hlY2soKSI+Q2hlY2s8L2J1dHRvbj4KICAgIDwvZGl2PgoKICAgIDxkaXYgaWQ9InIiIGNsYXNzPSJzdGF0dXMtZnJhbWUiPjwvZGl2PgoKICAgIDxkaXYgY2xhc3M9InFyLWZyYW1lIj4KICAgICAgPGgzPk1hdSBEaXNrb24gVW50dWsgUGVtYmVsaWFuIFNlbGFuanV0bnlhPzwvaDM+CiAgICAgIDxwPk1pbnRhIGtvZGUgUVJJUyBrZSBvd25lciB2aWEgV2hhdHNBcHAgdW50dWsgZGFwYXQgaGFyZ2EgbGViaWggbXVyYWguPC9wPgogICAgICA8aDM+QXBha2FoIFRpZGFrIEJpc2EgTWVuZGFwYXRrYW4gRGlza29uIERpIEl0ZW1rdT88L2gzPgogICAgICA8cD5LYXJlbmEgYWRhIHBhamFrIDEyJSBkYXJpIEl0ZW1rdSwgc2F5YSBoYW55YSBiaXNhIGJlcmlrYW4gaGFyZ2Egc2VnaXR1LiBJbmkgUVJJUyBzYXlhIHNlYmVsdW0gcGluZGFoIGtlIEl0ZW1rdS48L3A+CiAgICAgIDxoMz5EdWx1IEJlcmp1YWxhbiBEaW1hbmE/PC9oMz4KICAgICAgPHA+8J+kqzwvcD4KICAgIDwvZGl2PgogIDwvZGl2PgoKICA8c2NyaXB0PgogICAgbGV0IGludGVydmFsOwogICAgZnVuY3Rpb24gc3RhcnRDaGVjaygpIHsKICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7CiAgICAgIGNvbnN0IHEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndScpLnZhbHVlLnRyaW0oKTsKICAgICAgaWYgKCFxKSByZXR1cm47CiAgICAgIGNoZWNrKHEpOwogICAgICBpbnRlcnZhbCA9IHNldEludGVydmFsKCgpID0+IGNoZWNrKHEpLCAxMDAwKTsKICAgIH0KCiAgICBhc3luYyBmdW5jdGlvbiBjaGVjayhxKSB7CiAgICAgIGNvbnN0IG91dCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyJyk7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzID0gYXdhaXQgZmV0Y2goJy9zdGF0dXMvJyArIGVuY29kZVVSSUNvbXBvbmVudChxKSwgewogICAgICAgICAgaGVhZGVyczogeyAiQWNjZXB0IjogImFwcGxpY2F0aW9uL2pzb24iIH0KICAgICAgICB9KTsKICAgICAgICBjb25zdCBkID0gYXdhaXQgcmVzLmpzb24oKTsKCiAgICAgICAgb3V0LmNsYXNzTGlzdC5hZGQoJ3Zpc2libGUnKTsKCiAgICAgICAgaWYgKCFyZXMub2spIHsKICAgICAgICAgIG91dC5pbm5lckhUTUwgPSAn4p2MICcgKyBkLmVycm9yOwogICAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7CiAgICAgICAgICByZXR1cm47CiAgICAgICAgfQoKICAgICAgICBpZiAoZC5zdGF0dXMgPT09ICdwZW5kaW5nJykgewogICAgICAgICAgb3V0LmlubmVySFRNTCA9ICfijJsgPGI+JyArIGQudXNlcm5hbWUgKyAnPC9iPiBzZWRhbmcgbWVudW5nZ3UuLi4nOwogICAgICAgIH0gZWxzZSBpZiAoZC5zdGF0dXMgPT09ICdydW5uaW5nJyB8fCBkLnN0YXR1cyA9PT0gJ2luYWN0aXZlJykgewogICAgICAgICAgY29uc3QgcmVtID0gTWF0aC5tYXgoMCwgTWF0aC5mbG9vcigoZC5lbmRUaW1lIC0gRGF0ZS5ub3coKSkgLyAxMDAwKSk7CiAgICAgICAgICBjb25zdCBoID0gTWF0aC5mbG9vcihyZW0gLyAzNjAwKSwgbSA9IE1hdGguZmxvb3IoKHJlbSAlIDM2MDApIC8gNjApLCBzID0gcmVtICUgNjA7CiAgICAgICAgICBjb25zdCBsYXN0U2VlbkFnbyA9IE1hdGgubWF4KDAsIERhdGUubm93KCkgLSBkLmxhc3RTZWVuKTsKICAgICAgICAgIGNvbnN0IGxtID0gTWF0aC5mbG9vcihsYXN0U2VlbkFnbyAvIDYwMDAwKTsKICAgICAgICAgIGNvbnN0IGxzID0gTWF0aC5mbG9vcigobGFzdFNlZW5BZ28gJSA2MDAwMCkgLyAxMDAwKTsKCiAgICAgICAgICBsZXQgdGV4dCA9IChkLnN0YXR1cyA9PT0gJ2luYWN0aXZlJyA/ICfwn5S0ICcgOiAn8J+foiAnKSArICc8Yj4nICsgZC51c2VybmFtZSArICc8L2I+IGFrdGlmPGJyPic7CiAgICAgICAgICBpZiAoZC50eXBlID09PSAnYm9uZHMnKSB7CiAgICAgICAgICAgIHRleHQgKz0gJ/Cfk4ggR2FpbmVkOiAnICsgZC5nYWluZWQgKyAnIC8gJyArIGQudGFyZ2V0Qm9uZHMgKyAnIGJvbmRzPGJyPic7CiAgICAgICAgICB9IGVsc2UgewogICAgICAgICAgICB0ZXh0ICs9ICfij7MgVGltZSBsZWZ0OiAnICsgaCArICdoICcgKyBtICsgJ20gJyArIHMgKyAnczxicj4nOwogICAgICAgICAgfQogICAgICAgICAgdGV4dCArPSAn8J+Rge+4jyBMYXN0IHNlZW46ICcgKyBsbSArICdtICcgKyBscyArICdzIGFnbzxicj4nOwogICAgICAgICAgb3V0LmlubmVySFRNTCA9IHRleHQ7CiAgICAgICAgfSBlbHNlIGlmIChkLnN0YXR1cyA9PT0gJ2NvbXBsZXRlZCcpIHsKICAgICAgICAgIGxldCB0ZXh0ID0gJ+KchSA8Yj4nICsgZC51c2VybmFtZSArICc8L2I+IHNlbGVzYWk8YnI+JzsKICAgICAgICAgIHRleHQgKz0gJ/Cfp74gT3JkZXI6ICcgKyBkLm5vX29yZGVyICsgJzxicj4nOwogICAgICAgICAgaWYgKGQuZ2FpbmVkICE9PSB1bmRlZmluZWQpIHRleHQgKz0gJ/Cfk4ggR2FpbmVkOiAnICsgZC5nYWluZWQgKyAnIGJvbmRzJzsKICAgICAgICAgIG91dC5pbm5lckhUTUwgPSB0ZXh0OwogICAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7CiAgICAgICAgfQogICAgICB9IGNhdGNoIHsKICAgICAgICBvdXQuaW5uZXJIVE1MID0gJ+KdjCBFcnJvciBmZXRjaGluZyBzdGF0dXMnOwogICAgICAgIGNsZWFySW50ZXJ2YWwoaW50ZXJ2YWwpOwogICAgICB9CiAgICB9CiAgPC9zY3JpcHQ+CjwvYm9keT4KPC9odG1sPmApOwp9KTsKYXBwLmdldCgiL3N0YXR1cy86cXVlcnkiLCAocmVxLCByZXMpID0+IHsKICBjb25zdCBxID0gcmVxLnBhcmFtcy5xdWVyeS50b0xvd2VyQ2FzZSgpOwogIGNvbnN0IGZpbmRTZXNzaW9uID0gY29sbCA9PgogICAgQXJyYXkuZnJvbShjb2xsLnZhbHVlcygpKS5maW5kKAogICAgICBzID0+IHMudXNlcm5hbWUudG9Mb3dlckNhc2UoKSA9PT0gcSB8fAogICAgICAgICAgIChzLm5vX29yZGVyICYmIHMubm9fb3JkZXIudG9Mb3dlckNhc2UoKSA9PT0gcSkKICAgICk7CiAgY29uc3Qgc2Vzc2lvbiA9IGZpbmRTZXNzaW9uKHNlc3Npb25zKSB8fCBmaW5kU2Vzc2lvbihwZW5kaW5nKSB8fCBmaW5kU2Vzc2lvbihjb21wbGV0ZWQpOwogIGlmICghc2Vzc2lvbikgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6IGBObyBzZXNzaW9uIGZvdW5kIGZvciAke3JlcS5wYXJhbXMucXVlcnl9YCB9KTsKCiAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsKICBjb25zdCBpc0FjdGl2ZSA9IHNlc3Npb25zLmhhcyhzZXNzaW9uLnVzZXJuYW1lLnRvTG93ZXJDYXNlKCkpOwogIGNvbnN0IGlzQ29tcGxldGVkID0gY29tcGxldGVkLmhhcyhzZXNzaW9uLnVzZXJuYW1lLnRvTG93ZXJDYXNlKCkpOwoKICBsZXQgc3RhdHVzID0gaXNDb21wbGV0ZWQgPyAiY29tcGxldGVkIiA6CiAgICAgICAgICAgICAgIChpc0FjdGl2ZSA/ICJydW5uaW5nIiA6ICJwZW5kaW5nIik7CgogIGxldCB0aW1lTGVmdCA9IHNlc3Npb24uZW5kVGltZSAtIG5vdzsKCiAgY29uc3Qgc2VlbiA9IHNlc3Npb24udHlwZSA9PT0gImJvbmRzIgogICAgPyBsYXN0U2VudC5nZXQoc2Vzc2lvbi51c2VybmFtZS50b0xvd2VyQ2FzZSgpKQogICAgOiBsYXN0U2Vlbi5nZXQoc2Vzc2lvbi51c2VybmFtZS50b0xvd2VyQ2FzZSgpKSB8fCAwOwoKICBpZiAoaXNBY3RpdmUgJiYgbm93IC0gc2VlbiA+IDEyMF8wMDApIHsKICAgIHN0YXR1cyA9ICJpbmFjdGl2ZSI7CiAgfQoKICBjb25zdCBiYXNlID0gewogICAgdXNlcm5hbWU6IHNlc3Npb24udXNlcm5hbWUsCiAgICBzdGF0dXMsCiAgICB0eXBlOiBzZXNzaW9uLnR5cGUsCiAgICBub19vcmRlcjogc2Vzc2lvbi5ub19vcmRlciwKICAgIG5hbWFfc3RvcmU6IHNlc3Npb24ubmFtYV9zdG9yZQogIH07CgogIGlmIChzdGF0dXMgPT09ICJydW5uaW5nIiB8fCBzdGF0dXMgPT09ICJpbmFjdGl2ZSIpIHsKICAgIHJldHVybiByZXMuanNvbih7CiAgICAgIC4uLmJhc2UsCiAgICAgIGVuZFRpbWU6IHNlc3Npb24uZW5kVGltZSwKICAgICAgdGltZUxlZnQ6IE1hdGgubWF4KDAsIHRpbWVMZWZ0KSwKICAgICAgbGFzdFNlZW46IHNlZW4sCiAgICAgIGFjdGl2aXR5OiBzZXNzaW9uLnBsYWNlSWQgPT09IEdBTUVfUExBQ0VfSUQgPyAiR2FtZXBsYXkiCiAgICAgICAgICAgICAgIDogc2Vzc2lvbi5wbGFjZUlkID09PSBMT0JCWV9QTEFDRV9JRCA/ICJMb2JieSIKICAgICAgICAgICAgICAgOiAiVW5rbm93biIsCiAgICAgIGN1cnJlbnRCb25kczogc2Vzc2lvbi5jdXJyZW50X2JvbmRzLAogICAgICB0YXJnZXRCb25kczogc2Vzc2lvbi50YXJnZXRfYm9uZCwKICAgICAgZ2FpbmVkOiBzZXNzaW9uLnR5cGUgPT09ICJib25kcyIgPyBzZXNzaW9uLmN1cnJlbnRfYm9uZHMgLSBzZXNzaW9uLnN0YXJ0X2JvbmRzIDogdW5kZWZpbmVkCiAgICB9KTsKICB9CgogIGlmIChzdGF0dXMgPT09ICJjb21wbGV0ZWQiKSB7CiAgICByZXR1cm4gcmVzLmpzb24oewogICAgICAuLi5iYXNlLAogICAgICBjb21wbGV0ZWRBdDogc2Vzc2lvbi5jb21wbGV0ZWRBdCB8fCBzZXNzaW9uLmVuZFRpbWUsCiAgICAgIGdhaW5lZDogc2Vzc2lvbi50eXBlID09PSAiYm9uZHMiID8gc2Vzc2lvbi5jdXJyZW50X2JvbmRzIC0gc2Vzc2lvbi5zdGFydF9ib25kcyA6IHVuZGVmaW5lZAogICAgfSk7CiAgfQoKICByZXR1cm4gcmVzLmpzb24oYmFzZSk7IC8vIHBlbmRpbmcKfSk7CgoKLy8gPT09IC9jaGVjawphcHAucG9zdCgiL2NoZWNrIiwgKHJlcSwgcmVzKSA9PiB7CiAgY29uc3QgeyB1c2VybmFtZSB9ID0gcmVxLmJvZHk7CiAgY29uc3QgdXNlciA9IHVzZXJuYW1lLnRvTG93ZXJDYXNlKCk7CiAgY29uc3QgcyA9IHNlc3Npb25zLmdldCh1c2VyKTsKICBpZiAoIXMpIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAiTm8gYWN0aXZlIHNlc3Npb24iIH0pOwogIGxhc3RTZWVuLnNldCh1c2VyLCBEYXRlLm5vdygpKTsKICByZXMuanNvbih7IG9rOiB0cnVlIH0pOwp9KTsKCi8vID09PSAvY29tcGxldGUgCmFwcC5wb3N0KCIvY29tcGxldGUiLCAocmVxLCByZXMpID0+IHsKICBjb25zdCB7IHVzZXJuYW1lIH0gPSByZXEuYm9keTsKICBjb25zdCB1c2VyID0gdXNlcm5hbWUudG9Mb3dlckNhc2UoKTsKICBjb25zdCBzID0gc2Vzc2lvbnMuZ2V0KHVzZXIpOwogIGlmICghcykgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICJObyBzZXNzaW9uIiB9KTsKCiAgY29uc3Qgbm93ID0gTWF0aC5mbG9vcihEYXRlLm5vdygpIC8gMTAwMCk7CiAgY29uc3QgY2xlYW4gPSBzLm5vX29yZGVyLnJlcGxhY2UoL15PRDAwMDAwMC8sICIiKTsKCiAgY29uc3QgZW1iZWQgPSB7CiAgICBlbWJlZHM6IFt7CiAgICAgIHRpdGxlOiAi4pyFICoqSk9LSSBDT01QTEVURUQqKiIsCiAgICAgIGRlc2NyaXB0aW9uOgogICAgICAgIGAqKlVzZXJuYW1lOioqICR7cy51c2VybmFtZX1cbmAgKwogICAgICAgIGAqKk9yZGVyIElEOioqICR7cy5ub19vcmRlcn1cbmAgKwogICAgICAgIGBb8J+UlyBWaWV3IE9yZGVyXShodHRwczovL3Rva29rdS5pdGVta3UuY29tL3Jpd2F5YXQtcGVzYW5hbi9yaW5jaWFuLyR7Y2xlYW59KVxuXG5gICsKICAgICAgICBg4o+wIENvbXBsZXRlZCBhdDogPHQ6JHtub3d9OmY+YCwKICAgICAgZm9vdGVyOiB7IHRleHQ6IGAtICR7cy5uYW1hX3N0b3JlfWAgfQogICAgfV0KICB9OwoKICBmZXRjaChgaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdjEwL2NoYW5uZWxzLyR7Q0hBTk5FTH0vbWVzc2FnZXNgLCB7CiAgICBtZXRob2Q6ICJQT1NUIiwKICAgIGhlYWRlcnM6IHsKICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgQXV0aG9yaXphdGlvbjogYEJvdCAke0JPVF9UT0tFTn1gCiAgICB9LAogICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZW1iZWQpCiAgfSkuY2F0Y2goY29uc29sZS5lcnJvcik7CgogIHNlc3Npb25zLmRlbGV0ZSh1c2VyKTsKICBsYXN0U2Vlbi5kZWxldGUodXNlcik7CiAgY29tcGxldGVkLnNldCh1c2VyLCBzKTsKICByZXMuanNvbih7IG9rOiB0cnVlIH0pOwp9KTsKCi8vID09PSAvRGlzY29ubmVjdGVkIAphcHAucG9zdCgiL2Rpc2Nvbm5lY3RlZCIsIChyZXEsIHJlcykgPT4gewogIGNvbnN0IHsgdXNlcm5hbWUsIHJlYXNvbiA9ICJVbmtub3duIiwgcGxhY2VJZCB9ID0gcmVxLmJvZHk7CiAgaWYgKCF1c2VybmFtZSkgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICJNaXNzaW5nIHVzZXJuYW1lIiB9KTsKCiAgY29uc3QgZW1iZWQgPSB7CiAgICBlbWJlZHM6IFsKICAgICAgewogICAgICAgIHRpdGxlOiBg4p2MIFBsYXllciBEaXNjb25uZWN0ZWRgLAogICAgICAgIGNvbG9yOiAweGZmMDAwMCwKICAgICAgICBmaWVsZHM6IFsKICAgICAgICAgIHsgbmFtZTogIlVzZXJuYW1lIiwgdmFsdWU6IHVzZXJuYW1lLCBpbmxpbmU6IHRydWUgfSwKICAgICAgICAgIHsgbmFtZTogIlJlYXNvbiIsIHZhbHVlOiByZWFzb24sIGlubGluZTogdHJ1ZSB9LAogICAgICAgICAgeyBuYW1lOiAiUGxhY2UgSUQiLCB2YWx1ZTogcGxhY2VJZCB8fCAiVW5rbm93biIsIGlubGluZTogdHJ1ZSB9CiAgICAgICAgXSwKICAgICAgICB0aW1lc3RhbXA6IG5ldyBEYXRlKCkudG9JU09TdHJpbmcoKQogICAgICB9CiAgICBdCiAgfTsKCiAgZmV0Y2goYGh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3YxMC9jaGFubmVscy8ke0NIQU5ORUx9L21lc3NhZ2VzYCwgewogICAgbWV0aG9kOiAiUE9TVCIsCiAgICBoZWFkZXJzOiB7CiAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgIEF1dGhvcml6YXRpb246IGBCb3QgJHtCT1RfVE9LRU59YAogICAgfSwKICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGVtYmVkKQogIH0pLmNhdGNoKGNvbnNvbGUuZXJyb3IpOwoKICByZXMuanNvbih7IG9rOiB0cnVlIH0pOwp9KTsKCi8vID09PSAvb3JkZXIgKFVJIFBhZ2UpCmFwcC5nZXQoIi9vcmRlciIsIChyZXEsIHJlcykgPT4gewogIHJlcy5zZW5kKGAKPCFET0NUWVBFIGh0bWw+CjxodG1sIGxhbmc9ImVuIj4KPGhlYWQ+CiAgPG1ldGEgY2hhcnNldD0iVVRGLTgiLz4KICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLGluaXRpYWwtc2NhbGU9MS4wIi8+CiAgPHRpdGxlPkNoZWNrIE9yZGVyPC90aXRsZT4KICA8c3R5bGU+CiAgICBib2R5IHsKICAgICAgbWFyZ2luOjA7IHBhZGRpbmc6MjBweDsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzBmMGYxYiwgIzEyMjZhNSk7CiAgICAgIGNvbG9yOiNlY2VjZWM7CiAgICAgIGZvbnQtZmFtaWx5OidJbnRlcicsQXJpYWwsc2Fucy1zZXJpZjsKICAgICAgbWluLWhlaWdodDogMTAwdmg7CiAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAganVzdGlmeS1jb250ZW50OmNlbnRlcjsKICAgICAgYWxpZ24taXRlbXM6Y2VudGVyOwogICAgfQogICAgLmNvbnRhaW5lciB7CiAgICAgIHdpZHRoOiA5MCU7IG1heC13aWR0aDogNTAwcHg7CiAgICAgIGJhY2tncm91bmQ6ICMxZDFkMjg7CiAgICAgIHBhZGRpbmc6IDIwcHg7CiAgICAgIGJvcmRlci1yYWRpdXM6IDE0cHg7CiAgICAgIGJveC1zaGFkb3c6IDAgNHB4IDIwcHggIzAwMDg7CiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgIH0KICAgIGlucHV0LCBidXR0b24gewogICAgICB3aWR0aDogMTAwJTsKICAgICAgcGFkZGluZzogMTJweDsKICAgICAgbWFyZ2luLXRvcDogMTJweDsKICAgICAgYm9yZGVyOiBub25lOwogICAgICBib3JkZXItcmFkaXVzOiA2cHg7CiAgICAgIGZvbnQtc2l6ZTogMTZweDsKICAgICAgYm94LXNpemluZzogYm9yZGVyLWJveDsKICAgIH0KICAgIGlucHV0IHsKICAgICAgYmFja2dyb3VuZDogIzJhMmEzMzsKICAgICAgY29sb3I6ICNlZWU7CiAgICB9CiAgICBidXR0b24gewogICAgICBiYWNrZ3JvdW5kOiAjM2I4MmY2OwogICAgICBjb2xvcjogI2ZmZjsKICAgICAgY3Vyc29yOiBwb2ludGVyOwogICAgICBmb250LXdlaWdodDogYm9sZDsKICAgIH0KICAgIEBtZWRpYShtYXgtd2lkdGg6NzY4cHgpewogICAgICBpbnB1dCwgYnV0dG9uIHsgZm9udC1zaXplOjE4cHg7IH0KICAgIH0KICA8L3N0eWxlPgo8L2hlYWQ+Cjxib2R5PgogIDxkaXYgY2xhc3M9ImNvbnRhaW5lciI+CiAgICA8aDI+8J+UjSBDaGVjayBPcmRlcjwvaDI+CiAgICA8aW5wdXQgaWQ9InEiIHBsYWNlaG9sZGVyPSJPcmRlciBJRCAoRXhhbXBsZTogT0QwMDAwMDAxMjM0NTYpIiAvPgogICAgPGJ1dHRvbiBvbmNsaWNrPSJzdGFydENoZWNrKCkiPkNoZWNrIE9yZGVyPC9idXR0b24+CiAgPC9kaXY+CiAgPHNjcmlwdD4KICAgIGZ1bmN0aW9uIHN0YXJ0Q2hlY2soKSB7CiAgICAgIGNvbnN0IHEgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicSIpLnZhbHVlLnRyaW0oKTsKICAgICAgaWYgKCFxIHx8ICFxLnN0YXJ0c1dpdGgoIk9EIikpIHJldHVybjsKICAgICAgY29uc3QgY2xlYW4gPSBxLnJlcGxhY2UoL15PRDAwMDAwMC8sICIiKTsKICAgICAgd2luZG93LmxvY2F0aW9uLmhyZWYgPSAiL29yZGVyLyIgKyBjbGVhbjsKICAgIH0KICA8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+CiAgYCk7Cn0pOwoKLy8gPT09IC9vcmRlci86Y2xlYW4gKERpcmVjdCBSZWRpcmVjdCkKYXBwLmdldCgiL29yZGVyLzpjbGVhbiIsIChyZXEsIHJlcykgPT4gewogIGNvbnN0IHsgY2xlYW4gfSA9IHJlcS5wYXJhbXM7CiAgcmVzLnJlZGlyZWN0KGBodHRwczovL3Rva29rdS5pdGVta3UuY29tL3Jpd2F5YXQtcGVzYW5hbi9yaW5jaWFuLyR7Y2xlYW59YCk7Cn0pOwoKLy8gPT09IC9qb2luIHJlZGlyZWN0CmFwcC5nZXQoIi9qb2luIiwgKHJlcSwgcmVzKSA9PiB7CiAgY29uc3QgeyBwbGFjZSwgam9iIH0gPSByZXEucXVlcnk7CiAgaWYgKCFwbGFjZSB8fCAham9iKSByZXR1cm4gcmVzLnN0YXR1cyg0MDApLnNlbmQoIk1pc3NpbmcgcGxhY2Uvam9iIik7CiAgY29uc3QgdXJpID0gYHJvYmxveDovL2V4cGVyaWVuY2VzL3N0YXJ0P3BsYWNlSWQ9JHtwbGFjZX0mZ2FtZUlkPSR7am9ifWA7CiAgam9iID0gcGVuZGluZy5nZXQodXNlcm5hbWUpOwogIHBlbmRpbmcuZGVsZXRlKHVzZXJuYW1lKTsKICBzZXNzaW9ucy5zZXQodXNlcm5hbWUsIGpvYik7CiAgcmVzLnNlbmQoYAogIDwhRE9DVFlQRSBodG1sPjxodG1sPjxib2R5IHN0eWxlPSJiYWNrZ3JvdW5kOiMxODE4MWI7Y29sb3I6I2VlZTtkaXNwbGF5OmZsZXg7anVzdGlmeS1jb250ZW50OmNlbnRlcjthbGlnbi1pdGVtczpjZW50ZXI7aGVpZ2h0OjEwMHZoO2ZvbnQtZmFtaWx5OnNhbnMtc2VyaWY7Ij4KICAgIDxkaXYgc3R5bGU9InRleHQtYWxpZ246Y2VudGVyOyI+CiAgICAgIDxoMT7wn5SXIFJlZGlyZWN0aW5nIHRvIFJvYmxveC4uLjwvaDE+CiAgICAgIDxhIGhyZWY9IiR7dXJpfSIgc3R5bGU9ImNvbG9yOiMzYjgyZjY7Ij5UYXAgaGVyZSBpZiBub3QgcmVkaXJlY3RlZDwvYT4KICAgIDwvZGl2PgogICAgPHNjcmlwdD5zZXRUaW1lb3V0KCgpID0+IHsgbG9jYXRpb24uaHJlZiA9ICIke3VyaX0iIH0sIDE1MDApPC9zY3JpcHQ+CiAgPC9ib2R5PjwvaHRtbD5gKTsKfSk7CgovLyBTaHV0ZG93biBhbmQgcmVzdGFydCBzZXJ2ZXIgKHByb3RlY3RlZCBieSByZXF1aXJlQXV0aCkKYXBwLnBvc3QoIi9zaHV0ZG93biIsIChyZXEsIHJlcykgPT4gewogIHJlcy5zZW5kKCLwn5S0IFNlcnZlciBzaHV0dGluZyBkb3duLi4uIik7CiAgcHJvY2Vzcy5leGl0KDApOwp9KTsKCmFwcC5wb3N0KCIvcmVzdGFydCIsIChyZXEsIHJlcykgPT4gewogIHJlcXVpcmUoImNoaWxkX3Byb2Nlc3MiKS5leGVjKCJiYXNoIC4vcmJseC5zaCIsIChlcnIsIHN0ZG91dCwgc3RkZXJyKSA9PiB7CiAgICBpZiAoZXJyKSBjb25zb2xlLmVycm9yKGVycik7CiAgICByZXMuc2VuZCgi8J+UhCBSZXN0YXJ0ZWQgdmlhIHJibHguc2giKTsKICB9KTsKfSk7CgovLyBnYWcgdXBsb2FkIGRhdGEKYXBwLnBvc3QoIi91cGxvYWQtZ2FnLWRhdGEiLCBleHByZXNzLmpzb24oKSwgKHJlcSwgcmVzKSA9PiB7CiAgY29uc3QgeyB1c2VybmFtZSwgZGF0YSB9ID0gcmVxLmJvZHkgfHwge307CiAgaWYgKCF1c2VybmFtZSB8fCAhZGF0YSkgewogICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICJNaXNzaW5nIHVzZXJuYW1lIG9yIGRhdGEiIH0pOwogIH0KCiAgY29uc3Qga2V5ID0gdXNlcm5hbWUudG9Mb3dlckNhc2UoKTsKICBnYWdEYXRhU3RvcmUuc2V0KGtleSwgZGF0YSk7CiAgc2F2ZUdBRygpOyAgLy8gUGVyc2lzdCB0byBnYWdkYXRhLmpzb24KCiAgY29uc29sZS5sb2coYPCfk6UgR0FHIGRhdGEgc2F2ZWQgZm9yICR7a2V5fWApOwogIHJlcy5qc29uKHsgc3VjY2VzczogdHJ1ZSB9KTsKfSk7CgovLyA9PT0gL3NlbmQtam9iID09PQphcHAucG9zdCgiL3NlbmQtam9iIiwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7CiAgY29uc3QgeyBqb2JJZCA9ICJVbmtub3duIiwgdXNlcm5hbWUgPSAiVXNlciIsIGpvaW5fdXJsID0gIiIsIHBsYWNlSWQgPSAiTi9BIiB9ID0gcmVxLmJvZHk7CiAgY29uc3QgcyA9IHNlc3Npb25zLmdldCh1c2VybmFtZSk7CiAgaWYgKCFzKSByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogIk5vIHNlc3Npb24iIH0pOwoKICB0cnkgewogICAgYXdhaXQgZmV0Y2goYGh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3YxMC9jaGFubmVscy8ke3MuSk9CX0NIQU5ORUx9L21lc3NhZ2VzYCwgewogICAgICBtZXRob2Q6ICJQT1NUIiwKICAgICAgaGVhZGVyczogewogICAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgICAgQXV0aG9yaXphdGlvbjogYEJvdCAke0JPVF9UT0tFTn1gCiAgICAgIH0sCiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsKICAgICAgICBlbWJlZHM6IFt7CiAgICAgICAgICB0aXRsZTogYPCfp6kgSm9iIElEIGZvciAke3VzZXJuYW1lfWAsCiAgICAgICAgICBkZXNjcmlwdGlvbjogYCoqUGxhY2UgSUQ6KiogXGAke3BsYWNlSWR9XGBcbioqSm9iIElEOioqIFxgJHtqb2JJZH1cYGAsCiAgICAgICAgICBmaWVsZHM6IFt7CiAgICAgICAgICAgIG5hbWU6ICJKb2luIExpbmsiLAogICAgICAgICAgICB2YWx1ZTogYFtDbGljayB0byBKb2luIEdhbWVdKCR7am9pbl91cmx9KWAKICAgICAgICAgIH1dLAogICAgICAgICAgY29sb3I6IDB4MzQ5OGRiCiAgICAgICAgfV0KICAgICAgfSkKICAgIH0pOwogICAgcmVzLmpzb24oeyBvazogdHJ1ZSB9KTsKICB9IGNhdGNoIChlKSB7CiAgICByZXMuc3RhdHVzKDUwMCkuanNvbih7IGVycm9yOiBlLm1lc3NhZ2UgfSk7CiAgfQp9KTsKCi8vIHJlcXVlc3QgZG93bmxvYWQgZGF0YSB0byBzcGVlZGh1YgphcHAuZ2V0KCIvZG93bmxvYWQtZ2FnLWRhdGEiLCAocmVxLCByZXMpID0+IHsKICBjb25zdCB1c2VybmFtZSA9IChyZXEucXVlcnkudXNlcm5hbWUgfHwgIiIpLnRvTG93ZXJDYXNlKCk7CiAgaWYgKCF1c2VybmFtZSkgewogICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICJNaXNzaW5nIHVzZXJuYW1lIiB9KTsKICB9CgogIGNvbnN0IGRhdGEgPSBnYWdEYXRhU3RvcmUuZ2V0KHVzZXJuYW1lKTsKICBpZiAoIWRhdGEpIHsKICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAiR0FHIGRhdGEgbm90IGZvdW5kIiB9KTsKICB9CgogIHJlcy5qc29uKGRhdGEpOwp9KTsKCi8vID09PSBIZWFydGJlYXQgd2F0Y2hkb2cKc2V0SW50ZXJ2YWwoKCkgPT4gewogIGNvbnN0IG5vdyA9IERhdGUubm93KCk7CiAgc2Vzc2lvbnMuZm9yRWFjaCgocywgdW5hbWUpID0+IHsKICAgIC8vIFNraXAgaWYgdGhlIHVzZXIgaXMgYWxyZWFkeSBpbiBjb21wbGV0ZWQgc2Vzc2lvbnMKICAgIGlmIChjb21wbGV0ZWQuaGFzKHVuYW1lKSkgcmV0dXJuOwoKICAgIGNvbnN0IHNlZW4gPSBsYXN0U2Vlbi5nZXQodW5hbWUpIHx8IDA7CgogICAgaWYgKHMudHlwZSAhPT0gImFmayIgJiYgIXMud2FybmVkICYmIG5vdyA+IHMuZW5kVGltZSkgewogICAgICBmZXRjaChgaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdjEwL2NoYW5uZWxzLyR7Q0hBTk5FTH0vbWVzc2FnZXNgLCB7CiAgICAgICAgbWV0aG9kOiAiUE9TVCIsCiAgICAgICAgaGVhZGVyczogeyAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLCBBdXRob3JpemF0aW9uOiBgQm90ICR7Qk9UX1RPS0VOfWAgfSwKICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGNvbnRlbnQ6IGDij7MgJHtzLnVzZXJuYW1lfSdzIGpva2kgZW5kZWQuYCB9KQogICAgICB9KS5jYXRjaChjb25zb2xlLmVycm9yKTsKICAgICAgcy53YXJuZWQgPSB0cnVlOwogICAgfQoKICAgIGlmICghcy5vZmZsaW5lICYmIG5vdyAtIHNlZW4gPiAxODAwMDApIHsKICAgICAgZmV0Y2goYGh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3YxMC9jaGFubmVscy8ke0NIQU5ORUx9L21lc3NhZ2VzYCwgewogICAgICAgIG1ldGhvZDogIlBPU1QiLAogICAgICAgIGhlYWRlcnM6IHsgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwgQXV0aG9yaXphdGlvbjogYEJvdCAke0JPVF9UT0tFTn1gIH0sCiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBjb250ZW50OiBg8J+UtCBAZXZlcnlvbmUg4oCTICoqJHtzLnVzZXJuYW1lfSBpcyBPRkZMSU5FLioqIE5vIGhlYXJ0YmVhdCBpbiAz4oCvbWludXRlcy5gIH0pCiAgICAgIH0pLmNhdGNoKGNvbnNvbGUuZXJyb3IpOwogICAgICBzLm9mZmxpbmUgPSB0cnVlOwogICAgfQoKICAgIGlmIChzLm9mZmxpbmUgJiYgbm93IC0gc2VlbiA8PSAxODAwMDApIHsKICAgICAgcy5vZmZsaW5lID0gZmFsc2U7CiAgICB9CiAgfSk7Cn0sIDYwMDAwKTsKCi8vID09PSBTdGFydCBTZXJ2ZXIKY29uc3QgdmVycyA9IHZlcnNpb24KY29uc3QgY2xvZyA9IGNoYW5nZWxvZwphcHAubGlzdGVuKFBPUlQsICgpID0+IHsKICBjb25zb2xlLmxvZyhgfiQgUHJveHkgcnVubmluZyBvbiBodHRwOi8vbG9jYWxob3N0OiR7UE9SVH1gKTsKICBjb25zb2xlLmxvZyhgfiQgVG8gZXhwb3NlIHZpYSBDbG91ZGZsYXJlOlxuY2xvdWRmbGFyZWQgdHVubmVsIHN0YXJ0IG15LXR1bm5lbGApOwogIGNvbnNvbGUubG9nKHZlcnMpCiAgY29uc29sZS5sb2coY2xvZykKfSk7y";

const decoded = Buffer.from(encoded, "base64").toString("utf8");
eval(decoded);