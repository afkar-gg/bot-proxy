const encoded = "Y29uc3QgZXhwcmVzcyA9IHJlcXVpcmUoImV4cHJlc3MiKTsKY29uc3QgY29va2llUGFyc2VyID0gcmVxdWlyZSgiY29va2llLXBhcnNlciIpOwpjb25zdCBmcyA9IHJlcXVpcmUoImZzIik7CmNvbnN0IGNvbmZpZyA9IHJlcXVpcmUoIi4vY29uZmlnLmpzb24iKTsKY29uc3QgZmV0Y2ggPSAoLi4uYXJncykgPT4gaW1wb3J0KCdub2RlLWZldGNoJykudGhlbigoe2RlZmF1bHQ6IGZldGNofSkgPT4gZmV0Y2goLi4uYXJncykpOwpjb25zdCB7IGV4ZWMgfSA9IHJlcXVpcmUoImNoaWxkX3Byb2Nlc3MiKTsKY29uc3QgcGF0aCA9IHJlcXVpcmUoInBhdGgiKTsKY29uc3QgR0FHX0ZJTEUgPSBwYXRoLmpvaW4oX19kaXJuYW1lLCAiZ2FnZGF0YS5qc29uIik7CmNvbnN0IGdhZ0RhdGFTdG9yZSA9IG5ldyBNYXAoKTsKCi8vID09PSBWZXJzaW9uIEluZm8gPT09CmNvbnN0IHZlcnNpb24gPSAidjIuNC4zIjsKY29uc3QgY2hhbmdlbG9nID0gWwogICJzdGF0dXMgZml4LCBwcm9iYWJseSBoYXMgYnVnIiwKXTsKCmNvbnN0IFNUT1JBR0VfRklMRSA9ICIuL3N0b3JhZ2UuanNvbiI7CmNvbnN0IEJPVF9UT0tFTiA9IGNvbmZpZy5CT1RfVE9LRU47CmNvbnN0IENIQU5ORUwgPSBjb25maWcuQ0hBTk5FTF9JRDsKY29uc3QgSk9CX0NIQU5ORUwgPSBjb25maWcuSk9CX0NIQU5ORUxfSUQ7CmNvbnN0IERBU0hfUEFTUyA9IGNvbmZpZy5EQVNIQk9BUkRfUEFTU1dPUkQgfHwgInNlY3JldCI7CmNvbnN0IEdBTUVfUExBQ0VfSUQgPSA3MDg3NjgzMjI1MzE2MzsKY29uc3QgTE9CQllfUExBQ0VfSUQgPSAxMTY0OTU4MjkxODg5NTI7CmNvbnN0IFBPUlQgPSBjb25maWcuUE9SVCB8fCAzMDAwOwoKY29uc3QgYXBwID0gZXhwcmVzcygpOwphcHAudXNlKGV4cHJlc3MuanNvbigpKTsKYXBwLnVzZShleHByZXNzLnVybGVuY29kZWQoeyBleHRlbmRlZDogZmFsc2UgfSkpOwphcHAudXNlKGNvb2tpZVBhcnNlcigpKTsKCmNvbnN0IHBlbmRpbmcgPSBuZXcgTWFwKCk7CmNvbnN0IHNlc3Npb25zID0gbmV3IE1hcCgpOwpjb25zdCBsYXN0U2VlbiA9IG5ldyBNYXAoKTsKY29uc3QgbGFzdFNlbnQgPSBuZXcgTWFwKCk7CmNvbnN0IGNvbXBsZXRlZCA9IG5ldyBNYXAoKTsKCmlmICghQk9UX1RPS0VOIHx8ICFDSEFOTkVMKSB7CiAgY29uc29sZS5lcnJvcigi4p2MIE1pc3NpbmcgQk9UX1RPS0VOIG9yIENIQU5ORUxfSUQgaW4gY29uZmlnLmpzb24iKTsKICBwcm9jZXNzLmV4aXQoMSk7Cn0KCmlmICghZnMuZXhpc3RzU3luYyhTVE9SQUdFX0ZJTEUpKSB7CiAgZnMud3JpdGVGaWxlU3luYyhTVE9SQUdFX0ZJTEUsIEpTT04uc3RyaW5naWZ5KHsgY29tcGxldGVkOiB7fSB9LCBudWxsLCAyKSk7Cn0KY29uc3Qgc2F2ZWQgPSBKU09OLnBhcnNlKGZzLnJlYWRGaWxlU3luYyhTVE9SQUdFX0ZJTEUsICJ1dGY4IikpOwppZiAoQXJyYXkuaXNBcnJheShzYXZlZC5jb21wbGV0ZWQpKSB7CiAgLy8gb2xkIGZvcm1hdCAoYXJyYXkpCiAgc2F2ZWQuY29tcGxldGVkLmZvckVhY2gocyA9PiB7CiAgICBjb25zdCB1bmFtZSA9IHMudXNlcm5hbWUudG9Mb3dlckNhc2UoKTsKICAgIGlmICghY29tcGxldGVkLmhhcyh1bmFtZSkpIGNvbXBsZXRlZC5zZXQodW5hbWUsIFtdKTsKICAgIGNvbXBsZXRlZC5nZXQodW5hbWUpLnB1c2gocyk7CiAgfSk7Cn0gZWxzZSBpZiAoc2F2ZWQuY29tcGxldGVkKSB7CiAgLy8gbmV3IGZvcm1hdCAob2JqZWN0IG9mIGFycmF5cykKICBPYmplY3QuZW50cmllcyhzYXZlZC5jb21wbGV0ZWQpLmZvckVhY2goKFt1bmFtZSwgYXJyXSkgPT4gewogICAgY29tcGxldGVkLnNldCh1bmFtZSwgYXJyKTsKICB9KTsKfQppZiAoc2F2ZWQucGVuZGluZykgc2F2ZWQucGVuZGluZy5mb3JFYWNoKHMgPT4gcGVuZGluZy5zZXQocy51c2VybmFtZS50b0xvd2VyQ2FzZSgpLCBzKSk7CmlmIChzYXZlZC5zZXNzaW9ucykgc2F2ZWQuc2Vzc2lvbnMuZm9yRWFjaChzID0+IHNlc3Npb25zLnNldChzLnVzZXJuYW1lLnRvTG93ZXJDYXNlKCksIHMpKTsKaWYgKHNhdmVkLmxhc3RTZWVuKSBPYmplY3QuZW50cmllcyhzYXZlZC5sYXN0U2VlbikuZm9yRWFjaCgoW2ssIHZdKSA9PiBsYXN0U2Vlbi5zZXQoaywgdikpOwppZiAoc2F2ZWQubGFzdFNlbnQpIE9iamVjdC5lbnRyaWVzKHNhdmVkLmxhc3RTZW50KS5mb3JFYWNoKChbaywgdl0pID0+IGxhc3RTZW50LnNldChrLCB2KSk7CgpmdW5jdGlvbiBzYXZlU3RvcmFnZSgpIHsKICAvLyBmbGF0dGVuIE1hcHMgdG8gSlNPTi1jb21wYXRpYmxlIG9iamVjdHMKICBjb25zdCBkYXRhID0gewogICAgY29tcGxldGVkOiBPYmplY3QuZnJvbUVudHJpZXMoY29tcGxldGVkKSwgICAvLyB1c2VybmFtZSDihpIgW3Nlc3Npb25zLi4uXQogICAgcGVuZGluZzogQXJyYXkuZnJvbShwZW5kaW5nLnZhbHVlcygpKSwKICAgIHNlc3Npb25zOiBBcnJheS5mcm9tKHNlc3Npb25zLnZhbHVlcygpKSwKICAgIGxhc3RTZWVuOiBPYmplY3QuZnJvbUVudHJpZXMobGFzdFNlZW4pLAogICAgbGFzdFNlbnQ6IE9iamVjdC5mcm9tRW50cmllcyhsYXN0U2VudCkKICB9OwogIGZzLndyaXRlRmlsZVN5bmMoU1RPUkFHRV9GSUxFLCBKU09OLnN0cmluZ2lmeShkYXRhLCBudWxsLCAyKSk7Cn0KCi8vIExvYWQgZXhpc3RpbmcgZGF0YSBmcm9tIGRpc2sgb24gYm9vdAppZiAoZnMuZXhpc3RzU3luYyhHQUdfRklMRSkpIHsKICB0cnkgewogICAgY29uc3QgcmF3ID0gZnMucmVhZEZpbGVTeW5jKEdBR19GSUxFLCAidXRmOCIpOwogICAgY29uc3Qgb2JqID0gSlNPTi5wYXJzZShyYXcpOwogICAgT2JqZWN0LmVudHJpZXMob2JqKS5mb3JFYWNoKChbdXNlciwgZGF0YV0pID0+IGdhZ0RhdGFTdG9yZS5zZXQodXNlciwgZGF0YSkpOwogICAgY29uc29sZS5sb2coIuKchSBMb2FkZWQgZ2FnZGF0YS5qc29uIik7CiAgfSBjYXRjaCAoZSkgewogICAgY29uc29sZS5lcnJvcigi4pqg77iPIEZhaWxlZCBsb2FkaW5nIGdhZ2RhdGEuanNvbjoiLCBlKTsKICB9Cn0KCi8vIEhlbHBlciB0byB3cml0ZSBvbiB1cGRhdGVzCmZ1bmN0aW9uIHNhdmVHQUcoKSB7CiAgY29uc3Qgb3V0ID0gT2JqZWN0LmZyb21FbnRyaWVzKGdhZ0RhdGFTdG9yZSk7CiAgZnMud3JpdGVGaWxlU3luYyhHQUdfRklMRSwgSlNPTi5zdHJpbmdpZnkob3V0LCBudWxsLCAyKSk7Cn0KCmFwcC5nZXQoIi8iLCAocmVxLCByZXMpID0+IHsKICByZXMuc2VuZChgCjwhRE9DVFlQRSBodG1sPgo8aHRtbCBsYW5nPSJpZCI+CjxoZWFkPgogIDxtZXRhIGNoYXJzZXQ9IlVURi04IiAvPgogIDxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsaW5pdGlhbC1zY2FsZT0xIiAvPgogIDx0aXRsZT5XRUxDT01FIFRPIEFGS0FSU1RPUkU8L3RpdGxlPgogIDxzdHlsZT4KICAgIGJvZHkgewogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQodG8gYm90dG9tIHJpZ2h0LCAjMGYxNzJhLCAjMWUzYThhKTsKICAgICAgY29sb3I6ICNlY2VjZWM7CiAgICAgIGZvbnQtZmFtaWx5OiAnSW50ZXInLCBBcmlhbCwgc2Fucy1zZXJpZjsKICAgICAgbWFyZ2luOiAwOwogICAgICBwYWRkaW5nOiAyMHB4OwogICAgICBkaXNwbGF5OiBmbGV4OwogICAgICBmbGV4LWRpcmVjdGlvbjogY29sdW1uOwogICAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAgfQogICAgLmNvbnRhaW5lciB7CiAgICAgIHdpZHRoOiAxMDAlOwogICAgICBtYXgtd2lkdGg6IDQyMHB4OwogICAgfQogICAgLmNhcmQgewogICAgICBiYWNrZ3JvdW5kOiAjMjMyMzJiOwogICAgICBib3JkZXItcmFkaXVzOiAxNHB4OwogICAgICBib3gtc2hhZG93OiAwIDJweCAxNnB4ICMwMDA2OwogICAgICBwYWRkaW5nOiAyMHB4OwogICAgICBtYXJnaW4tYm90dG9tOiAyMHB4OwogICAgfQogICAgaDEsIGgyIHsKICAgICAgY29sb3I6ICMzYjgyZjY7CiAgICAgIG1hcmdpbi10b3A6IDA7CiAgICB9CiAgICBoMiB7CiAgICAgIGZvbnQtc2l6ZTogMS4yZW07CiAgICAgIG1hcmdpbi10b3A6IDEuMmVtOwogICAgfQogICAgYSB7CiAgICAgIGNvbG9yOiAjMzhiZGY4OwogICAgICB0ZXh0LWRlY29yYXRpb246IG5vbmU7CiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgfQogICAgYTpob3ZlciB7CiAgICAgIGNvbG9yOiAjM2I4MmY2OwogICAgfQogICAgdWwgewogICAgICBwYWRkaW5nLWxlZnQ6IDEuMmVtOwogICAgfQogIDwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CiAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgIDxkaXYgY2xhc3M9ImNhcmQiPgogICAgICA8aDE+V0VMQ09NRSBUTyBBRktBUlNUT1JFPC9oMT4KICAgICAgPHA+U2VsYW1hdCBkYXRhbmcgZGkgYmFnaWFuIGtlY2lsIGRhcmkgc3RvcmUgc2F5YSwgaW5pIGFkYWxhaCB0ZW1wYXQgZGltYW5hIHNheWEgbWVueWltcGFuIGluZm9ybWFzaSBqb2tpICh0aWRhayBha2FuIG1lbnlpbXBhbiBwYXNzd29yZCksIHNlbW9nYSBkZW5nYW4gYWRhbnlhIGluaSBtdW5na2luIGJpc2EgbWVtcGVybXVkYWggdW50dWsgcGVtYmVsaSBkYW4gcGVuam9raSAoc2F5YSBzZW5kaXJpIPCfl78pPC9wPgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJjYXJkIj4KICAgICAgPGgyPktlbmFwYSBQaWxpaCBBZmthcnN0b3JlPzwvaDI+CiAgICAgIDx1bD4KICAgICAgICA8bGk+SGFyZ2EgeWFuZyB0ZXJqYW5na2F1IChiaWFzYW55YSB0ZXJtdXJhaCBkaSBpdGVta3UpPC9saT4KICAgICAgICA8bGk+bWVtaWxpa2kgc2lzdGVtIG9ubGluZSBjaGVja2VyIChha2FuIGNlayBqaWthIGFrdW4gb25saW5lIGF0YXUgdGlkYWspPC9saT4KICAgICAgICA8bGk+b3RvbWF0aXMgbWVuZ2hpdHVuZyBrYXBhbiBzZWxlc2FpIG55YSBqb2tpPC9saT4KICAgICAgICA8bGk+YmxhIGJsYSBibGEgKG1hbGFzIHlhcHBpbmcpPC9saT4KICAgICAgPC91bD4KICAgIDwvZGl2PgogICAgPGRpdiBjbGFzcz0iY2FyZCI+CiAgICAgIDxoMj5LbnAgTHUgQmlraW4gV2Vic2l0ZSBJbmk/PC9oMj4KICAgICAgPHA+Q3VrdXAgbGFuZ2thIHlnIHB1bnlhIHdlYnNpdGUgYnVhdCBqYWRpaW4gdG9vbCB1dGsgam9raSAoYXBhbGFnaSByb2Jsb3gg8J+YgikuIFNhbWJpbCBlbWcgc2VuZ2FqYSBiaWtpbiBwcm9qZWsga2VjaWwgc2FtYmlsIGJlbGFqYXIgYW1hIGNoYXRncHQuIERhbiBqdWdhIGJpYXIgYmVkYSBkYXJpIHlhbmcgbGFpbiwgbGViaWgga2VyZW4sIGRhbiBiZXJrdWFsaXRhcyB0aW5nZ2kuIHdhbGF1IG1hc2loIGJlcmtlbWJhbmcgZGFyaSBmaXR1cjIga2VyZW4gbGFpbm55YSwgaW5pIHVkaCBjdWt1cCBrZXJlbiBidWF0IGpva2kgcm9ibG94PC9wPgogICAgPC9kaXY+CiAgICA8ZGl2IGNsYXNzPSJjYXJkIiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7Ij4KICAgICAgPHA+UGVuY2V0IDxhIGhyZWY9Ii9zdGF0dXMiIHRhcmdldD0iX2JsYW5rIj5EaXNpbmk8L2E+IGppa2EgYW5kYSBzZWRhbmcgaW5naW4gbWVsaWhhdCBzdGF0dXMgam9raSBrYWxpYW48L3A+CiAgICA8L2Rpdj4KICA8L2Rpdj4KPC9ib2R5Pgo8L2h0bWw+CiAgYCk7Cn0pOwoKLy8gPT09IEF1dGhlbnRpY2F0aW9uIE1pZGRsZXdhcmUgPT09CmZ1bmN0aW9uIHNhZmVSZWRpcmVjdCh1cmwpIHsKICAvLyBFbnN1cmUgcmVkaXJlY3QgcGF0aCBpcyBzYWZlIChpbnRlcm5hbCBvbmx5KQogIGlmICh0eXBlb2YgdXJsICE9PSAic3RyaW5nIikgcmV0dXJuICIvIjsKICBpZiAoIXVybC5zdGFydHNXaXRoKCIvIikpIHJldHVybiAiLyI7CiAgaWYgKHVybC5zdGFydHNXaXRoKCIvLyIpKSByZXR1cm4gIi8iOwogIHJldHVybiB1cmw7Cn0KCmZ1bmN0aW9uIHJlcXVpcmVBdXRoKHJlcSwgcmVzLCBuZXh0KSB7CiAgLy8gUHVibGljbHkgYWNjZXNzaWJsZSByb3V0ZXMKICBjb25zdCBvcGVuID0gWwogICAgIi9zdGF0dXMiLCAiL2xvZ2luIiwgIi9sb2dpbi1zdWJtaXQiLAogICAgIi90cmFjayIsICIvY2hlY2siLCAiL2NvbXBsZXRlIiwgIi9ib25kIiwgIi9qb2luIiwKICAgICIvc2VuZC1qb2IiLCAiL3N0YXJ0LWpvYiIsICIvc3RhdHVzLyIsICIvZ3JhcGgiLCAiL2Rpc2Nvbm5lY3RlZCIsCiAgICAiL2phZHdhbCIsICIvc2NoZWR1bGUiLCAiL2N1cnJlbnQtc3ViamVjdCIsICIvb3JkZXIiLAogICAgIi91cGxvYWQtZ2FnLWRhdGEiLCAiL2Rvd25sb2FkLWdhZy1kYXRhIgogIF07CiAgaWYgKG9wZW4uc29tZShwID0+IHJlcS5wYXRoLnN0YXJ0c1dpdGgocCkpKSByZXR1cm4gbmV4dCgpOwoKICAvLyBJZiBjb3JyZWN0IGNvb2tpZSBleGlzdHMsIGFsbG93IGFjY2VzcwogIGlmIChyZXEuY29va2llcz8uZGFzaF9hdXRoID09PSBEQVNIX1BBU1MpIHJldHVybiBuZXh0KCk7CgogIC8vIE5vdCBhdXRoZW50aWNhdGVkLCByZWRpcmVjdCB0byBsb2dpbiB3aXRoIHJlZGlyZWN0IHBhdGgKICBjb25zdCByZWRpcmVjdFRvID0gZW5jb2RlVVJJQ29tcG9uZW50KHNhZmVSZWRpcmVjdChyZXEub3JpZ2luYWxVcmwpKTsKICByZXR1cm4gcmVzLnJlZGlyZWN0KGAvbG9naW4/cmVkaXJlY3Q9JHtyZWRpcmVjdFRvfWApOwp9CmFwcC51c2UocmVxdWlyZUF1dGgpOwoKLy8gPT09IExvZ2luIFBhZ2UgPT09CmFwcC5nZXQoIi9sb2dpbiIsIChyZXEsIHJlcykgPT4gewogIGNvbnN0IHJlZGlyZWN0VG8gPSByZXEucXVlcnkucmVkaXJlY3QgfHwgIi8iOwogIGNvbnN0IGVycm9yTXNnID0gcmVxLnF1ZXJ5LmVycm9yID09PSAiMSIgPyAi4p2MIFdyb25nIHBhc3N3b3JkISIgOiAiIjsKCiAgcmVzLnNlbmQoYAogIDwhRE9DVFlQRSBodG1sPgogIDxodG1sIGxhbmc9ImlkIj4KICA8aGVhZD4KICAgIDxtZXRhIGNoYXJzZXQ9IlVURi04IiAvPgogICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiIC8+CiAgICA8dGl0bGU+TG9naW48L3RpdGxlPgogICAgPHN0eWxlPgogICAgICBib2R5IHsKICAgICAgICBtYXJnaW46IDA7CiAgICAgICAgaGVpZ2h0OiAxMDB2aDsKICAgICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjMWUzYThhLCAjOTMzM2VhKTsKICAgICAgICBjb2xvcjogI2VlZTsKICAgICAgICBkaXNwbGF5OiBmbGV4OwogICAgICAgIGp1c3RpZnktY29udGVudDogY2VudGVyOwogICAgICAgIGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgICAgZm9udC1mYW1pbHk6ICdTZWdvZSBVSScsIHNhbnMtc2VyaWY7CiAgICAgIH0KICAgICAgLmZvcm0tY29udGFpbmVyIHsKICAgICAgICBiYWNrZ3JvdW5kOiAjMWYxZjI1OwogICAgICAgIHBhZGRpbmc6IDI0cHg7CiAgICAgICAgYm9yZGVyLXJhZGl1czogMTJweDsKICAgICAgICB3aWR0aDogOTAlOwogICAgICAgIG1heC13aWR0aDogMzIwcHg7CiAgICAgICAgYm94LXNoYWRvdzogMCA0cHggMThweCAjMDAwNjsKICAgICAgfQogICAgICAuZXJyb3IgewogICAgICAgIGNvbG9yOiAjZjg3MTcxOwogICAgICAgIG1hcmdpbi1ib3R0b206IDEycHg7CiAgICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgICB9CiAgICAgIC5mb3JtLWNvbnRhaW5lciBpbnB1dCwKICAgICAgLmZvcm0tY29udGFpbmVyIGJ1dHRvbiB7CiAgICAgICAgd2lkdGg6IDEwMCU7CiAgICAgICAgcGFkZGluZzogMTJweDsKICAgICAgICBtYXJnaW46IDEwcHggMCAwOwogICAgICAgIGJvcmRlcjogbm9uZTsKICAgICAgICBib3JkZXItcmFkaXVzOiA2cHg7CiAgICAgICAgZm9udC1zaXplOiAxNnB4OwogICAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICAgIH0KICAgICAgaW5wdXQgewogICAgICAgIGJhY2tncm91bmQ6ICMyYTJhMzM7CiAgICAgICAgY29sb3I6ICNlZWU7CiAgICAgIH0KICAgICAgYnV0dG9uIHsKICAgICAgICBiYWNrZ3JvdW5kOiAjM2I4MmY2OwogICAgICAgIGNvbG9yOiAjZmZmOwogICAgICAgIGN1cnNvcjogcG9pbnRlcjsKICAgICAgICBmb250LXdlaWdodDogYm9sZDsKICAgICAgICBtYXJnaW4tdG9wOiAxNHB4OwogICAgICB9CiAgICA8L3N0eWxlPgogIDwvaGVhZD4KICA8Ym9keT4KICAgIDxmb3JtIGNsYXNzPSJmb3JtLWNvbnRhaW5lciIgbWV0aG9kPSJQT1NUIiBhY3Rpb249Ii9sb2dpbi1zdWJtaXQ/cmVkaXJlY3Q9JHtlbmNvZGVVUklDb21wb25lbnQocmVkaXJlY3RUbyl9Ij4KICAgICAgPGgyIHN0eWxlPSJtYXJnaW4tYm90dG9tOiAxMHB4OyB0ZXh0LWFsaWduOmNlbnRlcjsiPvCflJAgRGFzaGJvYXJkIExvZ2luPC9oMj4KICAgICAgJHtlcnJvck1zZyA/IGA8ZGl2IGNsYXNzPSJlcnJvciI+JHtlcnJvck1zZ308L2Rpdj5gIDogIiJ9CiAgICAgIDxpbnB1dCB0eXBlPSJwYXNzd29yZCIgbmFtZT0icGFzc3dvcmQiIHBsYWNlaG9sZGVyPSJFbnRlciBwYXNzd29yZCIgcmVxdWlyZWQgLz4KICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiPkxvZ2luPC9idXR0b24+CiAgICA8L2Zvcm0+CiAgPC9ib2R5PgogIDwvaHRtbD4KICBgKTsKfSk7CgovLyA9PT0gSGFuZGxlIExvZ2luIFN1Ym1pc3Npb24gPT09CmFwcC5wb3N0KCIvbG9naW4tc3VibWl0IiwgZXhwcmVzcy51cmxlbmNvZGVkKHsgZXh0ZW5kZWQ6IHRydWUgfSksIChyZXEsIHJlcykgPT4gewogIGNvbnN0IHsgcGFzc3dvcmQgfSA9IHJlcS5ib2R5OwogIGNvbnN0IHJlZGlyZWN0VG8gPSBzYWZlUmVkaXJlY3QocmVxLnF1ZXJ5LnJlZGlyZWN0IHx8ICIvIik7CgogIC8vIFdyb25nIHBhc3N3b3JkLCByZWRpcmVjdCBiYWNrIHRvIGxvZ2luIHdpdGggZXJyb3IKICBpZiAocGFzc3dvcmQgIT09IERBU0hfUEFTUykgewogICAgcmV0dXJuIHJlcy5yZWRpcmVjdChgL2xvZ2luP3JlZGlyZWN0PSR7ZW5jb2RlVVJJQ29tcG9uZW50KHJlZGlyZWN0VG8pfSZlcnJvcj0xYCk7CiAgfQoKICAvLyBTZXQgYXV0aGVudGljYXRpb24gY29va2llIChIVFRQIG9ubHkpCiAgcmVzLmNvb2tpZSgiZGFzaF9hdXRoIiwgREFTSF9QQVNTLCB7IGh0dHBPbmx5OiB0cnVlIH0pOwoKICAvLyBSZWRpcmVjdCB0byBvcmlnaW5hbGx5IHJlcXVlc3RlZCBwYWdlIChzYWZlKQogIHJlcy5yZWRpcmVjdChyZWRpcmVjdFRvKTsKfSk7CgovLyA9PT0gRGFzaGJvYXJkCmFwcC5nZXQoIi9kYXNoYm9hcmQiLCAocmVxLCByZXMpID0+IHsKICBjb25zdCBub3cgPSBEYXRlLm5vdygpOwoKICBmdW5jdGlvbiBmb3JtYXRBbW91bnQocykgewogICAgaWYgKHMudHlwZSA9PT0gImJvbmRzIikgcmV0dXJuIGAkeyhzLmN1cnJlbnRfYm9uZHMgLSBzLnN0YXJ0X2JvbmRzKSB8fCAwfSBib25kc2A7CiAgICBpZiAocy5zdGFydFRpbWUgJiYgcy5lbmRUaW1lKSB7CiAgICAgIGNvbnN0IG1pbnV0ZXMgPSBNYXRoLnJvdW5kKChzLmVuZFRpbWUgLSBzLnN0YXJ0VGltZSkgLyA2MDAwMCk7CiAgICAgIHJldHVybiBgJHttaW51dGVzfSBtaW5gOwogICAgfQogICAgcmV0dXJuICItIjsKICB9CgogIGZ1bmN0aW9uIHJlbmRlclJvd3MoaXRlbXMsIHR5cGUpIHsKICAgIGlmICghaXRlbXMubGVuZ3RoKSB7CiAgICAgIHJldHVybiBgPHRyPjx0ZCBjb2xzcGFuPSI3IiBzdHlsZT0iY29sb3I6I2FhYTt0ZXh0LWFsaWduOmNlbnRlcjsiPk5vICR7dHlwZX0gc2Vzc2lvbnM8L3RkPjwvdHI+YDsKICAgIH0KICAgIHJldHVybiBpdGVtcy5tYXAocyA9PiBgCiAgICAgIDx0cj4KICAgICAgICA8dGQ+JHtzLnVzZXJuYW1lfTwvdGQ+CiAgICAgICAgPHRkPiR7cy5ub19vcmRlciB8fCAiLSJ9PC90ZD4KICAgICAgICA8dGQ+JHtzLm5hbWFfc3RvcmUgfHwgIi0ifTwvdGQ+CiAgICAgICAgPHRkPiR7cy50eXBlIHx8ICJhZmsifTwvdGQ+CiAgICAgICAgPHRkPiR7Zm9ybWF0QW1vdW50KHMpfTwvdGQ+CiAgICAgICAgPHRkPgogICAgICAgICAgJHtzLm5vX29yZGVyID8gYAogICAgICAgICAgPGZvcm0gbWV0aG9kPSJHRVQiIGFjdGlvbj0iL2NhbmNlbC8ke3MudXNlcm5hbWV9LyR7cy5ub19vcmRlcn0iIAogICAgICAgICAgICAgICAgb25zdWJtaXQ9InJldHVybiBjb25maXJtRGVsZXRlKCcke3MudXNlcm5hbWV9JywnJHtzLm5vX29yZGVyfScsIHRoaXMpIj4KICAgICAgICAgICAgPGJ1dHRvbiBzdHlsZT0icGFkZGluZzo0cHggOHB4O2JhY2tncm91bmQ6I2VmNDQ0NDtjb2xvcjojZmZmO2JvcmRlcjpub25lO2JvcmRlci1yYWRpdXM6NHB4O2N1cnNvcjpwb2ludGVyOyI+4pyWIFJlbW92ZTwvYnV0dG9uPgogICAgICAgICAgPC9mb3JtPmAgOiBgLWB9CiAgICAgICAgPC90ZD4KICAgICAgPC90cj4KICAgIGApLmpvaW4oIiIpOwogIH0KCiAgY29uc3QgcGVuZExpc3QgPSBBcnJheS5mcm9tKHBlbmRpbmcudmFsdWVzKCkpOwogIGNvbnN0IGFjdGl2ZUxpc3QgPSBBcnJheS5mcm9tKHNlc3Npb25zLnZhbHVlcygpKTsKICBjb25zdCBjb21wbGV0ZWRMaXN0ID0gQXJyYXkuZnJvbShjb21wbGV0ZWQudmFsdWVzKCkpLmZsYXQoKTsgLy8gZmxhdHRlbiBhcnJheXMgb2Ygc2Vzc2lvbnMKICAKICByZXMuc2VuZChgCjwhRE9DVFlQRSBodG1sPgo8aHRtbCBsYW5nPSJlbiI+CjxoZWFkPgogIDxtZXRhIGNoYXJzZXQ9IlVURi04Ij4KICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLGluaXRpYWwtc2NhbGU9MS4wIj4KICA8dGl0bGU+RGFzaGJvYXJkPC90aXRsZT4KICA8c3R5bGU+CiAgICBib2R5IHsKICAgICAgbWFyZ2luOjA7IHBhZGRpbmc6MjBweDsKICAgICAgYmFja2dyb3VuZDogbGluZWFyLWdyYWRpZW50KDEzNWRlZywgIzBmMGYxYiwgIzEyMjZhNSk7CiAgICAgIGNvbG9yOiNlY2VjZWM7CiAgICAgIGZvbnQtZmFtaWx5OidJbnRlcicsQXJpYWwsc2Fucy1zZXJpZjsKICAgICAgbWluLWhlaWdodDogMTAwdmg7CiAgICB9CiAgICAuY29udGFpbmVyIHsgbWF4LXdpZHRoOjExMDBweDsgbWFyZ2luOmF1dG87IH0KICAgIGgxIHsgY29sb3I6IzNiODJmNjsgdGV4dC1hbGlnbjpjZW50ZXI7IH0KICAgIC5jYXJkIHsKICAgICAgYmFja2dyb3VuZDojMWQxZDI4OwogICAgICBwYWRkaW5nOjIwcHg7CiAgICAgIG1hcmdpbi1ib3R0b206MjBweDsKICAgICAgYm9yZGVyLXJhZGl1czoxNHB4OwogICAgICBib3gtc2hhZG93OjAgNHB4IDIwcHggIzAwMDg7CiAgICB9CiAgICBpbnB1dCwgc2VsZWN0LCBidXR0b24gewogICAgICB3aWR0aDoxMDAlOwogICAgICBwYWRkaW5nOjEycHg7CiAgICAgIG1hcmdpbi10b3A6OHB4OwogICAgICBib3JkZXI6bm9uZTsKICAgICAgYm9yZGVyLXJhZGl1czo2cHg7CiAgICAgIGJhY2tncm91bmQ6IzJhMmEzMzsKICAgICAgY29sb3I6I2VlZTsKICAgICAgZm9udC1zaXplOjE2cHg7CiAgICAgIGJveC1zaXppbmc6IGJvcmRlci1ib3g7CiAgICB9CiAgICBidXR0b24geyBiYWNrZ3JvdW5kOiMzYjgyZjY7IGZvbnQtd2VpZ2h0OmJvbGQ7IGN1cnNvcjpwb2ludGVyOyB9CiAgICB0YWJsZSB7CiAgICAgIHdpZHRoOjEwMCU7CiAgICAgIGJvcmRlci1jb2xsYXBzZTpjb2xsYXBzZTsKICAgICAgbWFyZ2luLXRvcDoxNnB4OwogICAgICBmb250LXNpemU6MTRweDsKICAgIH0KICAgIHRoLHRkIHsKICAgICAgcGFkZGluZzoxMHB4OwogICAgICBib3JkZXItYm90dG9tOjFweCBzb2xpZCAjMzMzOwogICAgICB0ZXh0LWFsaWduOmxlZnQ7CiAgICB9CiAgICB0aCB7CiAgICAgIGJhY2tncm91bmQ6IzJhMmEzMzsKICAgICAgY29sb3I6I2VlZTsKICAgIH0KICAgIHRyOmhvdmVyIHsgYmFja2dyb3VuZDojMmEyYTMzOyB9CiAgICAuYm90dG9tLWJ1dHRvbnMgewogICAgICBkaXNwbGF5OmZsZXg7CiAgICAgIGdhcDoxMHB4OwogICAgICBtYXJnaW46MjBweCAwOwogICAgfQogICAgLmJvdHRvbS1idXR0b25zIGZvcm0geyBmbGV4OjE7IH0KICAgIC5ib3R0b20tYnV0dG9ucyBidXR0b24gewogICAgICB3aWR0aDoxMDAlOwogICAgICBwYWRkaW5nOjEycHg7CiAgICAgIGJvcmRlcjpub25lOwogICAgICBib3JkZXItcmFkaXVzOjZweDsKICAgICAgY29sb3I6I2ZmZjsKICAgICAgZm9udC1zaXplOjE2cHg7CiAgICAgIGN1cnNvcjpwb2ludGVyOwogICAgfQogICAgLnNodXRkb3duLWJ0biB7IGJhY2tncm91bmQ6I2VmNDQ0NDsgfQogICAgLnVwZGF0ZS1idG4geyBiYWNrZ3JvdW5kOiMxMGI5ODE7IH0KICAgIC52ZXJzaW9uIHsKICAgICAgdGV4dC1hbGlnbjpjZW50ZXI7CiAgICAgIGZvbnQtc2l6ZToxNHB4OwogICAgICBjb2xvcjojYWFhOwogICAgfQogICAgQG1lZGlhKG1heC13aWR0aDo3NjhweCl7CiAgICAgIGlucHV0LCBzZWxlY3QsIGJ1dHRvbiB7IGZvbnQtc2l6ZToxOHB4OyB9CiAgICAgIHRhYmxlIHsgZm9udC1zaXplOjEycHg7IH0KICAgIH0KCiAgICAvKiBDb25maXJtYXRpb24gbW9kYWwgKi8KICAgIC5tb2RhbCB7CiAgICAgIGRpc3BsYXk6bm9uZTsKICAgICAgcG9zaXRpb246Zml4ZWQ7CiAgICAgIHRvcDowOyBsZWZ0OjA7IHJpZ2h0OjA7IGJvdHRvbTowOwogICAgICBiYWNrZ3JvdW5kOiMwMDBhOwogICAgICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgICAgIGp1c3RpZnktY29udGVudDpjZW50ZXI7CiAgICAgIHotaW5kZXg6MTAwMDsKICAgIH0KICAgIC5tb2RhbC1jb250ZW50IHsKICAgICAgYmFja2dyb3VuZDojMWQxZDI4OwogICAgICBwYWRkaW5nOjIwcHg7CiAgICAgIGJvcmRlci1yYWRpdXM6MTBweDsKICAgICAgbWF4LXdpZHRoOjQwMHB4OwogICAgICB0ZXh0LWFsaWduOmNlbnRlcjsKICAgICAgYm94LXNoYWRvdzowIDAgMjBweCAjMDAwODsKICAgIH0KICAgIC5tb2RhbC1jb250ZW50IGgzIHsKICAgICAgbWFyZ2luLXRvcDowOwogICAgICBjb2xvcjojM2I4MmY2OwogICAgfQogICAgLm1vZGFsLWJ1dHRvbnMgewogICAgICBtYXJnaW4tdG9wOjIwcHg7CiAgICAgIGRpc3BsYXk6ZmxleDsKICAgICAgZ2FwOjEwcHg7CiAgICAgIGp1c3RpZnktY29udGVudDpjZW50ZXI7CiAgICB9CiAgICAubW9kYWwtYnV0dG9ucyBidXR0b24gewogICAgICBmbGV4OjE7CiAgICAgIHBhZGRpbmc6MTBweDsKICAgICAgYm9yZGVyOm5vbmU7CiAgICAgIGJvcmRlci1yYWRpdXM6NnB4OwogICAgICBmb250LXNpemU6MTRweDsKICAgICAgY3Vyc29yOnBvaW50ZXI7CiAgICB9CiAgICAuY29uZmlybS1idG4geyBiYWNrZ3JvdW5kOiNlZjQ0NDQ7IGNvbG9yOiNmZmY7IH0KICAgIC5jYW5jZWwtYnRuIHsgYmFja2dyb3VuZDojMzc0MTUxOyBjb2xvcjojZmZmOyB9CiAgPC9zdHlsZT4KPC9oZWFkPgo8Ym9keT4KICA8ZGl2IGNsYXNzPSJjb250YWluZXIiPgogICAgPGgxPkpvYiBEYXNoYm9hcmQ8L2gxPgogICAgPGRpdiBpZD0iYmFubmVyIiBzdHlsZT0iZGlzcGxheTpub25lOyBwYWRkaW5nOjEwcHg7IG1hcmdpbjoxMHB4IDA7IGJvcmRlci1yYWRpdXM6NnB4OyB0ZXh0LWFsaWduOmNlbnRlcjsiPjwvZGl2PgogICAgPGRpdiBjbGFzcz0iY2FyZCI+CiAgICAgIDxoMj5DcmVhdGUgTmV3IEpvYjwvaDI+CiAgICAgIDxmb3JtIGlkPSJqb2JGb3JtIj4KICAgICAgICA8aW5wdXQgbmFtZT0idXNlcm5hbWUiIHBsYWNlaG9sZGVyPSJVc2VybmFtZSIgcmVxdWlyZWQgLz4KICAgICAgICA8aW5wdXQgbmFtZT0ibm9fb3JkZXIiIHBsYWNlaG9sZGVyPSJPcmRlciBJRCIgcmVxdWlyZWQgLz4KICAgICAgICA8aW5wdXQgbmFtZT0ibmFtYV9zdG9yZSIgcGxhY2Vob2xkZXI9IlN0b3JlIE5hbWUiIHJlcXVpcmVkIC8+CiAgICAgICAgPGlucHV0IG5hbWU9ImphbV9zZWxlc2FpX2pva2kiIHR5cGU9Im51bWJlciIgc3RlcD0iYW55IiBwbGFjZWhvbGRlcj0iRHVyYXRpb24gKGhvdXJzKSIgLz4KICAgICAgICA8aW5wdXQgbmFtZT0idGFyZ2V0X2JvbmQiIHR5cGU9Im51bWJlciIgcGxhY2Vob2xkZXI9IlRhcmdldCBCb25kIChmb3IgYm9uZHMpIiAvPgogICAgICAgIDxzZWxlY3QgbmFtZT0idHlwZSIgcmVxdWlyZWQ+CiAgICAgICAgICA8b3B0aW9uIHZhbHVlPSJhZmsiPkFGSzwvb3B0aW9uPgogICAgICAgICAgPG9wdGlvbiB2YWx1ZT0iYm9uZHMiPkJvbmRzPC9vcHRpb24+CiAgICAgICAgPC9zZWxlY3Q+CiAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiPvCfmoAgU3RhcnQgSm9iPC9idXR0b24+CiAgICAgIDwvZm9ybT4KICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9ImNhcmQiPgogICAgICA8aDI+UGVuZGluZyBKb2JzPC9oMj4KICAgICAgPGRpdiBzdHlsZT0ib3ZlcmZsb3cteDphdXRvOyI+CiAgICAgICAgPHRhYmxlPgogICAgICAgICAgPHRyPjx0aD5Vc2VybmFtZTwvdGg+PHRoPk9yZGVyPC90aD48dGg+U3RvcmU8L3RoPjx0aD5UeXBlPC90aD48dGg+SW5mbzwvdGg+PHRoPkFjdGlvbjwvdGg+PC90cj4KICAgICAgICAgICR7cmVuZGVyUm93cyhwZW5kTGlzdCwgInBlbmRpbmciKX0KICAgICAgICA8L3RhYmxlPgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9ImNhcmQiPgogICAgICA8aDI+QWN0aXZlIEpvYnM8L2gyPgogICAgICA8ZGl2IHN0eWxlPSJvdmVyZmxvdy14OmF1dG87Ij4KICAgICAgICA8dGFibGU+CiAgICAgICAgICA8dHI+PHRoPlVzZXJuYW1lPC90aD48dGg+T3JkZXI8L3RoPjx0aD5TdG9yZTwvdGg+PHRoPlR5cGU8L3RoPjx0aD5JbmZvPC90aD48dGg+QWN0aW9uPC90aD48L3RyPgogICAgICAgICAgJHtyZW5kZXJSb3dzKGFjdGl2ZUxpc3QsICJhY3RpdmUiKX0KICAgICAgICA8L3RhYmxlPgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9ImNhcmQiPgogICAgICA8aDI+Q29tcGxldGVkIEpvYnM8L2gyPgogICAgICA8ZGl2IHN0eWxlPSJvdmVyZmxvdy14OmF1dG87Ij4KICAgICAgICA8dGFibGU+CiAgICAgICAgICA8dHI+PHRoPlVzZXJuYW1lPC90aD48dGg+T3JkZXI8L3RoPjx0aD5TdG9yZTwvdGg+PHRoPlR5cGU8L3RoPjx0aD5JbmZvPC90aD48dGg+QWN0aW9uPC90aD48L3RyPgogICAgICAgICAgJHtyZW5kZXJSb3dzKGNvbXBsZXRlZExpc3QsICJjb21wbGV0ZWQiKX0KICAgICAgICA8L3RhYmxlPgogICAgICA8L2Rpdj4KICAgIDwvZGl2PgoKICAgIDxkaXYgY2xhc3M9ImJvdHRvbS1idXR0b25zIj4KICAgICAgPGZvcm0gbWV0aG9kPSJQT1NUIiBhY3Rpb249Ii9zaHV0ZG93biI+CiAgICAgICAgPGJ1dHRvbiB0eXBlPSJzdWJtaXQiIGNsYXNzPSJzaHV0ZG93bi1idG4iPvCflLQgU2h1dGRvd248L2J1dHRvbj4KICAgICAgPC9mb3JtPgogICAgICA8Zm9ybSBtZXRob2Q9IlBPU1QiIGFjdGlvbj0iL3Jlc3RhcnQiPgogICAgICAgIDxidXR0b24gdHlwZT0ic3VibWl0IiBjbGFzcz0idXBkYXRlLWJ0biI+8J+foiBVcGRhdGU8L2J1dHRvbj4KICAgICAgPC9mb3JtPgogICAgPC9kaXY+CgogICAgPGRpdiBjbGFzcz0idmVyc2lvbiI+CiAgICAgIHZlcnNpb246ICR7dmVyc2lvbn08YnI+CiAgICAgICR7Y2hhbmdlbG9nLm1hcChsID0+IGDigKIgJHtsfWApLmpvaW4oIjxicj4iKX0KICAgIDwvZGl2PgogIDwvZGl2PgoKICA8IS0tIENvbmZpcm1hdGlvbiBtb2RhbCAtLT4KICA8ZGl2IGNsYXNzPSJtb2RhbCIgaWQ9ImNvbmZpcm1Nb2RhbCI+CiAgICA8ZGl2IGNsYXNzPSJtb2RhbC1jb250ZW50Ij4KICAgICAgPGgzPkNvbmZpcm0gRGVsZXRlPC9oMz4KICAgICAgPHAgaWQ9ImNvbmZpcm1UZXh0Ij48L3A+CiAgICAgIDxkaXYgY2xhc3M9Im1vZGFsLWJ1dHRvbnMiPgogICAgICAgIDxidXR0b24gaWQ9ImNvbmZpcm1ZZXMiIGNsYXNzPSJjb25maXJtLWJ0biI+UmVtb3ZlPC9idXR0b24+CiAgICAgICAgPGJ1dHRvbiBpZD0iY29uZmlybU5vIiBjbGFzcz0iY2FuY2VsLWJ0biI+Q2FuY2VsPC9idXR0b24+CiAgICAgIDwvZGl2PgogICAgPC9kaXY+CiAgPC9kaXY+CgogIDxzY3JpcHQ+CiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiam9iRm9ybSIpLm9uc3VibWl0ID0gYXN5bmMgZSA9PiB7CiAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgY29uc3QgZGF0YSA9IE9iamVjdC5mcm9tRW50cmllcyhuZXcgRm9ybURhdGEoZS50YXJnZXQpKTsKICAgICAgYXdhaXQgZmV0Y2goIi9zdGFydC1qb2IiLCB7CiAgICAgICAgbWV0aG9kOiAiUE9TVCIsCiAgICAgICAgaGVhZGVyczogeyAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iIH0sCiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZGF0YSkKICAgICAgfSk7CiAgICAgIGxvY2F0aW9uLnJlbG9hZCgpOwogICAgfTsKCiAgICAvLyBCYW5uZXIgbWVzc2FnZSBvbiBsb2FkCiAgICBjb25zdCBwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpOwogICAgY29uc3QgYmFubmVyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImJhbm5lciIpOwogICAgaWYgKHBhcmFtcy5oYXMoInJlbW92ZWQiKSkgewogICAgICBiYW5uZXIudGV4dENvbnRlbnQgPSAi4pyFIFJlbW92ZWQgam9iICIgKyBwYXJhbXMuZ2V0KCJyZW1vdmVkIik7CiAgICAgIGJhbm5lci5zdHlsZS5kaXNwbGF5ID0gImJsb2NrIjsKICAgICAgYmFubmVyLnN0eWxlLmJhY2tncm91bmQgPSAiIzEwYjk4MSI7CiAgICAgIGJhbm5lci5zdHlsZS5jb2xvciA9ICIjZmZmIjsKICAgIH0gZWxzZSBpZiAocGFyYW1zLmhhcygiZXJyb3IiKSkgewogICAgICBiYW5uZXIudGV4dENvbnRlbnQgPSAi4pqg77iPIEpvYiBub3QgZm91bmQiOwogICAgICBiYW5uZXIuc3R5bGUuZGlzcGxheSA9ICJibG9jayI7CiAgICAgIGJhbm5lci5zdHlsZS5iYWNrZ3JvdW5kID0gIiNlZjQ0NDQiOwogICAgICBiYW5uZXIuc3R5bGUuY29sb3IgPSAiI2ZmZiI7CiAgICB9CgogICAgLy8gQ29uZmlybWF0aW9uIG1vZGFsIGxvZ2ljCiAgICBsZXQgcGVuZGluZ0Zvcm0gPSBudWxsOwogICAgZnVuY3Rpb24gY29uZmlybURlbGV0ZSh1c2VybmFtZSwgb3JkZXJJZCwgZm9ybUVsKSB7CiAgICAgIHBlbmRpbmdGb3JtID0gZm9ybUVsOwogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29uZmlybVRleHQiKS50ZXh0Q29udGVudCA9CiAgICAgICAgXGBVc2VybmFtZTogXCR7dXNlcm5hbWV9IHwgT3JkZXIgSUQ6IFwke29yZGVySWR9XGA7CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtTW9kYWwiKS5zdHlsZS5kaXNwbGF5ID0gImZsZXgiOwogICAgICByZXR1cm4gZmFsc2U7IC8vIGJsb2NrIGZvcm0gc3VibWl0IHVudGlsIGNvbmZpcm1lZAogICAgfQogICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoImNvbmZpcm1ZZXMiKS5vbmNsaWNrID0gKCkgPT4gewogICAgICBpZiAocGVuZGluZ0Zvcm0pIHBlbmRpbmdGb3JtLnN1Ym1pdCgpOwogICAgfTsKICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJjb25maXJtTm8iKS5vbmNsaWNrID0gKCkgPT4gewogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgiY29uZmlybU1vZGFsIikuc3R5bGUuZGlzcGxheSA9ICJub25lIjsKICAgICAgcGVuZGluZ0Zvcm0gPSBudWxsOwogICAgfTsKICA8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+CiAgYCk7Cn0pOwoKLy8gPT09IC90cmFjayBFbmRwb2ludCA9PT0KYXBwLnBvc3QoJy90cmFjaycsIChyZXEsIHJlcykgPT4gewogICAgY29uc3QgeyB1c2VybmFtZSB9ID0gcmVxLmJvZHk7CiAgICBpZiAoIXVzZXJuYW1lKSB7CiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdNaXNzaW5nIHVzZXJuYW1lJyB9KTsKICAgIH0KCiAgICBjb25zdCB1c2VyID0gdXNlcm5hbWUudG9Mb3dlckNhc2UoKTsgLy8gTm9ybWFsaXplIHVzZXJuYW1lCgogICAgbGV0IGpvYiA9IHNlc3Npb25zLmdldCh1c2VyKTsKCiAgICAvLyBJZiBub3QgaW4gc2Vzc2lvbnMsIGJ1dCBpbiBwZW5kaW5nOiBtb3ZlIHRvIHNlc3Npb25zIQogICAgaWYgKCFqb2IpIHsKICAgICAgICBqb2IgPSBwZW5kaW5nLmdldCh1c2VyKTsKICAgICAgICBpZiAoam9iKSB7CiAgICAgICAgICAgIHBlbmRpbmcuZGVsZXRlKHVzZXIpOwogICAgICAgICAgICAvLyBBc3N1bWUgam9iLnN0YXJ0VGltZSBhbmQgam9iLmVuZFRpbWUgYXJlIGFsd2F5cyBzZXQKICAgICAgICAgICAgc2Vzc2lvbnMuc2V0KHVzZXIsIGpvYik7CiAgICAgICAgICAgIHNhdmVTdG9yYWdlKCk7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICdObyBqb2IgZm91bmQgZm9yIHRoaXMgdXNlcicgfSk7CiAgICAgICAgfQogICAgfQogICAgbGFzdFNlZW4uc2V0KHVzZXIsIERhdGUubm93KCkpOwogICAgcmVzLmpzb24oewogICAgICAgIGVuZFRpbWU6IGpvYi5lbmRUaW1lLAogICAgICAgIHN0YXJ0VGltZTogam9iLnN0YXJ0VGltZSwKICAgICAgICBkdXJhdGlvbjogam9iLmR1cmF0aW9uCiAgICB9KTsKfSk7CgovLyA9PT0gL3N0YXJ0LWpvYiA9PT0KYXBwLnBvc3QoIi9zdGFydC1qb2IiLCBhc3luYyAocmVxLCByZXMpID0+IHsKICBjb25zdCB7CiAgICB1c2VybmFtZSwKICAgIG5vX29yZGVyLAogICAgbmFtYV9zdG9yZSwKICAgIGphbV9zZWxlc2FpX2pva2ksCiAgICB0YXJnZXRfYm9uZCwKICAgIHR5cGUKICB9ID0gcmVxLmJvZHk7CgogIGNvbnN0IHVzZXIgPSB1c2VybmFtZS50b0xvd2VyQ2FzZSgpOwogIGNvbnN0IG5vdyA9IERhdGUubm93KCk7CiAgY29uc3QgaG91cnMgPSBwYXJzZUZsb2F0KGphbV9zZWxlc2FpX2pva2kgfHwgIjAiKSB8fCAwOwogIGNvbnN0IGVuZFRpbWUgPSBub3cgKyBob3VycyAqIDM2MDAgKiAxMDAwOwoKICBjb25zdCBzZXNzaW9uID0gewogICAgdXNlcm5hbWUsCiAgICBub19vcmRlciwKICAgIG5hbWFfc3RvcmUsCiAgICBlbmRUaW1lLAogICAgdHlwZSwKICAgIHN0YXJ0X2JvbmRzOiAwLAogICAgY3VycmVudF9ib25kczogMCwKICAgIHRhcmdldF9ib25kOiBwYXJzZUludCh0YXJnZXRfYm9uZCB8fCAiMCIpLAogICAgc3RhcnRUaW1lOiBub3cKICB9OwoKICBwZW5kaW5nLnNldCh1c2VyLCBzZXNzaW9uKTsKICBzYXZlU3RvcmFnZSgpOwoKICAvLyBTZW5kIGVtYmVkIHRvIERpc2NvcmQgKHllbGxvdyBmb3Igc3RhcnQpCiAgY29uc3QgZW1iZWQgPSB7CiAgICBlbWJlZHM6IFt7CiAgICAgIHRpdGxlOiBg8J+agCBOZXcgSm9raSBTdGFydGVkIOKAkyAke3VzZXJuYW1lfWAsCiAgICAgIGRlc2NyaXB0aW9uOiBgKipUeXBlOioqICR7dHlwZX1cbioqT3JkZXI6KiogJHtub19vcmRlcn1cbioqU3RvcmU6KiogJHtuYW1hX3N0b3JlfWAsCiAgICAgIGNvbG9yOiAweGZmZDcwMCwKICAgICAgZmllbGRzOiBbewogICAgICAgIG5hbWU6ICJFbmQgVGltZSIsCiAgICAgICAgdmFsdWU6IGA8dDoke01hdGguZmxvb3IoZW5kVGltZSAvIDEwMDApfTpSPmAsCiAgICAgICAgaW5saW5lOiB0cnVlCiAgICAgIH0sIHsKICAgICAgICBuYW1lOiAiU3RhcnQgVGltZSIsCiAgICAgICAgdmFsdWU6IGA8dDoke01hdGguZmxvb3Iobm93IC8gMTAwMCl9OkY+YCwKICAgICAgICBpbmxpbmU6IHRydWUKICAgICAgfV0KICAgIH1dCiAgfTsKCiAgZmV0Y2goYGh0dHBzOi8vZGlzY29yZC5jb20vYXBpL3YxMC9jaGFubmVscy8ke0NIQU5ORUx9L21lc3NhZ2VzYCwgewogICAgbWV0aG9kOiAiUE9TVCIsCiAgICBoZWFkZXJzOiB7CiAgICAgICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsCiAgICAgIEF1dGhvcml6YXRpb246IGBCb3QgJHtCT1RfVE9LRU59YAogICAgfSwKICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGVtYmVkKQogIH0pLmNhdGNoKGNvbnNvbGUuZXJyb3IpOwoKICByZXMuanNvbih7IG9rOiB0cnVlIH0pOwp9KTsKCi8vID09PSAvY2FuY2VsLzp1c2VybmFtZSA9PT0KYXBwLmdldCgiL2NhbmNlbC86dXNlcm5hbWUvOm9yZGVyIiwgKHJlcSwgcmVzKSA9PiB7CiAgY29uc3QgdW5hbWUgPSByZXEucGFyYW1zLnVzZXJuYW1lLnRvTG93ZXJDYXNlKCk7CiAgY29uc3Qgb3JkZXIgPSByZXEucGFyYW1zLm9yZGVyLnRvTG93ZXJDYXNlKCk7CgogIGxldCByZW1vdmVkID0gZmFsc2U7CgogIC8vIEFjdGl2ZQogIGlmIChzZXNzaW9ucy5oYXModW5hbWUpKSB7CiAgICBjb25zdCBzID0gc2Vzc2lvbnMuZ2V0KHVuYW1lKTsKICAgIGlmIChzLm5vX29yZGVyICYmIHMubm9fb3JkZXIudG9Mb3dlckNhc2UoKSA9PT0gb3JkZXIpIHsKICAgICAgc2Vzc2lvbnMuZGVsZXRlKHVuYW1lKTsKICAgICAgbGFzdFNlZW4uZGVsZXRlKHVuYW1lKTsKICAgICAgbGFzdFNlbnQuZGVsZXRlKHVuYW1lKTsKICAgICAgcmVtb3ZlZCA9IHRydWU7CiAgICB9CiAgfQoKICAvLyBQZW5kaW5nCiAgaWYgKHBlbmRpbmcuaGFzKHVuYW1lKSkgewogICAgY29uc3QgcyA9IHBlbmRpbmcuZ2V0KHVuYW1lKTsKICAgIGlmIChzLm5vX29yZGVyICYmIHMubm9fb3JkZXIudG9Mb3dlckNhc2UoKSA9PT0gb3JkZXIpIHsKICAgICAgcGVuZGluZy5kZWxldGUodW5hbWUpOwogICAgICByZW1vdmVkID0gdHJ1ZTsKICAgIH0KICB9CgogIC8vIENvbXBsZXRlZAogIGlmIChjb21wbGV0ZWQuaGFzKHVuYW1lKSkgewogICAgY29uc3QgYXJyID0gY29tcGxldGVkLmdldCh1bmFtZSk7CiAgICBjb25zdCBuZXdBcnIgPSBhcnIuZmlsdGVyKHMgPT4gIXMubm9fb3JkZXIgfHwgcy5ub19vcmRlci50b0xvd2VyQ2FzZSgpICE9PSBvcmRlcik7CiAgICBpZiAobmV3QXJyLmxlbmd0aCAhPT0gYXJyLmxlbmd0aCkgewogICAgICBjb21wbGV0ZWQuc2V0KHVuYW1lLCBuZXdBcnIpOwogICAgICByZW1vdmVkID0gdHJ1ZTsKICAgIH0KICB9CgogIGlmIChyZW1vdmVkKSB7CiAgICBzYXZlU3RvcmFnZSgpOwogICAgcmV0dXJuIHJlcy5yZWRpcmVjdChgL2Rhc2hib2FyZD9yZW1vdmVkPSR7dW5hbWV9OiR7b3JkZXJ9YCk7CiAgfSBlbHNlIHsKICAgIHJldHVybiByZXMucmVkaXJlY3QoIi9kYXNoYm9hcmQ/ZXJyb3I9bm90Zm91bmQiKTsKICB9Cn0pOwoKLy8gPT09IGJvbmQKYXBwLnBvc3QoIi9ib25kIiwgYXN5bmMgKHJlcSwgcmVzKSA9PiB7CiAgY29uc3QgeyB1c2VybmFtZSwgYm9uZHMsIHBsYWNlSWQsIGFsZXJ0IH0gPSByZXEuYm9keTsKCiAgaWYgKCF1c2VybmFtZSkgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICJNaXNzaW5nIHVzZXJuYW1lIiB9KTsKCiAgY29uc3QgdXNlciA9IHVzZXJuYW1lLnRvTG93ZXJDYXNlKCk7CiAgY29uc3Qgc2Vzc2lvbiA9IHNlc3Npb25zLmdldCh1c2VyKTsKCiAgLy8g8J+foSBIYW5kbGUgaWRsZSBhbGVydCBmcm9tIGxvYmJ5CiAgaWYgKGFsZXJ0ID09PSAibG9iYnlfaWRsZSIpIHsKICAgIGF3YWl0IGZldGNoKGBodHRwczovL2Rpc2NvcmQuY29tL2FwaS92MTAvY2hhbm5lbHMvJHtDSEFOTkVMfS9tZXNzYWdlc2AsIHsKICAgICAgbWV0aG9kOiAiUE9TVCIsCiAgICAgIGhlYWRlcnM6IHsKICAgICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICAgIEF1dGhvcml6YXRpb246IGBCb3QgJHtCT1RfVE9LRU59YAogICAgICB9LAogICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7CiAgICAgICAgY29udGVudDogYOKaoO+4jyBAZXZlcnlvbmUgJHt1c2VybmFtZX0gaGFzIGJlZW4gaWRsZSBpbiB0aGUgbG9iYnkgZm9yIHRvbyBsb25nLmAKICAgICAgfSkKICAgIH0pLmNhdGNoKGNvbnNvbGUuZXJyb3IpOwogICAgcmV0dXJuIHJlcy5qc29uKHsgb2s6IHRydWUsIGFsZXJ0OiAiaWRsZV9zZW50IiB9KTsKICB9CgogIC8vIPCfn6IgVXBkYXRlIGFjdGl2ZSBzZXNzaW9uCiAgaWYgKHNlc3Npb24pIHsKICAgIHNlc3Npb24ubGFzdFBsYWNlSWQgPSBwbGFjZUlkOwogICAgc2Vzc2lvbi5jdXJyZW50X2JvbmRzID0gYm9uZHM7CgogICAgaWYgKHNlc3Npb24uc3RhcnRfYm9uZHMgPT09IHVuZGVmaW5lZCB8fCBzZXNzaW9uLnN0YXJ0X2JvbmRzID09PSAwKSB7CiAgICAgIHNlc3Npb24uc3RhcnRfYm9uZHMgPSBib25kczsKICAgIH0KCiAgICAvLyBDaGVjayBpZiBib25kIGdvYWwgbWV0CiAgICBpZiAoCiAgICAgIHNlc3Npb24udHlwZSA9PT0gImJvbmRzIiAmJgogICAgICBzZXNzaW9uLnRhcmdldF9ib25kICYmCiAgICAgIChib25kcyAtIHNlc3Npb24uc3RhcnRfYm9uZHMgPj0gc2Vzc2lvbi50YXJnZXRfYm9uZCkKICAgICkgewogICAgICBjb25zdCBub3cgPSBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKTsKICAgICAgY29uc3QgY2xlYW4gPSBzZXNzaW9uLm5vX29yZGVyLnJlcGxhY2UoL15PRDAwMDAwMC8sICIiKTsKCiAgICAgIC8vIOKchSBOb3RpZnkgRGlzY29yZAogICAgICBhd2FpdCBmZXRjaChgaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdjEwL2NoYW5uZWxzLyR7Q0hBTk5FTH0vbWVzc2FnZXNgLCB7CiAgICAgICAgbWV0aG9kOiAiUE9TVCIsCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICAgIEF1dGhvcml6YXRpb246IGBCb3QgJHtCT1RfVE9LRU59YAogICAgICAgIH0sCiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoewogICAgICAgICAgZW1iZWRzOiBbewogICAgICAgICAgICB0aXRsZTogIuKchSAqKkpPS0kgQ09NUExFVEVEKioiLAogICAgICAgICAgICBkZXNjcmlwdGlvbjoKICAgICAgICAgICAgICBgKipVc2VybmFtZToqKiAke3Nlc3Npb24udXNlcm5hbWV9XG5gICsKICAgICAgICAgICAgICBgKipPcmRlciBJRDoqKiAke3Nlc3Npb24ubm9fb3JkZXJ9XG5gICsKICAgICAgICAgICAgICBgW/CflJcgVmlldyBPcmRlcl0oaHR0cHM6Ly90b2tva3UuaXRlbWt1LmNvbS9yaXdheWF0LXBlc2FuYW4vcmluY2lhbi8ke2NsZWFufSlcblxuYCArCiAgICAgICAgICAgICAgYOKPsCBDb21wbGV0ZWQgYXQ6IDx0OiR7bm93fTpmPmAsCiAgICAgICAgICAgIGZvb3RlcjogeyB0ZXh0OiBgLSAke3Nlc3Npb24ubmFtYV9zdG9yZX1gIH0KICAgICAgICAgIH1dCiAgICAgICAgfSkKICAgICAgfSkuY2F0Y2goY29uc29sZS5lcnJvcik7CgogICAgICAvLyBNb3ZlIHRvIGNvbXBsZXRlZCAoYXBwZW5kIHRvIGFycmF5KQogICAgICBzZXNzaW9uLmNvbXBsZXRlZEF0ID0gRGF0ZS5ub3coKTsKICAgICAgc2Vzc2lvbnMuZGVsZXRlKHVzZXIpOwogICAgICBsYXN0U2Vlbi5kZWxldGUodXNlcik7CiAgICAgIGlmICghY29tcGxldGVkLmhhcyh1c2VyKSkgY29tcGxldGVkLnNldCh1c2VyLCBbXSk7CiAgICAgIGNvbXBsZXRlZC5nZXQodXNlcikucHVzaChzZXNzaW9uKTsKICAgICAgc2F2ZVN0b3JhZ2UoKTsKCiAgICAgIHJldHVybiByZXMuanNvbih7IG9rOiB0cnVlLCBjb21wbGV0ZWQ6IHRydWUgfSk7CiAgICB9CgogICAgLy8gVXBkYXRlIGhlYXJ0YmVhdAogICAgbGFzdFNlbnQuc2V0KHVzZXIsIERhdGUubm93KCkpOwogICAgc2F2ZVN0b3JhZ2UoKTsKCiAgICByZXR1cm4gcmVzLmpzb24oeyBvazogdHJ1ZSB9KTsKICB9CgogIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAiTm8gYWN0aXZlIHNlc3Npb24iIH0pOwp9KTsKCi8vID09PSAvc3RhdHVzIChVSSBQYWdlKQphcHAuZ2V0KCIvc3RhdHVzIiwgKHJlcSwgcmVzKSA9PiB7CiAgcmVzLnNlbmQoYDwhRE9DVFlQRSBodG1sPgo8aHRtbCBsYW5nPSJpZCI+CjxoZWFkPgogIDxtZXRhIGNoYXJzZXQ9IlVURi04Ii8+CiAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9IndpZHRoPWRldmljZS13aWR0aCwgaW5pdGlhbC1zY2FsZT0xLjAiLz4KICA8dGl0bGU+Q2hlY2sgSm9raSBTdGF0dXM8L3RpdGxlPgogIDxzdHlsZT4KICAgIGJvZHkgewogICAgICBtYXJnaW46IDA7IHBhZGRpbmc6IDA7CiAgICAgIG1pbi1oZWlnaHQ6IDEwMHZoOwogICAgICBmb250LWZhbWlseTogJ0ludGVyJywgc2Fucy1zZXJpZjsKICAgICAgZGlzcGxheTogZmxleDsganVzdGlmeS1jb250ZW50OiBjZW50ZXI7IGFsaWduLWl0ZW1zOiBjZW50ZXI7CiAgICAgIGJhY2tncm91bmQ6IGxpbmVhci1ncmFkaWVudCh0byBib3R0b20gcmlnaHQsICMwZjE3MmEsICMxZTNhOGEpOwogICAgICBjb2xvcjogI2VlZTsKICAgIH0KICAgIC5tYWluLWNvbnRhaW5lciB7CiAgICAgIGJhY2tncm91bmQ6IHJnYmEoMzUsIDM1LCA0NSwgMC45NSk7CiAgICAgIGJvcmRlci1yYWRpdXM6IDEycHg7CiAgICAgIGJveC1zaGFkb3c6IDAgMnB4IDE2cHggIzAwMDg7CiAgICAgIHBhZGRpbmc6IDIwcHg7CiAgICAgIHdpZHRoOiA5MCU7IG1heC13aWR0aDogNTAwcHg7CiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgIH0KICAgIC5pbnB1dC1ncm91cCB7CiAgICAgIGRpc3BsYXk6IGZsZXg7CiAgICAgIG1hcmdpbi10b3A6IDE2cHg7CiAgICB9CiAgICAjdSB7CiAgICAgIGZsZXg6IDE7CiAgICAgIHBhZGRpbmc6IDEycHg7CiAgICAgIGZvbnQtc2l6ZTogMTZweDsKICAgICAgYm9yZGVyOiBub25lOwogICAgICBib3JkZXItcmFkaXVzOiA0cHggMCAwIDRweDsKICAgICAgYmFja2dyb3VuZDogIzJhMmEzMzsKICAgICAgY29sb3I6ICNlZWU7CiAgICB9CiAgICBidXR0b24gewogICAgICBwYWRkaW5nOiAxMnB4IDE2cHg7CiAgICAgIGZvbnQtc2l6ZTogMTZweDsKICAgICAgYm9yZGVyOiBub25lOwogICAgICBib3JkZXItcmFkaXVzOiAwIDRweCA0cHggMDsKICAgICAgYmFja2dyb3VuZDogIzNiODJmNjsKICAgICAgY29sb3I6IHdoaXRlOwogICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICB9CiAgICAuc3RhdHVzLWZyYW1lIHsKICAgICAgbWFyZ2luLXRvcDogMjBweDsKICAgICAgcGFkZGluZzogMTZweDsKICAgICAgYmFja2dyb3VuZDogIzJjMmMzNDsKICAgICAgYm9yZGVyLXJhZGl1czogOHB4OwogICAgICBib3gtc2hhZG93OiAwIDJweCAxMHB4ICMwMDA7CiAgICAgIHRleHQtYWxpZ246IGNlbnRlcjsKICAgICAgdHJhbnNpdGlvbjogYWxsIDAuM3MgZWFzZS1pbi1vdXQ7CiAgICAgIG9wYWNpdHk6IDA7CiAgICAgIHRyYW5zZm9ybTogc2NhbGUoMC45OCk7CiAgICB9CiAgICAuc3RhdHVzLWZyYW1lLnZpc2libGUgewogICAgICBvcGFjaXR5OiAxOwogICAgICB0cmFuc2Zvcm06IHNjYWxlKDEpOwogICAgfQogICAgLnFyLWZyYW1lIHsKICAgICAgbWFyZ2luLXRvcDogMjBweDsKICAgICAgcGFkZGluZzogMTZweDsKICAgICAgYmFja2dyb3VuZDogIzFmMWYyNTsKICAgICAgYm9yZGVyLXJhZGl1czogOHB4OwogICAgICB0ZXh0LWFsaWduOiBsZWZ0OwogICAgICBmb250LXNpemU6IDE0cHg7CiAgICB9CiAgICBoMyB7CiAgICAgIG1hcmdpbi1ib3R0b206IDhweDsKICAgICAgY29sb3I6ICM2MGE1ZmE7CiAgICB9CiAgPC9zdHlsZT4KPC9oZWFkPgo8Ym9keT4KICA8ZGl2IGNsYXNzPSJtYWluLWNvbnRhaW5lciI+CiAgICA8aDI+8J+UjSBDZWsgU3RhdHVzIEpva2k8L2gyPgogICAgPGRpdiBjbGFzcz0iaW5wdXQtZ3JvdXAiPgogICAgICA8aW5wdXQgaWQ9InUiIHBsYWNlaG9sZGVyPSJVc2VybmFtZSBhdGF1IE9yZGVyIElEIi8+CiAgICAgIDxidXR0b24gb25jbGljaz0ic3RhcnRDaGVjaygpIj5DaGVjazwvYnV0dG9uPgogICAgPC9kaXY+CgogICAgPGRpdiBpZD0iciIgY2xhc3M9InN0YXR1cy1mcmFtZSI+PC9kaXY+CgogICAgPGRpdiBjbGFzcz0icXItZnJhbWUiPgogICAgICA8aDM+TWF1IERpc2tvbiBVbnR1ayBQZW1iZWxpYW4gU2VsYW5qdXRueWE/PC9oMz4KICAgICAgPHA+TWludGEga29kZSBRUklTIGtlIG93bmVyIHZpYSBXaGF0c0FwcCB1bnR1ayBkYXBhdCBoYXJnYSBsZWJpaCBtdXJhaC48L3A+CiAgICAgIDxoMz5BcGFrYWggVGlkYWsgQmlzYSBNZW5kYXBhdGthbiBEaXNrb24gRGkgSXRlbWt1PzwvaDM+CiAgICAgIDxwPkthcmVuYSBhZGEgcGFqYWsgMTIlIGRhcmkgSXRlbWt1LCBzYXlhIGhhbnlhIGJpc2EgYmVyaWthbiBoYXJnYSBzZWdpdHUuIEluaSBRUklTIHNheWEgc2ViZWx1bSBwaW5kYWgga2UgSXRlbWt1LjwvcD4KICAgICAgPGgzPkR1bHUgQmVyanVhbGFuIERpbWFuYT88L2gzPgogICAgICA8cD7wn6SrPC9wPgogICAgPC9kaXY+CiAgPC9kaXY+CgogIDxzY3JpcHQ+CiAgICBsZXQgaW50ZXJ2YWw7CiAgICBmdW5jdGlvbiBzdGFydENoZWNrKCkgewogICAgICBjbGVhckludGVydmFsKGludGVydmFsKTsKICAgICAgY29uc3QgcSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd1JykudmFsdWUudHJpbSgpOwogICAgICBpZiAoIXEpIHJldHVybjsKICAgICAgY2hlY2socSk7CiAgICAgIGludGVydmFsID0gc2V0SW50ZXJ2YWwoKCkgPT4gY2hlY2socSksIDEwMDApOwogICAgfQoKICAgIGFzeW5jIGZ1bmN0aW9uIGNoZWNrKHEpIHsKICAgICAgY29uc3Qgb3V0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3InKTsKICAgICAgdHJ5IHsKICAgICAgICBjb25zdCByZXMgPSBhd2FpdCBmZXRjaCgnL3N0YXR1cy8nICsgZW5jb2RlVVJJQ29tcG9uZW50KHEpICsgJz9mb3JtYXQ9anNvbicpOwogICAgICAgIGNvbnN0IGQgPSBhd2FpdCByZXMuanNvbigpOwoKICAgICAgICBvdXQuY2xhc3NMaXN0LmFkZCgndmlzaWJsZScpOwoKICAgICAgICBpZiAoIXJlcy5vaykgewogICAgICAgICAgb3V0LmlubmVySFRNTCA9ICfinYwgJyArIChkLmVycm9yIHx8ICdVbmtub3duIGVycm9yJyk7CiAgICAgICAgICBjbGVhckludGVydmFsKGludGVydmFsKTsKICAgICAgICAgIHJldHVybjsKICAgICAgICB9CgogICAgICAgIGlmIChkLnBlbmRpbmcpIHsKICAgICAgICAgIG91dC5pbm5lckhUTUwgPSAn4oybIDxiPicgKyBkLnVzZXJuYW1lICsgJzwvYj4gc2VkYW5nIG1lbnVuZ2d1Li4uJzsKICAgICAgICB9IGVsc2UgaWYgKGQuYWN0aXZlKSB7CiAgICAgICAgICBpZiAoZC5vZmZsaW5lKSB7CiAgICAgICAgICAgIG91dC5pbm5lckhUTUwgPSAn8J+UtCA8Yj4nICsgZC51c2VybmFtZSArICc8L2I+IG9mZmxpbmUnOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CiAgICAgICAgICBsZXQgdGV4dCA9ICfwn5+iIDxiPicgKyBkLnVzZXJuYW1lICsgJzwvYj4gYWt0aWY8YnI+JzsKICAgICAgICAgIGlmIChkLnRpbWVMZWZ0KSB7CiAgICAgICAgICAgIGNvbnN0IHJlbSA9IE1hdGgubWF4KDAsIE1hdGguZmxvb3IoZC50aW1lTGVmdCAvIDEwMDApKTsKICAgICAgICAgICAgY29uc3QgaCA9IE1hdGguZmxvb3IocmVtIC8gMzYwMCksIG0gPSBNYXRoLmZsb29yKChyZW0gJSAzNjAwKSAvIDYwKSwgcyA9IHJlbSAlIDYwOwogICAgICAgICAgICB0ZXh0ICs9ICfij7MgVGltZSBsZWZ0OiAnICsgaCArICdoICcgKyBtICsgJ20gJyArIHMgKyAnczxicj4nOwogICAgICAgICAgfQogICAgICAgICAgaWYgKGQubGFzdFNlZW4pIHsKICAgICAgICAgICAgY29uc3QgYWdvID0gTWF0aC5mbG9vcihkLmxhc3RTZWVuIC8gMTAwMCk7CiAgICAgICAgICAgIGNvbnN0IGxtID0gTWF0aC5mbG9vcihhZ28gLyA2MCk7CiAgICAgICAgICAgIGNvbnN0IGxzID0gYWdvICUgNjA7CiAgICAgICAgICAgIHRleHQgKz0gJ/CfkYHvuI8gTGFzdCBzZWVuOiAnICsgbG0gKyAnbSAnICsgbHMgKyAncyBhZ288YnI+JzsKICAgICAgICAgIH0KICAgICAgICAgIGlmIChkLmNvbXBsZXRlZCAmJiBkLmNvbXBsZXRlZC5sZW5ndGgpIHsKICAgICAgICAgICAgdGV4dCArPSAnPGg0PkNvbXBsZXRlZCBzZXNzaW9uKHMpOjwvaDQ+JzsKICAgICAgICAgICAgZC5jb21wbGV0ZWQuZm9yRWFjaChjID0+IHsKICAgICAgICAgICAgICB0ZXh0ICs9ICciJyArIGMudXNlcm5hbWUgKyAnIiBzZWxlc2FpIChvcmRlcjogJyArIChjLm5vX29yZGVyIHx8ICctJykgKyAnKTxicj4nOwogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIG91dC5pbm5lckhUTUwgPSB0ZXh0OwogICAgICAgIH0gZWxzZSBpZiAoZC5jb21wbGV0ZWQgJiYgZC5jb21wbGV0ZWQubGVuZ3RoKSB7CiAgICAgICAgICBsZXQgdGV4dCA9ICc8aDQ+Q29tcGxldGVkIHNlc3Npb24ocyk6PC9oND4nOwogICAgICAgICAgZC5jb21wbGV0ZWQuZm9yRWFjaChjID0+IHsKICAgICAgICAgICAgdGV4dCArPSAnIicgKyBjLnVzZXJuYW1lICsgJyIgc2VsZXNhaSAob3JkZXI6ICcgKyAoYy5ub19vcmRlciB8fCAnLScpICsgJyk8YnI+JzsKICAgICAgICAgIH0pOwogICAgICAgICAgb3V0LmlubmVySFRNTCA9IHRleHQ7CiAgICAgICAgfSBlbHNlIGlmIChkLm9mZmxpbmUpIHsKICAgICAgICAgIG91dC5pbm5lckhUTUwgPSAn8J+UtCA8Yj4nICsgZC51c2VybmFtZSArICc8L2I+IG9mZmxpbmUnOwogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICBvdXQuaW5uZXJIVE1MID0gZC5tZXNzYWdlIHx8ICfinYwgVGlkYWsgYWRhIHNlc2kgZGl0ZW11a2FuJzsKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggewogICAgICAgIG91dC5pbm5lckhUTUwgPSAn4p2MIEVycm9yIGZldGNoaW5nIHN0YXR1cyc7CiAgICAgICAgY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7CiAgICAgIH0KICAgIH0KICA8L3NjcmlwdD4KPC9ib2R5Pgo8L2h0bWw+YCk7Cn0pOwphcHAuZ2V0KCIvc3RhdHVzLzpxdWVyeSIsIChyZXEsIHJlcykgPT4gewogIGNvbnN0IHVuYW1lID0gcmVxLnBhcmFtcy5xdWVyeS50b0xvd2VyQ2FzZSgpOwogIGNvbnN0IGZvcm1hdCA9IHJlcS5xdWVyeS5mb3JtYXQgfHwgImpzb24iOyAvLyBqc29uIHwgdGV4dAogIGNvbnN0IGxlZ2FjeSA9IHJlcS5xdWVyeS5sZWdhY3kgPT09ICIxIjsKCiAgbGV0IHJlc3VsdCA9IHsKICAgIHVzZXJuYW1lOiB1bmFtZSwKICAgIHBlbmRpbmc6IGZhbHNlLAogICAgYWN0aXZlOiBmYWxzZSwKICAgIGNvbXBsZXRlZDogW10sCiAgICBvZmZsaW5lOiBmYWxzZSwKICAgIG1lc3NhZ2U6ICIiCiAgfTsKCiAgLy8gUGVuZGluZwogIGlmIChwZW5kaW5nLmhhcyh1bmFtZSkpIHsKICAgIHJlc3VsdC5wZW5kaW5nID0gdHJ1ZTsKICAgIHJlc3VsdC5tZXNzYWdlID0gIuKMmyAiICsgdW5hbWUgKyAiIHNlZGFuZyBtZW51bmdndS4uLiI7CgogICAgaWYgKGZvcm1hdCA9PT0gInRleHQiKSByZXR1cm4gcmVzLnNlbmQocmVzdWx0Lm1lc3NhZ2UpOwogICAgaWYgKGxlZ2FjeSkgcmV0dXJuIHJlcy5qc29uKHsgc3RhdHVzOiAicGVuZGluZyIsIHVzZXJuYW1lOiB1bmFtZSwgbWVzc2FnZTogcmVzdWx0Lm1lc3NhZ2UgfSk7CiAgICByZXR1cm4gcmVzLmpzb24ocmVzdWx0KTsKICB9CgogIC8vIEFjdGl2ZQogIGlmIChzZXNzaW9ucy5oYXModW5hbWUpKSB7CiAgICBjb25zdCBzID0gc2Vzc2lvbnMuZ2V0KHVuYW1lKTsKICAgIGNvbnN0IHRpbWVMZWZ0ID0gcy5lbmRUaW1lID8gcy5lbmRUaW1lIC0gRGF0ZS5ub3coKSA6IDA7CiAgICBjb25zdCBsYXN0U2VlblRpbWUgPSBsYXN0U2Vlbi5oYXModW5hbWUpID8gRGF0ZS5ub3coKSAtIGxhc3RTZWVuLmdldCh1bmFtZSkgOiBudWxsOwoKICAgIHJlc3VsdC5hY3RpdmUgPSB0cnVlOwogICAgcmVzdWx0Lm9mZmxpbmUgPSAhIXMub2ZmbGluZTsKICAgIHJlc3VsdC5tZXNzYWdlID0gcmVzdWx0Lm9mZmxpbmUKICAgICAgPyAi8J+UtCAiICsgdW5hbWUgKyAiIG9mZmxpbmUiCiAgICAgIDogIvCfn6IgXCIiICsgdW5hbWUgKyAiXCIgYWt0aWYiOwoKICAgIGlmICh0aW1lTGVmdCkgcmVzdWx0LnRpbWVMZWZ0ID0gdGltZUxlZnQ7CiAgICBpZiAobGFzdFNlZW5UaW1lICE9PSBudWxsKSByZXN1bHQubGFzdFNlZW4gPSBsYXN0U2VlblRpbWU7CgogICAgY29uc3QgY29tcGxldGVkU2Vzc2lvbnMgPSBjb21wbGV0ZWQuZ2V0KHVuYW1lKSB8fCBbXTsKICAgIHJlc3VsdC5jb21wbGV0ZWQgPSBjb21wbGV0ZWRTZXNzaW9ucy5tYXAoYyA9PiAoewogICAgICB1c2VybmFtZTogYy51c2VybmFtZSwKICAgICAgbm9fb3JkZXI6IGMubm9fb3JkZXIgfHwgbnVsbCwKICAgICAgbmFtYV9zdG9yZTogYy5uYW1hX3N0b3JlIHx8IG51bGwsCiAgICAgIGNvbXBsZXRlZEF0OiBjLmNvbXBsZXRlZEF0IHx8IG51bGwKICAgIH0pKTsKCiAgICBpZiAoZm9ybWF0ID09PSAidGV4dCIpIHsKICAgICAgaWYgKHJlc3VsdC5vZmZsaW5lKSByZXR1cm4gcmVzLnNlbmQocmVzdWx0Lm1lc3NhZ2UpOwoKICAgICAgbGV0IGFjdGl2ZU1lc3NhZ2UgPQogICAgICAgICLwn5+iIFwiIiArIHVuYW1lICsgIlwiIGFrdGlmXG4iICsKICAgICAgICAi4o+zIFRpbWUgbGVmdDogIiArICh0aW1lTGVmdCA+IDAgPyBtc1RvVGltZSh0aW1lTGVmdCkgOiAiRXhwaXJlZCIpICsgIlxuIiArCiAgICAgICAgIvCfkYHvuI8gTGFzdCBzZWVuOiAiICsgKGxhc3RTZWVuVGltZSAhPSBudWxsID8gbXNUb1RpbWUobGFzdFNlZW5UaW1lKSArICIgYWdvIiA6ICJVbmtub3duIik7CgogICAgICBjb25zdCBjb21wbGV0ZWRNZXNzYWdlcyA9IHJlc3VsdC5jb21wbGV0ZWQubWFwKGMgPT4KICAgICAgICAiXCIiICsgYy51c2VybmFtZSArICJcIiBqb2Igc2VsZXNhaSAob3JkZXI6ICIgKyAoYy5ub19vcmRlciB8fCAiLSIpICsgIikiCiAgICAgICk7CgogICAgICByZXR1cm4gcmVzLnNlbmQoW2FjdGl2ZU1lc3NhZ2VdLmNvbmNhdCgKICAgICAgICBjb21wbGV0ZWRNZXNzYWdlcy5sZW5ndGggPyBbIlxuY29tcGxldGVkIHNlc3Npb24ocyk6Il0uY29uY2F0KGNvbXBsZXRlZE1lc3NhZ2VzKSA6IFtdCiAgICAgICkuam9pbigiXG4iKSk7CiAgICB9CgogICAgaWYgKGxlZ2FjeSkgewogICAgICByZXR1cm4gcmVzLmpzb24oewogICAgICAgIHN0YXR1czogcmVzdWx0Lm9mZmxpbmUgPyAib2ZmbGluZSIgOiAiYWN0aXZlIiwKICAgICAgICB1c2VybmFtZTogdW5hbWUsCiAgICAgICAgdGltZUxlZnQsCiAgICAgICAgbGFzdFNlZW46IGxhc3RTZWVuVGltZSwKICAgICAgICBjb21wbGV0ZWQ6IHJlc3VsdC5jb21wbGV0ZWQsCiAgICAgICAgb2ZmbGluZTogcmVzdWx0Lm9mZmxpbmUKICAgICAgfSk7CiAgICB9CgogICAgcmV0dXJuIHJlcy5qc29uKHJlc3VsdCk7CiAgfQoKICAvLyBDb21wbGV0ZWQgb25seQogIGlmIChjb21wbGV0ZWQuaGFzKHVuYW1lKSkgewogICAgY29uc3QgY29tcGxldGVkU2Vzc2lvbnMgPSBjb21wbGV0ZWQuZ2V0KHVuYW1lKTsKICAgIHJlc3VsdC5jb21wbGV0ZWQgPSBjb21wbGV0ZWRTZXNzaW9ucy5tYXAoYyA9PiAoewogICAgICB1c2VybmFtZTogYy51c2VybmFtZSwKICAgICAgbm9fb3JkZXI6IGMubm9fb3JkZXIgfHwgbnVsbCwKICAgICAgbmFtYV9zdG9yZTogYy5uYW1hX3N0b3JlIHx8IG51bGwsCiAgICAgIGNvbXBsZXRlZEF0OiBjLmNvbXBsZXRlZEF0IHx8IG51bGwKICAgIH0pKTsKICAgIHJlc3VsdC5tZXNzYWdlID0gImNvbXBsZXRlZCBvbmx5IjsKCiAgICBpZiAoZm9ybWF0ID09PSAidGV4dCIpIHsKICAgICAgcmV0dXJuIHJlcy5zZW5kKHJlc3VsdC5jb21wbGV0ZWQubWFwKGMgPT4KICAgICAgICAiXCIiICsgYy51c2VybmFtZSArICJcIiBqb2Igc2VsZXNhaSAob3JkZXI6ICIgKyAoYy5ub19vcmRlciB8fCAiLSIpICsgIikiCiAgICAgICkuam9pbigiXG4iKSk7CiAgICB9CiAgICBpZiAobGVnYWN5KSB7CiAgICAgIHJldHVybiByZXMuanNvbih7IHN0YXR1czogImNvbXBsZXRlZCIsIHVzZXJuYW1lOiB1bmFtZSwgY29tcGxldGVkOiByZXN1bHQuY29tcGxldGVkIH0pOwogICAgfQogICAgcmV0dXJuIHJlcy5qc29uKHJlc3VsdCk7CiAgfQoKICAvLyBOb3RoaW5nIGZvdW5kCiAgcmVzdWx0Lm1lc3NhZ2UgPSAiTm8gc2Vzc2lvbiBmb3VuZCBmb3IgXCIiICsgdW5hbWUgKyAiXCIuIjsKICBpZiAoZm9ybWF0ID09PSAidGV4dCIpIHJldHVybiByZXMuc2VuZChyZXN1bHQubWVzc2FnZSk7CiAgaWYgKGxlZ2FjeSkgcmV0dXJuIHJlcy5qc29uKHsgc3RhdHVzOiAibm90Zm91bmQiLCB1c2VybmFtZTogdW5hbWUsIG1lc3NhZ2U6IHJlc3VsdC5tZXNzYWdlIH0pOwogIHJldHVybiByZXMuanNvbihyZXN1bHQpOwp9KTsKCmZ1bmN0aW9uIG1zVG9UaW1lKG1zKSB7CiAgbGV0IHNlY29uZHMgPSBNYXRoLmZsb29yKG1zIC8gMTAwMCk7CiAgbGV0IG1pbnV0ZXMgPSBNYXRoLmZsb29yKHNlY29uZHMgLyA2MCk7CiAgbGV0IGhvdXJzID0gTWF0aC5mbG9vcihtaW51dGVzIC8gNjApOwogIHNlY29uZHMgJT0gNjA7CiAgbWludXRlcyAlPSA2MDsKICByZXR1cm4gaG91cnMgKyAiaCAiICsgbWludXRlcyArICJtICIgKyBzZWNvbmRzICsgInMiOwp9CgovLyA9PT0gL2NoZWNrCmFwcC5wb3N0KCIvY2hlY2siLCAocmVxLCByZXMpID0+IHsKICBjb25zdCB7IHVzZXJuYW1lIH0gPSByZXEuYm9keTsKICBjb25zdCB1c2VyID0gdXNlcm5hbWUudG9Mb3dlckNhc2UoKTsKICBjb25zdCBzID0gc2Vzc2lvbnMuZ2V0KHVzZXIpOwogIGlmICghcykgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICJObyBhY3RpdmUgc2Vzc2lvbiIgfSk7CiAgbGFzdFNlZW4uc2V0KHVzZXIsIERhdGUubm93KCkpOwogIHJlcy5qc29uKHsgb2s6IHRydWUgfSk7Cn0pOwoKLy8gPT09IC9jb21wbGV0ZSAKYXBwLnBvc3QoIi9jb21wbGV0ZSIsIChyZXEsIHJlcykgPT4gewogIGNvbnN0IHsgdXNlcm5hbWUgfSA9IHJlcS5ib2R5OwogIGNvbnN0IHVzZXIgPSB1c2VybmFtZS50b0xvd2VyQ2FzZSgpOwogIGNvbnN0IHMgPSBzZXNzaW9ucy5nZXQodXNlcik7CiAgaWYgKCFzKSByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBlcnJvcjogIk5vIHNlc3Npb24iIH0pOwoKICBjb25zdCBub3cgPSBNYXRoLmZsb29yKERhdGUubm93KCkgLyAxMDAwKTsKICBjb25zdCBjbGVhbiA9IHMubm9fb3JkZXIucmVwbGFjZSgvXk9EMDAwMDAwLywgIiIpOwoKICBjb25zdCBlbWJlZCA9IHsKICAgIGVtYmVkczogW3sKICAgICAgdGl0bGU6ICLinIUgKipKT0tJIENPTVBMRVRFRCoqIiwKICAgICAgZGVzY3JpcHRpb246CiAgICAgICAgYCoqVXNlcm5hbWU6KiogJHtzLnVzZXJuYW1lfVxuYCArCiAgICAgICAgYCoqT3JkZXIgSUQ6KiogJHtzLm5vX29yZGVyfVxuYCArCiAgICAgICAgYFvwn5SXIFZpZXcgT3JkZXJdKGh0dHBzOi8vdG9rb2t1Lml0ZW1rdS5jb20vcml3YXlhdC1wZXNhbmFuL3JpbmNpYW4vJHtjbGVhbn0pXG5cbmAgKwogICAgICAgIGDij7AgQ29tcGxldGVkIGF0OiA8dDoke25vd306Zj5gLAogICAgICBmb290ZXI6IHsgdGV4dDogYC0gJHtzLm5hbWFfc3RvcmV9YCB9CiAgICB9XQogIH07CgogIGZldGNoKGBodHRwczovL2Rpc2NvcmQuY29tL2FwaS92MTAvY2hhbm5lbHMvJHtDSEFOTkVMfS9tZXNzYWdlc2AsIHsKICAgIG1ldGhvZDogIlBPU1QiLAogICAgaGVhZGVyczogewogICAgICAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLAogICAgICBBdXRob3JpemF0aW9uOiBgQm90ICR7Qk9UX1RPS0VOfWAKICAgIH0sCiAgICBib2R5OiBKU09OLnN0cmluZ2lmeShlbWJlZCkKICB9KS5jYXRjaChjb25zb2xlLmVycm9yKTsKCiAgc2Vzc2lvbnMuZGVsZXRlKHVzZXIpOwogIGxhc3RTZWVuLmRlbGV0ZSh1c2VyKTsKICBpZiAoIWNvbXBsZXRlZC5oYXModXNlcikpIGNvbXBsZXRlZC5zZXQodXNlciwgW10pOwogIGNvbXBsZXRlZC5nZXQodXNlcikucHVzaChzKTsKICBzYXZlU3RvcmFnZSgpOwogIHJlcy5qc29uKHsgb2s6IHRydWUgfSk7Cn0pOwoKLy8gPT09IC9EaXNjb25uZWN0ZWQgCmFwcC5wb3N0KCIvZGlzY29ubmVjdGVkIiwgKHJlcSwgcmVzKSA9PiB7CiAgY29uc3QgeyB1c2VybmFtZSwgcmVhc29uID0gIlVua25vd24iLCBwbGFjZUlkIH0gPSByZXEuYm9keTsKICBpZiAoIXVzZXJuYW1lKSByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogIk1pc3NpbmcgdXNlcm5hbWUiIH0pOwoKICBjb25zdCBlbWJlZCA9IHsKICAgIGVtYmVkczogWwogICAgICB7CiAgICAgICAgdGl0bGU6IGDinYwgUGxheWVyIERpc2Nvbm5lY3RlZGAsCiAgICAgICAgY29sb3I6IDB4ZmYwMDAwLAogICAgICAgIGZpZWxkczogWwogICAgICAgICAgeyBuYW1lOiAiVXNlcm5hbWUiLCB2YWx1ZTogdXNlcm5hbWUsIGlubGluZTogdHJ1ZSB9LAogICAgICAgICAgeyBuYW1lOiAiUmVhc29uIiwgdmFsdWU6IHJlYXNvbiwgaW5saW5lOiB0cnVlIH0sCiAgICAgICAgICB7IG5hbWU6ICJQbGFjZSBJRCIsIHZhbHVlOiBwbGFjZUlkIHx8ICJVbmtub3duIiwgaW5saW5lOiB0cnVlIH0KICAgICAgICBdLAogICAgICAgIHRpbWVzdGFtcDogbmV3IERhdGUoKS50b0lTT1N0cmluZygpCiAgICAgIH0KICAgIF0KICB9OwoKICBmZXRjaChgaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdjEwL2NoYW5uZWxzLyR7Q0hBTk5FTH0vbWVzc2FnZXNgLCB7CiAgICBtZXRob2Q6ICJQT1NUIiwKICAgIGhlYWRlcnM6IHsKICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgQXV0aG9yaXphdGlvbjogYEJvdCAke0JPVF9UT0tFTn1gCiAgICB9LAogICAgYm9keTogSlNPTi5zdHJpbmdpZnkoZW1iZWQpCiAgfSkuY2F0Y2goY29uc29sZS5lcnJvcik7CgogIHJlcy5qc29uKHsgb2s6IHRydWUgfSk7Cn0pOwoKLy8gPT09IC9vcmRlciAoVUkgUGFnZSkKYXBwLmdldCgiL29yZGVyIiwgKHJlcSwgcmVzKSA9PiB7CiAgcmVzLnNlbmQoYAo8IURPQ1RZUEUgaHRtbD4KPGh0bWwgbGFuZz0iZW4iPgo8aGVhZD4KICA8bWV0YSBjaGFyc2V0PSJVVEYtOCIvPgogIDxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsaW5pdGlhbC1zY2FsZT0xLjAiLz4KICA8dGl0bGU+Q2hlY2sgT3JkZXI8L3RpdGxlPgogIDxzdHlsZT4KICAgIGJvZHkgewogICAgICBtYXJnaW46MDsgcGFkZGluZzoyMHB4OwogICAgICBiYWNrZ3JvdW5kOiBsaW5lYXItZ3JhZGllbnQoMTM1ZGVnLCAjMGYwZjFiLCAjMTIyNmE1KTsKICAgICAgY29sb3I6I2VjZWNlYzsKICAgICAgZm9udC1mYW1pbHk6J0ludGVyJyxBcmlhbCxzYW5zLXNlcmlmOwogICAgICBtaW4taGVpZ2h0OiAxMDB2aDsKICAgICAgZGlzcGxheTpmbGV4OwogICAgICBqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyOwogICAgICBhbGlnbi1pdGVtczpjZW50ZXI7CiAgICB9CiAgICAuY29udGFpbmVyIHsKICAgICAgd2lkdGg6IDkwJTsgbWF4LXdpZHRoOiA1MDBweDsKICAgICAgYmFja2dyb3VuZDogIzFkMWQyODsKICAgICAgcGFkZGluZzogMjBweDsKICAgICAgYm9yZGVyLXJhZGl1czogMTRweDsKICAgICAgYm94LXNoYWRvdzogMCA0cHggMjBweCAjMDAwODsKICAgICAgdGV4dC1hbGlnbjogY2VudGVyOwogICAgfQogICAgaW5wdXQsIGJ1dHRvbiB7CiAgICAgIHdpZHRoOiAxMDAlOwogICAgICBwYWRkaW5nOiAxMnB4OwogICAgICBtYXJnaW4tdG9wOiAxMnB4OwogICAgICBib3JkZXI6IG5vbmU7CiAgICAgIGJvcmRlci1yYWRpdXM6IDZweDsKICAgICAgZm9udC1zaXplOiAxNnB4OwogICAgICBib3gtc2l6aW5nOiBib3JkZXItYm94OwogICAgfQogICAgaW5wdXQgewogICAgICBiYWNrZ3JvdW5kOiAjMmEyYTMzOwogICAgICBjb2xvcjogI2VlZTsKICAgIH0KICAgIGJ1dHRvbiB7CiAgICAgIGJhY2tncm91bmQ6ICMzYjgyZjY7CiAgICAgIGNvbG9yOiAjZmZmOwogICAgICBjdXJzb3I6IHBvaW50ZXI7CiAgICAgIGZvbnQtd2VpZ2h0OiBib2xkOwogICAgfQogICAgQG1lZGlhKG1heC13aWR0aDo3NjhweCl7CiAgICAgIGlucHV0LCBidXR0b24geyBmb250LXNpemU6MThweDsgfQogICAgfQogIDwvc3R5bGU+CjwvaGVhZD4KPGJvZHk+CiAgPGRpdiBjbGFzcz0iY29udGFpbmVyIj4KICAgIDxoMj7wn5SNIENoZWNrIE9yZGVyPC9oMj4KICAgIDxpbnB1dCBpZD0icSIgcGxhY2Vob2xkZXI9Ik9yZGVyIElEIChFeGFtcGxlOiBPRDAwMDAwMDEyMzQ1NikiIC8+CiAgICA8YnV0dG9uIG9uY2xpY2s9InN0YXJ0Q2hlY2soKSI+Q2hlY2sgT3JkZXI8L2J1dHRvbj4KICA8L2Rpdj4KICA8c2NyaXB0PgogICAgZnVuY3Rpb24gc3RhcnRDaGVjaygpIHsKICAgICAgY29uc3QgcSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJxIikudmFsdWUudHJpbSgpOwogICAgICBpZiAoIXEgfHwgIXEuc3RhcnRzV2l0aCgiT0QiKSkgcmV0dXJuOwogICAgICBjb25zdCBjbGVhbiA9IHEucmVwbGFjZSgvXk9EMDAwMDAwLywgIiIpOwogICAgICB3aW5kb3cubG9jYXRpb24uaHJlZiA9ICIvb3JkZXIvIiArIGNsZWFuOwogICAgfQogIDwvc2NyaXB0Pgo8L2JvZHk+CjwvaHRtbD4KICBgKTsKfSk7CgovLyA9PT0gL29yZGVyLzpjbGVhbiAoRGlyZWN0IFJlZGlyZWN0KQphcHAuZ2V0KCIvb3JkZXIvOmNsZWFuIiwgKHJlcSwgcmVzKSA9PiB7CiAgY29uc3QgeyBjbGVhbiB9ID0gcmVxLnBhcmFtczsKICByZXMucmVkaXJlY3QoYGh0dHBzOi8vdG9rb2t1Lml0ZW1rdS5jb20vcml3YXlhdC1wZXNhbmFuL3JpbmNpYW4vJHtjbGVhbn1gKTsKfSk7CgovLyA9PT0gL2pvaW4gcmVkaXJlY3QKYXBwLmdldCgiL2pvaW4iLCAocmVxLCByZXMpID0+IHsKICBjb25zdCB7IHBsYWNlLCBqb2IgfSA9IHJlcS5xdWVyeTsKICBpZiAoIXBsYWNlIHx8ICFqb2IpIHJldHVybiByZXMuc3RhdHVzKDQwMCkuc2VuZCgiTWlzc2luZyBwbGFjZS9qb2IiKTsKICBjb25zdCB1cmkgPSBgcm9ibG94Oi8vZXhwZXJpZW5jZXMvc3RhcnQ/cGxhY2VJZD0ke3BsYWNlfSZnYW1lSWQ9JHtqb2J9YDsKICBqb2IgPSBwZW5kaW5nLmdldCh1c2VybmFtZSk7CiAgcGVuZGluZy5kZWxldGUodXNlcm5hbWUpOwogIHNlc3Npb25zLnNldCh1c2VybmFtZSwgam9iKTsKICByZXMuc2VuZChgCiAgPCFET0NUWVBFIGh0bWw+PGh0bWw+PGJvZHkgc3R5bGU9ImJhY2tncm91bmQ6IzE4MTgxYjtjb2xvcjojZWVlO2Rpc3BsYXk6ZmxleDtqdXN0aWZ5LWNvbnRlbnQ6Y2VudGVyO2FsaWduLWl0ZW1zOmNlbnRlcjtoZWlnaHQ6MTAwdmg7Zm9udC1mYW1pbHk6c2Fucy1zZXJpZjsiPgogICAgPGRpdiBzdHlsZT0idGV4dC1hbGlnbjpjZW50ZXI7Ij4KICAgICAgPGgxPkZ1bmN0aW9uIHdhcyBkaXNjb250aW51ZWQuPC9oMT4KICAgICAgPGEgaHJlZj0iJHt1cml9IiBzdHlsZT0iY29sb3I6IzNiODJmNjsiPlRhcCBoZXJlIGlmIG5vdCByZWRpcmVjdGVkPC9hPgogICAgPC9kaXY+CiAgICA8c2NyaXB0PnNldFRpbWVvdXQoKCkgPT4geyBsb2NhdGlvbi5ocmVmID0gIiR7dXJpfSIgfSwgMTUwMCk8L3NjcmlwdD4KICA8L2JvZHk+PC9odG1sPmApOwp9KTsKCi8vIFNodXRkb3duIGFuZCByZXN0YXJ0IHNlcnZlciAocHJvdGVjdGVkIGJ5IHJlcXVpcmVBdXRoKQphcHAucG9zdCgiL3NodXRkb3duIiwgKHJlcSwgcmVzKSA9PiB7CiAgcmVzLnNlbmQoIvCflLQgU2VydmVyIHNodXR0aW5nIGRvd24uLi4iKTsKICBwcm9jZXNzLmV4aXQoMCk7Cn0pOwoKYXBwLnBvc3QoIi9yZXN0YXJ0IiwgKHJlcSwgcmVzKSA9PiB7CiAgcmVxdWlyZSgiY2hpbGRfcHJvY2VzcyIpLmV4ZWMoImJhc2ggLi9yYmx4LnNoIiwgKGVyciwgc3Rkb3V0LCBzdGRlcnIpID0+IHsKICAgIGlmIChlcnIpIGNvbnNvbGUuZXJyb3IoZXJyKTsKICAgIHJlcy5zZW5kKCLwn5SEIFJlc3RhcnRlZCB2aWEgcmJseC5zaCIpOwogIH0pOwp9KTsKCi8vIGdhZyB1cGxvYWQgZGF0YQphcHAucG9zdCgiL3VwbG9hZC1nYWctZGF0YSIsIGV4cHJlc3MuanNvbigpLCAocmVxLCByZXMpID0+IHsKICBjb25zdCB7IHVzZXJuYW1lLCBkYXRhIH0gPSByZXEuYm9keSB8fCB7fTsKICBpZiAoIXVzZXJuYW1lIHx8ICFkYXRhKSB7CiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogIk1pc3NpbmcgdXNlcm5hbWUgb3IgZGF0YSIgfSk7CiAgfQoKICBjb25zdCBrZXkgPSB1c2VybmFtZS50b0xvd2VyQ2FzZSgpOwogIGdhZ0RhdGFTdG9yZS5zZXQoa2V5LCBkYXRhKTsKICBzYXZlR0FHKCk7ICAvLyBQZXJzaXN0IHRvIGdhZ2RhdGEuanNvbgoKICBjb25zb2xlLmxvZyhg8J+TpSBHQUcgZGF0YSBzYXZlZCBmb3IgJHtrZXl9YCk7CiAgcmVzLmpzb24oeyBzdWNjZXNzOiB0cnVlIH0pOwp9KTsKCi8vID09PSAvc2VuZC1qb2IgPT09CmFwcC5wb3N0KCIvc2VuZC1qb2IiLCBhc3luYyAocmVxLCByZXMpID0+IHsKICBjb25zdCB7IGpvYklkID0gIlVua25vd24iLCB1c2VybmFtZSA9ICJVc2VyIiwgam9pbl91cmwgPSAiIiwgcGxhY2VJZCA9ICJOL0EiIH0gPSByZXEuYm9keTsKICBjb25zdCBzID0gc2Vzc2lvbnMuZ2V0KHVzZXJuYW1lKTsKICBpZiAoIXMpIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7IGVycm9yOiAiTm8gc2Vzc2lvbiIgfSk7CgogIHRyeSB7CiAgICBhd2FpdCBmZXRjaChgaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdjEwL2NoYW5uZWxzLyR7cy5KT0JfQ0hBTk5FTH0vbWVzc2FnZXNgLCB7CiAgICAgIG1ldGhvZDogIlBPU1QiLAogICAgICBoZWFkZXJzOiB7CiAgICAgICAgIkNvbnRlbnQtVHlwZSI6ICJhcHBsaWNhdGlvbi9qc29uIiwKICAgICAgICBBdXRob3JpemF0aW9uOiBgQm90ICR7Qk9UX1RPS0VOfWAKICAgICAgfSwKICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoewogICAgICAgIGVtYmVkczogW3sKICAgICAgICAgIHRpdGxlOiBg8J+nqSBKb2IgSUQgZm9yICR7dXNlcm5hbWV9YCwKICAgICAgICAgIGRlc2NyaXB0aW9uOiBgKipQbGFjZSBJRDoqKiBcYCR7cGxhY2VJZH1cYFxuKipKb2IgSUQ6KiogXGAke2pvYklkfVxgYCwKICAgICAgICAgIGZpZWxkczogW3sKICAgICAgICAgICAgbmFtZTogIkpvaW4gTGluayIsCiAgICAgICAgICAgIHZhbHVlOiBgW0NsaWNrIHRvIEpvaW4gR2FtZV0oJHtqb2luX3VybH0pYAogICAgICAgICAgfV0sCiAgICAgICAgICBjb2xvcjogMHgzNDk4ZGIKICAgICAgICB9XQogICAgICB9KQogICAgfSk7CiAgICByZXMuanNvbih7IG9rOiB0cnVlIH0pOwogIH0gY2F0Y2ggKGUpIHsKICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHsgZXJyb3I6IGUubWVzc2FnZSB9KTsKICB9Cn0pOwoKLy8gcmVxdWVzdCBkb3dubG9hZCBkYXRhIHRvIHNwZWVkaHViCmFwcC5nZXQoIi9kb3dubG9hZC1nYWctZGF0YSIsIChyZXEsIHJlcykgPT4gewogIGNvbnN0IHVzZXJuYW1lID0gKHJlcS5xdWVyeS51c2VybmFtZSB8fCAiIikudG9Mb3dlckNhc2UoKTsKICBpZiAoIXVzZXJuYW1lKSB7CiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogIk1pc3NpbmcgdXNlcm5hbWUiIH0pOwogIH0KCiAgY29uc3QgZGF0YSA9IGdhZ0RhdGFTdG9yZS5nZXQodXNlcm5hbWUpOwogIGlmICghZGF0YSkgewogICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgZXJyb3I6ICJHQUcgZGF0YSBub3QgZm91bmQiIH0pOwogIH0KCiAgcmVzLmpzb24oZGF0YSk7Cn0pOwoKLy8gPT09IEhlYXJ0YmVhdCB3YXRjaGRvZwpzZXRJbnRlcnZhbCgoKSA9PiB7CiAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKTsKICBzZXNzaW9ucy5mb3JFYWNoKChzLCB1bmFtZSkgPT4gewogICAgLy8gU2tpcCBpZiB0aGUgdXNlciBpcyBhbHJlYWR5IGluIGNvbXBsZXRlZCBzZXNzaW9ucwogICAgaWYgKGNvbXBsZXRlZC5oYXModW5hbWUpKSByZXR1cm47CgogICAgY29uc3Qgc2VlbiA9IGxhc3RTZWVuLmdldCh1bmFtZSkgfHwgMDsKCiAgICBpZiAocy50eXBlICE9PSAiYWZrIiAmJiAhcy53YXJuZWQgJiYgbm93ID4gcy5lbmRUaW1lKSB7CiAgICAgIGZldGNoKGBodHRwczovL2Rpc2NvcmQuY29tL2FwaS92MTAvY2hhbm5lbHMvJHtDSEFOTkVMfS9tZXNzYWdlc2AsIHsKICAgICAgICBtZXRob2Q6ICJQT1NUIiwKICAgICAgICBoZWFkZXJzOiB7ICJDb250ZW50LVR5cGUiOiAiYXBwbGljYXRpb24vanNvbiIsIEF1dGhvcml6YXRpb246IGBCb3QgJHtCT1RfVE9LRU59YCB9LAogICAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgY29udGVudDogYOKPsyAke3MudXNlcm5hbWV9J3Mgam9raSBlbmRlZC5gIH0pCiAgICAgIH0pLmNhdGNoKGNvbnNvbGUuZXJyb3IpOwogICAgICBzLndhcm5lZCA9IHRydWU7CiAgICB9CgogICAgaWYgKCFzLm9mZmxpbmUgJiYgbm93IC0gc2VlbiA+IDE4MDAwMCkgewogICAgICBmZXRjaChgaHR0cHM6Ly9kaXNjb3JkLmNvbS9hcGkvdjEwL2NoYW5uZWxzLyR7Q0hBTk5FTH0vbWVzc2FnZXNgLCB7CiAgICAgICAgbWV0aG9kOiAiUE9TVCIsCiAgICAgICAgaGVhZGVyczogeyAiQ29udGVudC1UeXBlIjogImFwcGxpY2F0aW9uL2pzb24iLCBBdXRob3JpemF0aW9uOiBgQm90ICR7Qk9UX1RPS0VOfWAgfSwKICAgICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7IGNvbnRlbnQ6IGDwn5S0IEBldmVyeW9uZSDigJMgKioke3MudXNlcm5hbWV9IGlzIE9GRkxJTkUuKiogTm8gaGVhcnRiZWF0IGluIDPigK9taW51dGVzLmAgfSkKICAgICAgfSkuY2F0Y2goY29uc29sZS5lcnJvcik7CiAgICAgIHMub2ZmbGluZSA9IHRydWU7CiAgICB9CgogICAgaWYgKHMub2ZmbGluZSAmJiBub3cgLSBzZWVuIDw9IDE4MDAwMCkgewogICAgICBzLm9mZmxpbmUgPSBmYWxzZTsKICAgIH0KICB9KTsKfSwgNjAwMDApOwoKLy8gPT09IFN0YXJ0IFNlcnZlcgpjb25zdCB2ZXJzID0gdmVyc2lvbgpjb25zdCBjbG9nID0gY2hhbmdlbG9nCmFwcC5saXN0ZW4oUE9SVCwgKCkgPT4gewogIGNvbnNvbGUubG9nKGB+JCBQcm94eSBydW5uaW5nIG9uIGh0dHA6Ly9sb2NhbGhvc3Q6JHtQT1JUfWApOwogIGNvbnNvbGUubG9nKGB+JCBUbyBleHBvc2UgdmlhIENsb3VkZmxhcmU6XG5jbG91ZGZsYXJlZCB0dW5uZWwgc3RhcnQgbXktdHVubmVsYCk7CiAgY29uc29sZS5sb2codmVycykKICBjb25zb2xlLmxvZyhjbG9nKQp9KTs=";
const decoded = Buffer.from(encoded, "base64").toString("utf8");
eval(decoded);